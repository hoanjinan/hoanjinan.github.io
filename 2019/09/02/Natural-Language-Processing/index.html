<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>Natural Language Processing (NLP) | hoanjinan_otoko</title><meta name="description" content="Have you ever wondered how your email filters out spam messages?  Or maybe how autocorrect on your phone knows what you're trying to type?  In this post, we'll cover some basics of natural language processing like reading in and creating structure in messy text data, and then cleaning and tokenizing that data.  Then the post will cover some of the more advanced topics like lemmatising, stemming, and vectorizing the data.  In other words, converting it from text into a numeric matrix.  The post do this with a focus on preparing the data to build a machine learning classifier on top of it.  The post will also learn how to build two different types of machine learning models, while thoroughly testing and evaluating different variations of those models.  We'll have the tools to go from messy dataset to concise and accurate predictions from machine learning model, to deliver solutions to complex business problems."><meta name="keywords" content="Data Science,Data Processing,Machine Learning,AI"><meta name="author" content="Zilan Huang"><meta name="copyright" content="Zilan Huang"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="canonical" href="http://hoanjinan.github.io/2019/09/02/Natural-Language-Processing/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Natural Language Processing (NLP)"><meta name="twitter:description" content="Have you ever wondered how your email filters out spam messages?  Or maybe how autocorrect on your phone knows what you're trying to type?  In this post, we'll cover some basics of natural language processing like reading in and creating structure in messy text data, and then cleaning and tokenizing that data.  Then the post will cover some of the more advanced topics like lemmatising, stemming, and vectorizing the data.  In other words, converting it from text into a numeric matrix.  The post do this with a focus on preparing the data to build a machine learning classifier on top of it.  The post will also learn how to build two different types of machine learning models, while thoroughly testing and evaluating different variations of those models.  We'll have the tools to go from messy dataset to concise and accurate predictions from machine learning model, to deliver solutions to complex business problems."><meta name="twitter:image" content="https://live.staticflickr.com/65535/48721190707_bc691426d8_o.png"><meta property="og:type" content="article"><meta property="og:title" content="Natural Language Processing (NLP)"><meta property="og:url" content="http://hoanjinan.github.io/2019/09/02/Natural-Language-Processing/"><meta property="og:site_name" content="hoanjinan_otoko"><meta property="og:description" content="Have you ever wondered how your email filters out spam messages?  Or maybe how autocorrect on your phone knows what you're trying to type?  In this post, we'll cover some basics of natural language processing like reading in and creating structure in messy text data, and then cleaning and tokenizing that data.  Then the post will cover some of the more advanced topics like lemmatising, stemming, and vectorizing the data.  In other words, converting it from text into a numeric matrix.  The post do this with a focus on preparing the data to build a machine learning classifier on top of it.  The post will also learn how to build two different types of machine learning models, while thoroughly testing and evaluating different variations of those models.  We'll have the tools to go from messy dataset to concise and accurate predictions from machine learning model, to deliver solutions to complex business problems."><meta property="og:image" content="https://live.staticflickr.com/65535/48721190707_bc691426d8_o.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="next" title="Spark for Machine Learning and AI" href="http://hoanjinan.github.io/2019/08/20/Spark-for-Machine-Learning-AI/"><link rel="manifest" href="/img/pwa/manifest.json"><meta name="theme-color" content="#fff"><meta name="msapplication-TileColor" content="#fff"><link rel="apple-touch-icon" sizes="180x180" href="/img/pwa/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/pwa/32.png"><link rel="icon" type="image/png" sizes="16x16" href="/img/pwa/16.png"><link rel="mask-icon" href="/img/pwa/safari-pinned-tab.svg" color="#5bbad5"><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?a29c9ae6807bf668430dda20bfdf3ac5";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-146505841-1', 'auto');
ga('send', 'pageview');
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'true',
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    title: 'Bookmark',
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days'

  
}</script></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#introduction"><span class="toc-number">1.</span> <span class="toc-text"> Introduction</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#introduction-to-the-post"><span class="toc-number">1.1.</span> <span class="toc-text"> Introduction to The Post</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#introduction-to-natural-language-processing-nlp"><span class="toc-number">1.2.</span> <span class="toc-text"> Introduction to Natural Language Processing (NLP)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#introduction-to-nltk"><span class="toc-number">1.3.</span> <span class="toc-text"> Introduction to NLTK</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#nlp-basics"><span class="toc-number">2.</span> <span class="toc-text"> NLP Basics</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#how-to-install-nltk-on-local-machine"><span class="toc-number">2.1.</span> <span class="toc-text"> How to install NLTK on local machine</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#download-nltk-data"><span class="toc-number">2.1.1.</span> <span class="toc-text"> Download NLTK data</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#reading-in-text-data"><span class="toc-number">2.2.</span> <span class="toc-text"> Reading in Text Data</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#what-is-unstructured-data"><span class="toc-number">2.2.1.</span> <span class="toc-text"> What is Unstructured Data</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#read-semi-structured-data"><span class="toc-number">2.2.2.</span> <span class="toc-text"> Read Semi-structured data</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#exploring-the-dataset"><span class="toc-number">2.3.</span> <span class="toc-text"> Exploring The Dataset</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#regular-expressions"><span class="toc-number">2.4.</span> <span class="toc-text"> Regular Expressions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#introduction-to-regular-expression"><span class="toc-number">2.4.1.</span> <span class="toc-text"> Introduction to Regular Expression</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#how-to-use-regular-expressions"><span class="toc-number">2.4.2.</span> <span class="toc-text"> How to Use Regular Expressions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#regular-expression-replacements"><span class="toc-number">2.4.3.</span> <span class="toc-text"> Regular Expression Replacements</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#other-examples-of-regex-methods"><span class="toc-number">2.4.3.1.</span> <span class="toc-text"> Other examples of regex methods</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#machine-learning-pipeline"><span class="toc-number">2.5.</span> <span class="toc-text"> Machine Learning Pipeline</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#implementation"><span class="toc-number">2.6.</span> <span class="toc-text"> Implementation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#removing-punctuation"><span class="toc-number">2.6.1.</span> <span class="toc-text"> Removing Punctuation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tokenisation"><span class="toc-number">2.6.2.</span> <span class="toc-text"> Tokenisation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#removing-stop-words"><span class="toc-number">2.6.3.</span> <span class="toc-text"> Removing Stop Words</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#supplemental-data-cleaning"><span class="toc-number">3.</span> <span class="toc-text"> Supplemental Data Cleaning</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#introducting-stemming"><span class="toc-number">3.1.</span> <span class="toc-text"> Introducting Stemming</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#using-stemming"><span class="toc-number">3.2.</span> <span class="toc-text"> Using Stemming</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#introducting-lemmatising"><span class="toc-number">3.3.</span> <span class="toc-text"> Introducting Lemmatising</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#using-lemmatising"><span class="toc-number">3.4.</span> <span class="toc-text"> Using Lemmatising</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#test-out-wordnet-lemmatiser-read-more-about-wordnet-here"><span class="toc-number">3.4.1.</span> <span class="toc-text"> Test out WordNet lemmatiser (read more about WordNet here)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#comparation-between-lemmatiser-and-stemmer"><span class="toc-number">3.4.2.</span> <span class="toc-text"> Comparation between Lemmatiser and Stemmer</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#first-example"><span class="toc-number">3.4.2.1.</span> <span class="toc-text"> First Example</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#second-example"><span class="toc-number">3.4.2.2.</span> <span class="toc-text"> Second Example</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#apply-lammatiser-to-sms-spam-collection-data"><span class="toc-number">3.4.3.</span> <span class="toc-text"> Apply lammatiser to SMS Spam Collection Data</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#vectorising-raw-data"><span class="toc-number">4.</span> <span class="toc-text"> Vectorising Raw Data</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#introducing-vectorising"><span class="toc-number">4.1.</span> <span class="toc-text"> Introducing Vectorising</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#count-vectorisation"><span class="toc-number">4.2.</span> <span class="toc-text"> Count Vectorisation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#n-gram-vectorising"><span class="toc-number">4.3.</span> <span class="toc-text"> N-gram Vectorising</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#inverse-document-frequency-weighting-tf-idf"><span class="toc-number">4.4.</span> <span class="toc-text"> Inverse Document Frequency Weighting (TF-IDF)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#feature-engineering"><span class="toc-number">5.</span> <span class="toc-text"> Feature Engineering</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#introducing-feature-engineering"><span class="toc-number">5.1.</span> <span class="toc-text"> Introducing Feature Engineering</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#feature-creation"><span class="toc-number">5.2.</span> <span class="toc-text"> Feature Creation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#feature-evaluation"><span class="toc-number">5.3.</span> <span class="toc-text"> Feature Evaluation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#identifying-features-for-treansformation"><span class="toc-number">5.4.</span> <span class="toc-text"> Identifying Features for Treansformation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#box-cox-power-transformation"><span class="toc-number">5.5.</span> <span class="toc-text"> Box-Cox Power Transformation</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#building-machine-learning-classifiers"><span class="toc-number">6.</span> <span class="toc-text"> Building Machine Learning Classifiers</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#what-is-machine-learning"><span class="toc-number">6.1.</span> <span class="toc-text"> What is Machine Learning</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#two-broad-types-of-machine-learning"><span class="toc-number">6.1.1.</span> <span class="toc-text"> Two Broad Types of Machine Learning</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cross-validation-and-evaluation-metrics"><span class="toc-number">6.2.</span> <span class="toc-text"> Cross-validation and Evaluation Metrics</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#introducting-random-forest"><span class="toc-number">6.3.</span> <span class="toc-text"> Introducting Random Forest</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#building-a-random-forest-model"><span class="toc-number">6.4.</span> <span class="toc-text"> Building a Random Forest Model</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#random-forest-with-holdout-test-set"><span class="toc-number">6.5.</span> <span class="toc-text"> Random Forest with Holdout Test Set</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#random-forest-model-with-grid-search"><span class="toc-number">6.6.</span> <span class="toc-text"> Random Forest Model with Grid Search</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#evaluate-random-forest-model-performance"><span class="toc-number">6.7.</span> <span class="toc-text"> Evaluate Random Forest Model Performance</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#introducting-gradient-boosting"><span class="toc-number">6.8.</span> <span class="toc-text"> Introducting Gradient Boosting</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gradient-boosting-grid-search"><span class="toc-number">6.9.</span> <span class="toc-text"> Gradient-boosting Grid Search</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#evaluate-gradient-boosting-model-performance"><span class="toc-number">6.10.</span> <span class="toc-text"> Evaluate Gradient-boosting Model Performance</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#model-selection-data-prep"><span class="toc-number">6.11.</span> <span class="toc-text"> Model Selection: Data Prep</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#model-selection-results"><span class="toc-number">6.12.</span> <span class="toc-text"> Model Selection: Results</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#summary"><span class="toc-number">7.</span> <span class="toc-text"> Summary</span></a></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://live.staticflickr.com/65535/48720681223_4532c52bae_o.jpg)"><div id="page-header"><span class="pull-left"> <a class="blog_title" id="site-name" href="/">hoanjinan_otoko</a></span><div class="open toggle-menu pull-right"><div class="menu-icon-first"></div><div class="menu-icon-second"></div><div class="menu-icon-third"></div></div><span class="pull-right menus"><div class="mobile_author_icon"><img class="lozad" src="https://live.staticflickr.com/65535/48621182898_91a9c4cc04_o.jpg" onerror="onerror=null;src='/img/friend_404.gif'"><div class="mobile_author-info__description"></div></div><hr><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> Gallery</span></a><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a><script>document.body.addEventListener('touchstart', function(){ });</script></div></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Natural Language Processing (NLP)</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> Created 2019-09-02<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> Updated 2019-11-11</time><span class="post-meta__separator mobile_hidden">|</span><span class="mobile_hidden"><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Tutorial/">Tutorial</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Tutorial/Data-Processing/">Data Processing</a></span><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">30.1k</span><span class="post-meta__separator">|</span><span>Reading time: 187 min</span><span class="post-meta__separator">|</span><span>Post View: </span><span id="busuanzi_value_page_pv"></span></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="introduction"><a class="markdownIt-Anchor" href="#introduction"></a> Introduction</h1>
<h2 id="introduction-to-the-post"><a class="markdownIt-Anchor" href="#introduction-to-the-post"></a> Introduction to The Post</h2>
<p>Have you ever wondered how your email filters out spam messages?  Or maybe how autocorrect on your phone knows what you’re trying to type?  In this post, we’ll cover some basics of natural language processing like reading in and creating structure in messy text data, and then cleaning and tokenizing that data.  Then the post will cover some of the more advanced topics like lemmatising, stemming, and vectorizing the data.  In other words, converting it from text into a numeric matrix.  The post do this with a focus on preparing the data to build a machine learning classifier on top of it.  The post will also learn how to build two different types of machine learning models, while thoroughly testing and evaluating different variations of those models.  We’ll have the tools to go from messy dataset to concise and accurate predictions from machine learning model, to deliver solutions to complex business problems.</p>
<h2 id="introduction-to-natural-language-processing-nlp"><a class="markdownIt-Anchor" href="#introduction-to-natural-language-processing-nlp"></a> Introduction to Natural Language Processing (NLP)</h2>
<p>Natural language processing is a field concerned with the ability of a computer to understand, analyze, manipulate, and potentially generate human language. By human language, we’re simply referring to any language used for everyday communication.  This can be English, Spanish, French, anything like that.  Now it’s worth noting that Python doesn’t naturally know what any given word means.  All it will see is a string of characters.  For instance, it has no idea what natural actually means.  It sees that it’s seven characters long, but the individual characters don’t mean anything to Python and certainly the collection of those characters together don’t mean anything, either.  So we know that, what an N is, what an A is, and we know that together, those seven characters makes up the word natural, and we know what that means.  So NLP is the field of getting the computer to understand what naturally actually signifies, and from there we can get into the manipulation or potentially even generation of that human language.</p>
<p>You probably experience natural language processing on a daily basis.  They may not really even know it.  So here are a few examples that you may see on a day to day basis.  The first would be a spam filter, so this is just where your email server is determining whether an incoming email is spam or not, based on the content of the body, the subject, and maybe the email domain.  The second is auto-complete, where Google is basically predicting what you’re interested in searching for based on what you’ve already entered and what others commonly search for with those same phrases.  So if I search for natural language processing, it knows that many other people are interested in learning NLP with Python, or learning it through a course, or looking for jobs related to natural language processing.  So it can auto-complete your search for you.  The last is auto-correct, where say iPhone is trying to help you correct a misspelling. It shows how auto-correct has actually evolved over time and continues to evolve and learn by upgrading the operating system.  So with iOS 6, if you’re trying to say, “I’ll be ill tomorrow,” It wouldn’t necessarily correct I’ll be I’ll tomorrow until iOS 7, where it actually corrects, it auto-completes tomorrow and corrects I’ll into ill.  So it’ll correctly send as I’ll be ill tomorrow.  So that just kind of shows how NLP is still evolving and how a system like iOS is still kind of learning what natural language even means.</p>
<p>Now NLP is a very broad umbrella that encompasses many topics. A few of those might be sentiment analysis, topic modeling, text classification, and sentence segmentation or part-or-speech tagging.  The core component of natural language processing is extracting all the information from a block of text that is relevant to a computer understanding the language.  This is task specific, as well.  Different information is relevant for a sentiment analysis task than is relevant for a topic modeling task. So that’s a very quick introduction into what natural language processing is.</p>
<h2 id="introduction-to-nltk"><a class="markdownIt-Anchor" href="#introduction-to-nltk"></a> Introduction to NLTK</h2>
<p>The natural language toolkit is the most utilized package for handling natural language processing tasks in Python.  Usually called NLTK for short, it is a suite of open-source tools originally created in 2001 at the University of Pennsylvania for the purpose of making building NLP processes in Python easier.  This package has been expanded through the extensive contributions of open-source users in the years since its original development.  NLTK is great because it basically provides a jumpstart to building any NLP process by giving you the basic tools that you can then chain together to accomplish your goal rather than having to build all those tools from scratch and a lot of tools are packaged into NLTK.</p>
<h1 id="nlp-basics"><a class="markdownIt-Anchor" href="#nlp-basics"></a> NLP Basics</h1>
<h2 id="how-to-install-nltk-on-local-machine"><a class="markdownIt-Anchor" href="#how-to-install-nltk-on-local-machine"></a> How to install NLTK on local machine</h2>
<p>Both sets of instructions below assume you already have Python installed. These instructions are taken directly from <a href="http://www.nltk.org/install.html" target="_blank" rel="noopener">http://www.nltk.org/install.html</a>.</p>
<p><strong>Mac/Unix</strong></p>
<p>From the terminal:</p>
<ol>
<li>Install NLTK: run <code>pip install -U nltk</code></li>
<li>Test installation: run <code>python</code> then type <code>import nltk</code></li>
</ol>
<p><strong>Windows</strong></p>
<ol>
<li>Install NLTK: <a href="http://pypi.python.org/pypi/nltk" target="_blank" rel="noopener">http://pypi.python.org/pypi/nltk</a></li>
<li>Test installation: <code>Start&gt;Python35</code>, then type <code>import nltk</code></li>
</ol>
<h3 id="download-nltk-data"><a class="markdownIt-Anchor" href="#download-nltk-data"></a> Download NLTK data</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line">nltk.download()</span><br></pre></td></tr></table></figure>
<p>The following images will show the downloader of NLTK:</p>
<p><img alt="NLTK All Packages Uninstalled" data-src="https://live.staticflickr.com/65535/48763279606_5f4e633e56_o.png" class="lozad"></p>
<p>In above image, select ‘all packages’ and click ‘download’ button to start installing all NLTK packages.</p>
<p><img alt="NLTK All Packages Installed" data-src="https://live.staticflickr.com/65535/48763469122_14a72259a2_o.png" class="lozad"></p>
<p>The above image shows that all NLTK packages have been installed.</p>
<p>Small example of using NLTK package:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> nltk.corpus <span class="keyword">import</span> stopwords</span><br><span class="line"></span><br><span class="line">stopwords.words(<span class="string">"english"</span>)[<span class="number">0</span>:<span class="number">500</span>:<span class="number">25</span>]</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'i'</span>, <span class="string">'herself'</span>, <span class="string">'been'</span>, <span class="string">'with'</span>, <span class="string">'here'</span>, <span class="string">'very'</span>, <span class="string">'doesn'</span>, <span class="string">'won'</span>]</span><br></pre></td></tr></table></figure>
<h2 id="reading-in-text-data"><a class="markdownIt-Anchor" href="#reading-in-text-data"></a> Reading in Text Data</h2>
<h3 id="what-is-unstructured-data"><a class="markdownIt-Anchor" href="#what-is-unstructured-data"></a> What is Unstructured Data</h3>
<p>Unstructured data could mean that it’s binary data, it could mean no delimiters, or it could mean no indications of any rows.  A few examples might be an email, PDF file, social media post, these may just get dumped into a file with no indication of where, maybe, a subject of an email ends and the body of the email begins, or even where one email ends and the next begins.  It could also get cluttered by things like HTML tags and it can get really messy.  It’s important to note that Python is pretty smart, but ultimately, unless it’s told otherwise, it basically sees everything as a string of characters. It needs to be told what those characters mean.</p>
<h3 id="read-semi-structured-data"><a class="markdownIt-Anchor" href="#read-semi-structured-data"></a> Read Semi-structured data</h3>
<p>The following image presents a semi-structured SMS data:</p>
<p><img alt="Semi-structured SMS data sample" data-src="https://live.staticflickr.com/65535/48762959738_6a7611d217_o.png" class="lozad"></p>
<p>This dataset is a collection of text messages, each with a label of either spam or ham.  It’s not a clean CSV file, but it’s not terribly unstructured, either.  Each row has a distinct text message and a distinct label as either spam or ham. So, in the context of text datasets, this is actually pretty well structured, so this shouldn’t be too difficult.</p>
<p>Reading the data and print it out:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Read in the raw text</span></span><br><span class="line">rawData = open(<span class="string">"SMSSpamCollection.tsv"</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Print the raw data</span></span><br><span class="line">rawData[<span class="number">0</span>:<span class="number">500</span>]</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"ham\tI've been searching for the right words to thank you for this breather. I promise i wont take your help for granted and will fulfil my promise. You have been wonderful and a blessing at all times.\nspam\tFree entry in 2 a wkly comp to win FA Cup final tkts 21st May 2005. Text FA to 87121 to receive entry question(std txt rate)T&amp;C's apply 08452810075over18's\nham\tNah I don't think he goes to usf, he lives around here though\nham\tEven my brother is not like to speak with me. They treat me like aid"</span></span><br></pre></td></tr></table></figure>
<p>You could see that it’s just basically a block of text, and you’ll see that you have these \t and these \n separators. The \t’s are between the labels and the text message bodies, and the \n’s are typically at the end of those lines.</p>
<p>The following code is going to replace \n with \t and then split this into a list:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">parsedData = rawData.replace(<span class="string">"\t"</span>, <span class="string">"\n"</span>).split(<span class="string">"\n"</span>)</span><br><span class="line"></span><br><span class="line">parsedData[<span class="number">0</span>:<span class="number">5</span>]</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'ham'</span>,</span><br><span class="line"> <span class="string">"I've been searching for the right words to thank you for this breather. I promise i wont take your help for granted and will fulfil my promise. You have been wonderful and a blessing at all times."</span>,</span><br><span class="line"> <span class="string">'spam'</span>,</span><br><span class="line"> <span class="string">"Free entry in 2 a wkly comp to win FA Cup final tkts 21st May 2005. Text FA to 87121 to receive entry question(std txt rate)T&amp;C's apply 08452810075over18's"</span>,</span><br><span class="line"> <span class="string">'ham'</span>]</span><br></pre></td></tr></table></figure>
<p>Split the label and the text into lists:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">labelList = parsedData[<span class="number">0</span>::<span class="number">2</span>]</span><br><span class="line">textList = parsedData[<span class="number">1</span>::<span class="number">2</span>]</span><br></pre></td></tr></table></figure>
<p>Print the results:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(labelList[<span class="number">0</span>:<span class="number">5</span>])</span><br><span class="line">print(textList[<span class="number">0</span>:<span class="number">5</span>])</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'ham'</span>, <span class="string">'spam'</span>, <span class="string">'ham'</span>, <span class="string">'ham'</span>, <span class="string">'ham'</span>]</span><br><span class="line">[<span class="string">"I've been searching for the right words to thank you for this breather. I promise i wont take your help for granted and will fulfil my promise. You have been wonderful and a blessing at all times."</span>, <span class="string">"Free entry in 2 a wkly comp to win FA Cup final tkts 21st May 2005. Text FA to 87121 to receive entry question(std txt rate)T&amp;C's apply 08452810075over18's"</span>, <span class="string">"Nah I don't think he goes to usf, he lives around here though"</span>, <span class="string">'Even my brother is not like to speak with me. They treat me like aids patent.'</span>, <span class="string">'I HAVE A DATE ON SUNDAY WITH WILL!!'</span>]</span><br></pre></td></tr></table></figure>
<p>Combine both lists and put them into pandas dataframe:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">fullCorpus = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">"label"</span>: labelList,</span><br><span class="line">    <span class="string">"body_list"</span>: textList</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fullCorpus.head()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ValueError: arrays must all be same length</span><br></pre></td></tr></table></figure>
<p>Spot the error:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(len(labelList))</span><br><span class="line">print(len(textList))</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">5571</span></span><br><span class="line"><span class="number">5570</span></span><br></pre></td></tr></table></figure>
<p>Print the last 5 values:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(labelList[<span class="number">-5</span>:])</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'ham'</span>, <span class="string">'ham'</span>, <span class="string">'ham'</span>, <span class="string">'ham'</span>, <span class="string">''</span>]</span><br></pre></td></tr></table></figure>
<p>Correction:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fullCorpus = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">"label"</span>: labelList[:<span class="number">-1</span>],</span><br><span class="line">    <span class="string">"body_list"</span>: textList</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fullCorpus.head()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">label</th>
<th style="text-align:center">body_list</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">I’ve been searching for the right words to tha…</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">spam</td>
<td style="text-align:center">Free entry in 2 a wkly comp to win FA Cup fina…</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">Nah I don’t think he goes to usf, he lives aro…</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">Even my brother is not like to speak with me. …</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">I HAVE A DATE ON SUNDAY WITH WILL!!</td>
</tr>
</tbody>
</table>
<p>Read the file using pandas:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dataset = pd.read_csv(<span class="string">"SMSSpamCollection.tsv"</span>, sep = <span class="string">"\t"</span>, header = <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">dataset.head()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">0</th>
<th style="text-align:center">1</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">I’ve been searching for the right words to tha…</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">spam</td>
<td style="text-align:center">Free entry in 2 a wkly comp to win FA Cup fina…</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">Nah I don’t think he goes to usf, he lives aro…</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">Even my brother is not like to speak with me. …</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">I HAVE A DATE ON SUNDAY WITH WILL!!</td>
</tr>
</tbody>
</table>
<h2 id="exploring-the-dataset"><a class="markdownIt-Anchor" href="#exploring-the-dataset"></a> Exploring The Dataset</h2>
<p>Before diving into any in-depth analysis, data cleaning or model building, we want to do some very high-level exploration of our data to understand what we’re working with.  So we might ask questions like what is the shape of our data, how many ham or spam are in our data set, and are there any missing values.  So this will inform the decisions that we make as we move forward.</p>
<p>Read the data:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">fullCorpus = pd.read_csv(<span class="string">'SMSSpamCollection.tsv'</span>, sep=<span class="string">'\t'</span>, header=<span class="literal">None</span>)</span><br><span class="line">fullCorpus.columns = [<span class="string">"label"</span>, <span class="string">"body_text"</span>]</span><br><span class="line"></span><br><span class="line">fullCorpus.head()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">label</th>
<th style="text-align:center">body_list</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">I’ve been searching for the right words to tha…</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">spam</td>
<td style="text-align:center">Free entry in 2 a wkly comp to win FA Cup fina…</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">Nah I don’t think he goes to usf, he lives aro…</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">Even my brother is not like to speak with me. …</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">I HAVE A DATE ON SUNDAY WITH WILL!!</td>
</tr>
</tbody>
</table>
<p>What is the shape of the dataset?</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">"Input data has &#123;&#125; rows and &#123;&#125; columns"</span>.format(len(fullCorpus), len(fullCorpus.columns)))</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Input data has <span class="number">5568</span> rows <span class="keyword">and</span> <span class="number">2</span> columns</span><br></pre></td></tr></table></figure>
<p>How many spam/ham are there?</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">"Out of &#123;&#125; rows, &#123;&#125; are spam, &#123;&#125; are ham"</span>.format(len(fullCorpus),</span><br><span class="line">                                                       len(fullCorpus[fullCorpus[<span class="string">"label"</span>] == <span class="string">"spam"</span>]),</span><br><span class="line">                                                       len(fullCorpus[fullCorpus[<span class="string">"label"</span>] == <span class="string">"ham"</span>])))</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Out of <span class="number">5568</span> rows, <span class="number">746</span> are spam, <span class="number">4822</span> are ham</span><br></pre></td></tr></table></figure>
<p>How much missing data is there?</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">"Number of null in label: &#123;&#125;"</span>.format(fullCorpus[<span class="string">"label"</span>].isnull().sum()))</span><br><span class="line">print(<span class="string">"Number of null in text: &#123;&#125;"</span>.format(fullCorpus[<span class="string">"body_text"</span>].isnull().sum()))</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Number of null <span class="keyword">in</span> label: <span class="number">0</span></span><br><span class="line">Number of null <span class="keyword">in</span> text: <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>This helped us better understand our data once we actually got it read in. The insights pulled from this very basic exploration will help dictate how we approach the rest of our data cleaning and model building.</p>
<h2 id="regular-expressions"><a class="markdownIt-Anchor" href="#regular-expressions"></a> Regular Expressions</h2>
<h3 id="introduction-to-regular-expression"><a class="markdownIt-Anchor" href="#introduction-to-regular-expression"></a> Introduction to Regular Expression</h3>
<p>A regular expression, or a regex for short is a text string used for describing a certain search pattern.  So if you’re familiar with wildcards for search, like if you wanted to search for any CSV file on your computer using *.csv, this is basically just a supercharged version of that.  Regular expressions can take various forms.</p>
<p>To give a very quick example of what it means, the regular expression ‘nlp’ will just search for the explicit “nlp” string within some other string.  This isn’t so much a search pattern as it is an explicit command for what we want to find.  So if it was, “I love nlp” then this search pattern would just capture and return “nlp.”  Another way to identify the “nlp” string would be to use the expression ‘[j-q]’.  And this will just search for all single characters between ‘j’ and ‘q’ in whatever text we’re looking at, but this will search for all characters between ‘j’ and ‘q’, not just ‘n’, ‘l’, and ‘p’.  The other consideration here is that this will only return single characters at a time.  So this would return ‘n’ and then ‘l’ and then ‘p’ and also whatever other characters between ‘j’ and ‘q’ in your text string.  This isn’t usually what we’re looking for.  So we can solve that issue of only returning a single character by simply placing a plus sign outside of our brackets like ‘[j-q]+’.  What that will tell Python is that it can search for strings longer than one character.  So what this will look for is any character between ‘j’ and ‘q’, just with the added flexibility of returning strings of multiple characters together that are between ‘j’ and ‘q’.  Switching gears a little bit, ‘[0-9]+’ will return all numbers with the flexibility of returning sequences of more than one number.  So if there’s a year, like 2017, it will return the full year, rather than each number individually.  Then lastly, to combine these two concepts, ‘[j-q0-9]+’ will search for sequences of characters between ‘j’ and ‘q’, or numbers between 0 and 9.  So if you had a course name that was “nlp2017” without any spaces, then it would return that full string, but if you had “nlp 2017” with a space in between them, then that would return them as two separate sequences.  This is just five very quick examples, but there is literally an infinite number of patters that you could come up with.</p>
<p>Regex give you the power and flexibility to search for almost any kind of pattern you could imagine.  The examples are useful, but why do we actually care about this?  Regexes are particularly useful when dealing with text data because a lot of the data is unstructured, where you need to be able to use these patterns to try to create some structure within the document.  For instance, you could use a regex to identify the white space between words or tokens, or even let Python know how to split up a certain sentence.  Another use is to identify delimiters between columns or end-of-line escape characters that indicate the end of one line and the beginning of another like we saw in our SMS Spam Collection dataset.  They can also be used to remove punctuation or numbers, clean HTML tags, or just identify some random patterns that you’re interested in.  A few examples of regular use cases might be confirming passwords that meet some criteria.  So maybe a company requires one capital letter, one lower case and one special character in their passwords.  You can create a regex to confirm that each new password created matches that criteria.  Then the last three all kind of fall under the same broad category of searching for a certain pattern, like filenames, so find all the CSV’s that meet this criteria, or some portion of a URL, so maybe it’s whatever follows .com or .org, or scraping for key information from a larger document like package version numbers from a technical report.</p>
<h3 id="how-to-use-regular-expressions"><a class="markdownIt-Anchor" href="#how-to-use-regular-expressions"></a> How to Use Regular Expressions</h3>
<p>The primary reason that we’re talking about regex is in order to tokenize sentences or split a sentence into a list of words so that Python can understand what it needs to be looking at.  Right now, Python just sees a string of characters, so we need to tell it what to focus on, and how to organize those characters.  For our machine learning model, Python will need to split the string into what we call tokens, or words, so that the model can learn how those tokens relate to the corresponse variable.</p>
<p>Python’s <code>re</code> package is the most commonly used regex resource. More details can be found <a href="https://docs.python.org/3/library/re.html" target="_blank" rel="noopener">here</a>.</p>
<p>Import <code>re</code> package and define 3 sentences:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">re_test = <span class="string">'This is a made up string to test 2 different regex methods'</span></span><br><span class="line">re_test_messy = <span class="string">'This      is a made up     string to test 2    different regex methods'</span></span><br><span class="line">re_test_messy1 = <span class="string">'This-is-a-made/up.string*to&gt;&gt;&gt;&gt;test----2""""""different~regex-methods'</span></span><br></pre></td></tr></table></figure>
<p>Splitting a sentence into a list of words:</p>
<p>First Sentance:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">re.split(<span class="string">"\s"</span>, re_test)</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'This'</span>,</span><br><span class="line"> <span class="string">'is'</span>,</span><br><span class="line"> <span class="string">'a'</span>,</span><br><span class="line"> <span class="string">'made'</span>,</span><br><span class="line"> <span class="string">'up'</span>,</span><br><span class="line"> <span class="string">'string'</span>,</span><br><span class="line"> <span class="string">'to'</span>,</span><br><span class="line"> <span class="string">'test'</span>,</span><br><span class="line"> <span class="string">'2'</span>,</span><br><span class="line"> <span class="string">'different'</span>,</span><br><span class="line"> <span class="string">'regex'</span>,</span><br><span class="line"> <span class="string">'methods'</span>]</span><br></pre></td></tr></table></figure>
<p>Second Sentance:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Split on a space to find words</span></span><br><span class="line">re.split(<span class="string">"\s"</span>, re_test_messy)</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'This'</span>,</span><br><span class="line"> <span class="string">''</span>,</span><br><span class="line"> <span class="string">''</span>,</span><br><span class="line"> <span class="string">''</span>,</span><br><span class="line"> <span class="string">''</span>,</span><br><span class="line"> <span class="string">''</span>,</span><br><span class="line"> <span class="string">'is'</span>,</span><br><span class="line"> <span class="string">'a'</span>,</span><br><span class="line"> <span class="string">'made'</span>,</span><br><span class="line"> <span class="string">'up'</span>,</span><br><span class="line"> <span class="string">''</span>,</span><br><span class="line"> <span class="string">''</span>,</span><br><span class="line"> <span class="string">''</span>,</span><br><span class="line"> <span class="string">''</span>,</span><br><span class="line"> <span class="string">'string'</span>,</span><br><span class="line"> <span class="string">'to'</span>,</span><br><span class="line"> <span class="string">'test'</span>,</span><br><span class="line"> <span class="string">'2'</span>,</span><br><span class="line"> <span class="string">''</span>,</span><br><span class="line"> <span class="string">''</span>,</span><br><span class="line"> <span class="string">''</span>,</span><br><span class="line"> <span class="string">'different'</span>,</span><br><span class="line"> <span class="string">'regex'</span>,</span><br><span class="line"> <span class="string">'methods'</span>]</span><br></pre></td></tr></table></figure>
<p>You can see that the above code doesn’t work well if there are more spaces between words.  The following code can solve this problem:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Split on maybe more than one spaces to find words</span></span><br><span class="line">re.split(<span class="string">"\s+"</span>, re_test_messy)</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'This'</span>,</span><br><span class="line"> <span class="string">'is'</span>,</span><br><span class="line"> <span class="string">'a'</span>,</span><br><span class="line"> <span class="string">'made'</span>,</span><br><span class="line"> <span class="string">'up'</span>,</span><br><span class="line"> <span class="string">'string'</span>,</span><br><span class="line"> <span class="string">'to'</span>,</span><br><span class="line"> <span class="string">'test'</span>,</span><br><span class="line"> <span class="string">'2'</span>,</span><br><span class="line"> <span class="string">'different'</span>,</span><br><span class="line"> <span class="string">'regex'</span>,</span><br><span class="line"> <span class="string">'methods'</span>]</span><br></pre></td></tr></table></figure>
<p>Let’s try the third sentance:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">re.split(<span class="string">"\s+"</span>, re_test_messy1)</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'This-is-a-made/up.string*to&gt;&gt;&gt;&gt;test----2""""""different~regex-methods'</span>]</span><br></pre></td></tr></table></figure>
<p>As you can see that the code above only looks for spaces but the third sentance contains lots of special characters so the code will not work on this sentance.  However, the following code fix this problem by only searching non word characters.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">re.split(<span class="string">"\W+"</span>, re_test_messy1)</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'This'</span>,</span><br><span class="line"> <span class="string">'is'</span>,</span><br><span class="line"> <span class="string">'a'</span>,</span><br><span class="line"> <span class="string">'made'</span>,</span><br><span class="line"> <span class="string">'up'</span>,</span><br><span class="line"> <span class="string">'string'</span>,</span><br><span class="line"> <span class="string">'to'</span>,</span><br><span class="line"> <span class="string">'test'</span>,</span><br><span class="line"> <span class="string">'2'</span>,</span><br><span class="line"> <span class="string">'different'</span>,</span><br><span class="line"> <span class="string">'regex'</span>,</span><br><span class="line"> <span class="string">'methods'</span>]</span><br></pre></td></tr></table></figure>
<p>There are other two options that can search all useful words instead of searching for non words but give the same result in the end.  The following 3 lines of code will show you how it does.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">re.findall(<span class="string">"\S+"</span>, re_test)</span><br><span class="line"></span><br><span class="line">re.findall(<span class="string">"\S+"</span>, re_test_messy)</span><br><span class="line"></span><br><span class="line">re.findall(<span class="string">"\w+"</span>, re_test_messy1)</span><br></pre></td></tr></table></figure>
<p><em><strong>Notice: uppercase usually means the opposite of lowercase that lowercase searches for all specified instances but uppercase will search others instead of the specified instances</strong></em></p>
<p>So that’s how we can use two different methods from the re package along with several different regexes to properly tokenize messy sentences. Now that we’ve covered some of the basic regex usage for the purpose of tokenizing, there are a few takeaways to keep in mind. There are two methods from the re package that can be used for tokenizing. findall() will search for the actual words while ignoring the things that separate the words, while split() will search for the characters that split the words while ignoring the actual words themselves. And the regexes that are most useful for tokenizing, keep in mind that anything using a W is based on words, while anything with an S is based on white spaces. In our daily work, it’s much more common to be using the W regex because it allows the flexibility for words to be separated by spaces, or special characters. But having an understanding of what the S offers you is a nice tool to hold in your back pocket.</p>
<h3 id="regular-expression-replacements"><a class="markdownIt-Anchor" href="#regular-expression-replacements"></a> Regular Expression Replacements</h3>
<p>The following sentances are the examples that we need to capture a section of the sentance and replace with other words:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pep8_test = <span class="string">'I try to follow PEP8 guidelines'</span></span><br><span class="line">pep7_test = <span class="string">'I try to follow PEP7 guidelines'</span></span><br><span class="line">peep8_test = <span class="string">'I try to follow PEEP8 guidelines'</span></span><br></pre></td></tr></table></figure>
<p>We need to replace PEP8, PEP7 and PEEP8 with PEP8 Python Styleguide.  The following code is the experiment of this replacement:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">re.findall(<span class="string">"[a-z]+"</span>, pep8_test)</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'try'</span>, <span class="string">'to'</span>, <span class="string">'follow'</span>, <span class="string">'guidelines'</span>]</span><br></pre></td></tr></table></figure>
<p>The above code is to find out all lower case words, but we need to find the uppercase ones, so we are going to change it like this:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">re.findall(<span class="string">"[A-Z]+"</span>, pep8_test)</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'I'</span>, <span class="string">'PEP'</span>]</span><br></pre></td></tr></table></figure>
<p>As you can notice from the output, it captures all uppercase word.  However, we also need digits in the end to get the output of PEP8, PEP7 and PEEP8.  Therefore, we simply put [0-9]+ to make it possible.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">re.findall(<span class="string">"[A-Z]+[0-9]+"</span>, peep8_test)</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'PEEP8'</span>]</span><br></pre></td></tr></table></figure>
<p>Here is our final searching result, but we need to replace this section, how can we do?</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">re.sub(<span class="string">"[A-Z]+[0-9]+"</span>, <span class="string">"PEP8 Python Styleguide"</span>, peep8_test)</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'I try to follow PEP8 Python Styleguide guidelines'</span></span><br></pre></td></tr></table></figure>
<p>You can see that the sub function can help us replacing our search section with another defined section.</p>
<p>Now this regex certainly isn’t perfect, you can imagine a scenario that it would miss, for instance if there’s a space between pep and 8 or if it was lowercase, it would miss both of those, so you’d likely need to spend some time refining your regex.  However the point is to illustrate how you can use regex and give a practical example of a case that you might use it in.  So now up to this point we’ve explored three different regex methods with some practical application of how you might use it.  But there are a lot of other regex methods within this repackage.  Few are listed below, so there’s search, match, full match, find itter, and escape.  Even more broadly, the regex that we explored are very, very simple.  They can get very complex.  And the best way to learn it is by defining your own string with the goal of identifying some substring, pull up a regex cheat sheet, and start exploring different patterns to try to identify that substring.</p>
<h4 id="other-examples-of-regex-methods"><a class="markdownIt-Anchor" href="#other-examples-of-regex-methods"></a> Other examples of regex methods</h4>
<ul>
<li>re.search()</li>
<li>re.match()</li>
<li>re.fullmatch()</li>
<li>re.finditer()</li>
<li>re.escape()</li>
</ul>
<h2 id="machine-learning-pipeline"><a class="markdownIt-Anchor" href="#machine-learning-pipeline"></a> Machine Learning Pipeline</h2>
<p>Up to this point, we’ve learned some basics of NLP and NLTK.  We’ve learned how to read in messy text, and we’ve learned how to use regular expressions to search for and manipulate that text.  Now, we’ll take a step back to understand how this all fits together in the broader machine learning pipeline before we dive into each step individually.  This section is going to introduce some new topics as well and we’ll cover each of these topics later.  This is meant only to provide the proper context for how this all fits together.</p>
<p>In a typical machine learning text pipeline, you’ll start with some document with raw text in it, like the SMS data set that we’re working with.  It’s important to note that at this stage, the computer has no idea what it’s looking at.  All it sees is a collection of characters.  It doesn’t know the word ham from the word spam.  The characters mean nothing.  It doesn’t even know a space from a number or a letter.  They’re all the same.</p>
<p>So the first thing we need to do is tokenize our text.  We did this earlier in this chapter by splitting on white space or special characters.  So you would take the sentence, “I am learning NLP,” and it would split into a list with four tokens, I and then am and then learning, and lastly NLP.  So now, instead of just seeing one long string of characters like it was seeing before, now Python will see a list with four distinct tokens, so it knows what to look at.  So now we have a list of tokens, so Python knows what to look at.</p>
<p>However, some of the words might be a little bit more important than other words.  For instance, the words the, and, of, or, appear very frequently but don’t really offer much information about the sentence itself.  These are what’s called stop words.  We took a quick look at these earlier in this post.  Typically, you will remove these words to allow Python to really focus in on the most pivotal words in our sentence.  So in the example we used previously, instead of a list with I, am, learning, NLP, once you remove stop words, now you’re just left with learning and NLP.  This still gets across the most important point of the sentence, but now you’re only looking at half the amount of tokens.  Also, the process of stemming helps Python realize that words like learn, learned and learning all have basically the same semantic meaning.  You may not think this is a big deal, and in a small sample it’s really not, but when you all of a sudden have a million text messages, and a corpus of 150,000 words, any words that you can remove to allow Python to focus on the most pivotal words can really make a big difference.</p>
<p>So now Python sees a list of tokens you care about, and the key words that we think are useful for building some kind of machine learning model.  Even though Python now knows what you care about, it still only sees characters.  It doesn’t know what learning or NLP even means.  So we have to convert it to a format that a machine learning algorithm can actually ingest and use to build a model.  This is a process called vectorizing.  It’s basically converting the text to a numeric representation of that text, where you are essentially counting the occurrences of each word in each text message using a matrix with one row per text message and one column per word.</p>
<p>So that you have this numeric matrix, you can now fit your actual machine learning model by feeding in your vectorized data along with your spam or ham labels.  The model will then learn the relationships between the words and the labels in order to train a model to make predictions on text messages that it has never seen before and determine whether they are spam or not.  There are various types of machine learning models.  It will be up to you to select a few of them to try out.  You’ll tailor your choices based on the type of input data you’re giving it, what you’re trying to predict, how much compute power you have, things like that.  You’ll typically test out a number of what’s called candidate models before selecting which model performs best.  Once you select the best model, you’ll evaluate that on a holdout test set, and this is typically a set of data that you’ll set off to the side in the very beginning for the purpose of testing your final model on it to see how your model will perform on data that it’s never seen or touched before.  If it passes this final test, then you’ll prepare to implement it within whatever framework you’re working with.  In this example, it’s an illustration of a spam filter, trying to filter out whether incoming email is spam or not.</p>
<h2 id="implementation"><a class="markdownIt-Anchor" href="#implementation"></a> Implementation</h2>
<p>In the previous part, we put those together at a conceptual level, laying out what the full machine learning pipeline looks like.  In this part, we’re going to actually write the code to handle to cleaning portion, or the pre-processing as it’s typically referred to, of this machine learning program.  There are four steps below that you’ll see in a lot of text cleaning pipelines: <strong>removing the punctuation, tokenization, removing stop words, and lemmatising or stemming</strong>.  We’re going to focus on the first three steps in this session, then we’ll cover lemmatising and stemming in the next chapter of the post, as those are a little bit more advanced and not implemented in every pipeline.</p>
<p>The following sample is our target output for all:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># What does the cleaned version look like?</span></span><br><span class="line">data_cleaned = pd.read_csv(<span class="string">"SMSSpamCollection_cleaned.tsv"</span>, sep=<span class="string">'\t'</span>)</span><br><span class="line">data_cleaned.head()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">label</th>
<th style="text-align:center">body_text</th>
<th style="text-align:center">body_text_nostop</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">I’ve been searching for the right words to thank you for this breather. I promise i wont take yo…</td>
<td style="text-align:center">[‘ive’, ‘searching’, ‘right’, ‘words’, ‘thank’, ‘breather’, ‘promise’, ‘wont’, ‘take’, ‘help’, '…</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">spam</td>
<td style="text-align:center">Free entry in 2 a wkly comp to win FA Cup final tkts 21st May 2005. Text FA to 87121 to receive …</td>
<td style="text-align:center">[‘free’, ‘entry’, ‘2’, ‘wkly’, ‘comp’, ‘win’, ‘fa’, ‘cup’, ‘final’, ‘tkts’, ‘21st’, ‘may’, '2005…</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">Nah I don’t think he goes to usf, he lives around here though</td>
<td style="text-align:center">[‘nah’, ‘dont’, ‘think’, ‘goes’, ‘usf’, ‘lives’, ‘around’, ‘though’]</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">Even my brother is not like to speak with me. They treat me like aids patent.</td>
<td style="text-align:center">[‘even’, ‘brother’, ‘like’, ‘speak’, ‘treat’, ‘like’, ‘aids’, ‘patent’]</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">I HAVE A DATE ON SUNDAY WITH WILL!!</td>
<td style="text-align:center">[‘date’, ‘sunday’]</td>
</tr>
</tbody>
</table>
<h3 id="removing-punctuation"><a class="markdownIt-Anchor" href="#removing-punctuation"></a> Removing Punctuation</h3>
<p>Import data:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="comment"># Set dataframe max coloumn width to 100 characters, and default is 50</span></span><br><span class="line">pd.set_option(<span class="string">'display.max_colwidth'</span>, <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Read the file with the delimiter of tabs and set header to none</span></span><br><span class="line">data = pd.read_csv(<span class="string">"SMSSpamCollection.tsv"</span>, sep=<span class="string">'\t'</span>, header=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Setting the header manually</span></span><br><span class="line">data.columns = [<span class="string">'label'</span>, <span class="string">'body_text'</span>]</span><br><span class="line"></span><br><span class="line">data.head()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">label</th>
<th style="text-align:center">body_text</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">I’ve been searching for the right words to thank you for this breather. I promise i wont take yo…</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">spam</td>
<td style="text-align:center">Free entry in 2 a wkly comp to win FA Cup final tkts 21st May 2005. Text FA to 87121 to receive …</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">Nah I don’t think he goes to usf, he lives around here though</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">Even my brother is not like to speak with me. They treat me like aids patent.</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">I HAVE A DATE ON SUNDAY WITH WILL!!</td>
</tr>
</tbody>
</table>
<p>Import string package and show what punctuation has:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">string.punctuation</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'!"#$%&amp;\'()*+,-./:;&lt;=&gt;?@[\\]^_`&#123;|&#125;~'</span></span><br></pre></td></tr></table></figure>
<p>This is really helpful to allow Python to identify what we’re looking for.  The reason that we care about this is that periods, parentheses, and other punctuation look like just another character to Python.  But realistically, the period doesn’t really help pull the meaning out of a sentence.  In the following example, for us “I like NLP.”, with a period, is exactly the same as, “I like NLP”.  They mean the same thing to us, but when you give that to Python, Python says those are not equivalent things.  And Python isn’t saying “I like NLP” without a period is different than “I like NLP.”  With a period, in that they’re really close, but one has a period and one doesn’t.  To Python, these might was well be “I like NLP” versus “I hate NLP”.  It knows they’re different without any ability to understand how different they are.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"I like NLP."</span> == <span class="string">"I like NLP"</span></span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>
<p>There is the function to remove the punctuation:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove_punctuation</span><span class="params">(text)</span>:</span></span><br><span class="line">    <span class="comment"># Check if a character is in string punctuationk, if it is not, return this charactor</span></span><br><span class="line">    <span class="comment"># and the join all characters together by using "".join</span></span><br><span class="line">    text_nopunct = <span class="string">""</span>.join(char <span class="keyword">for</span> char <span class="keyword">in</span> text <span class="keyword">if</span> char <span class="keyword">not</span> <span class="keyword">in</span> string.punctuation)</span><br><span class="line">    <span class="keyword">return</span> text_nopunct</span><br><span class="line"></span><br><span class="line"><span class="comment"># This is going to apply our lambda function to each row of body_text</span></span><br><span class="line">data[<span class="string">"body_text_clean"</span>] = data[<span class="string">"body_text"</span>].apply(<span class="keyword">lambda</span> x : remove_punctuation(x))</span><br><span class="line"></span><br><span class="line">data.head()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">label</th>
<th style="text-align:center">body_text</th>
<th style="text-align:center">body_text_nostop</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">I’ve been searching for the right words to thank you for this breather. I promise i wont take yo…</td>
<td style="text-align:center">Ive been searching for the right words to thank you for this breather I promise i wont take your…</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">spam</td>
<td style="text-align:center">Free entry in 2 a wkly comp to win FA Cup final tkts 21st May 2005. Text FA to 87121 to receive …</td>
<td style="text-align:center">Free entry in 2 a wkly comp to win FA Cup final tkts 21st May 2005 Text FA to 87121 to receive e…</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">Nah I don’t think he goes to usf, he lives around here though</td>
<td style="text-align:center">Nah I dont think he goes to usf he lives around here though</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">Even my brother is not like to speak with me. They treat me like aids patent.</td>
<td style="text-align:center">Even my brother is not like to speak with me They treat me like aids patent</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">I HAVE A DATE ON SUNDAY WITH WILL!!</td>
<td style="text-align:center">I HAVE A DATE ON SUNDAY WITH WILL</td>
</tr>
</tbody>
</table>
<h3 id="tokenisation"><a class="markdownIt-Anchor" href="#tokenisation"></a> Tokenisation</h3>
<p>As we discussed previously, tokenizing is splitting some string or sentence into a list of words.  We learn that you have to account for extra cases in your strings, like if they’re separated by special characters or multiple spaces.  So we’ll just use what we learned in our lesson about regexes, and combine that with the approach we learned in the last lesson, where we removed punctuation by writing our own function, and then applying it to our data set using a lambda function in order to tokenize our text.</p>
<p>The following code is going to tokenise text data:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tokenise</span><span class="params">(text)</span>:</span></span><br><span class="line">    <span class="comment"># The \W+ regex, indicates that it will split wherever it sees one or more non-word characters</span></span><br><span class="line">    tokens = re.split(<span class="string">"\W+"</span>, text)</span><br><span class="line">    <span class="keyword">return</span> tokens</span><br><span class="line"></span><br><span class="line"><span class="comment"># Similar to removing punctuation, apply the function to text data as well as lower the case</span></span><br><span class="line"><span class="comment"># because Python is case sensitive</span></span><br><span class="line">data[<span class="string">"body_text_tokenised"</span>] = data[<span class="string">"body_text_clean"</span>].apply(<span class="keyword">lambda</span> x : tokenise(x.lower()))</span><br><span class="line"></span><br><span class="line">data.head()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">label</th>
<th style="text-align:center">body_text</th>
<th style="text-align:center">body_text_clean</th>
<th style="text-align:center">body_text_tokenised</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">I’ve been searching for the right words to thank you for this breather. I promise i wont take yo…</td>
<td style="text-align:center">Ive been searching for the right words to thank you for this breather I promise i wont take your…</td>
<td style="text-align:center">[ive, been, searching, for, the, right, words, to, thank, you, for, this, breather, i, promise, …</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">spam</td>
<td style="text-align:center">Free entry in 2 a wkly comp to win FA Cup final tkts 21st May 2005. Text FA to 87121 to receive …</td>
<td style="text-align:center">Free entry in 2 a wkly comp to win FA Cup final tkts 21st May 2005 Text FA to 87121 to receive e…</td>
<td style="text-align:center">[free, entry, in, 2, a, wkly, comp, to, win, fa, cup, final, tkts, 21st, may, 2005, text, fa, to…</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">Nah I don’t think he goes to usf, he lives around here though</td>
<td style="text-align:center">Nah I dont think he goes to usf he lives around here though</td>
<td style="text-align:center">[nah, i, dont, think, he, goes, to, usf, he, lives, around, here, though]</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">Even my brother is not like to speak with me. They treat me like aids patent.</td>
<td style="text-align:center">Even my brother is not like to speak with me They treat me like aids patent</td>
<td style="text-align:center">[even, my, brother, is, not, like, to, speak, with, me, they, treat, me, like, aids, patent]</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">I HAVE A DATE ON SUNDAY WITH WILL!!</td>
<td style="text-align:center">I HAVE A DATE ON SUNDAY WITH WILL</td>
<td style="text-align:center">[i, have, a, date, on, sunday, with, will]</td>
</tr>
</tbody>
</table>
<p>Example of case sensitive:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"NLP"</span> == <span class="string">"nlp"</span></span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>
<h3 id="removing-stop-words"><a class="markdownIt-Anchor" href="#removing-stop-words"></a> Removing Stop Words</h3>
<p>The last step in cleaning up this data is to remove stopwords.  Now we’ve discussed stopwords previously.  They are commonly-used words like the, but, if, that don’t contribute much to the meaning of a sentence.  So we want to remove them, to limit the number of tokens Python actually has to look at when building our model.  For instance, take the sentence,  I am learning NLP.  After tokenizing, it would have four tokens, I, am, learning, and NLP.  Then after removing stopwords, instead of a list with four tokens, you’re now left with just learning and NLP.  So it gets across the same message, and now, your machine learning model only has to look at half the number of tokens.</p>
<p>Get all stop words:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line"></span><br><span class="line">stopword = nltk.corpus.stopwords.words(<span class="string">"english"</span>)</span><br></pre></td></tr></table></figure>
<p>Remove all stop words:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove_stopwords</span><span class="params">(tokenised_list)</span>:</span></span><br><span class="line">    text = [word <span class="keyword">for</span> word <span class="keyword">in</span> tokenised_list <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> stopword]</span><br><span class="line">    <span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line">data[<span class="string">"body_text_nostop"</span>] = data[<span class="string">"body_text_tokenised"</span>].apply(<span class="keyword">lambda</span> x : remove_stopwords(x))</span><br><span class="line"></span><br><span class="line">data.head()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">label</th>
<th style="text-align:center">body_text</th>
<th style="text-align:center">body_text_clean</th>
<th style="text-align:center">body_text_tokenised</th>
<th style="text-align:center">body_text_nostop</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">I’ve been searching for the right words to thank you for this breather. I promise i wont take yo…</td>
<td style="text-align:center">Ive been searching for the right words to thank you for this breather I promise i wont take your…</td>
<td style="text-align:center">[ive, been, searching, for, the, right, words, to, thank, you, for, this, breather, i, promise, …</td>
<td style="text-align:center">[ive, searching, right, words, thank, breather, promise, wont, take, help, granted, fulfil, prom…</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">spam</td>
<td style="text-align:center">Free entry in 2 a wkly comp to win FA Cup final tkts 21st May 2005. Text FA to 87121 to receive …</td>
<td style="text-align:center">Free entry in 2 a wkly comp to win FA Cup final tkts 21st May 2005 Text FA to 87121 to receive e…</td>
<td style="text-align:center">[free, entry, in, 2, a, wkly, comp, to, win, fa, cup, final, tkts, 21st, may, 2005, text, fa, to…</td>
<td style="text-align:center">[free, entry, 2, wkly, comp, win, fa, cup, final, tkts, 21st, may, 2005, text, fa, 87121, receiv…</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">Nah I don’t think he goes to usf, he lives around here though</td>
<td style="text-align:center">Nah I dont think he goes to usf he lives around here though</td>
<td style="text-align:center">[nah, i, dont, think, he, goes, to, usf, he, lives, around, here, though]</td>
<td style="text-align:center">[nah, dont, think, goes, usf, lives, around, though]</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">Even my brother is not like to speak with me. They treat me like aids patent.</td>
<td style="text-align:center">Even my brother is not like to speak with me They treat me like aids patent</td>
<td style="text-align:center">[even, my, brother, is, not, like, to, speak, with, me, they, treat, me, like, aids, patent]</td>
<td style="text-align:center">[even, brother, like, speak, treat, like, aids, patent]</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">I HAVE A DATE ON SUNDAY WITH WILL!!</td>
<td style="text-align:center">I HAVE A DATE ON SUNDAY WITH WILL</td>
<td style="text-align:center">[i, have, a, date, on, sunday, with, will]</td>
<td style="text-align:center">[date, sunday]</td>
</tr>
</tbody>
</table>
<p>So now we have a cleaned column that has been tokenised, we’ve removed the punctuation and we’ve removed the stopwords.  So that is a very abbreviated look at what a pre-processing pipeline looks like as you’re preparing to get your raw text into a format that a machine learning model can actually use. In the next chapter, we’ll explore some extra, slightly more advanced cleaning techniques and concepts that we can apply to our text to further help a machine learning model focus on the things that are really important.</p>
<h1 id="supplemental-data-cleaning"><a class="markdownIt-Anchor" href="#supplemental-data-cleaning"></a> Supplemental Data Cleaning</h1>
<h2 id="introducting-stemming"><a class="markdownIt-Anchor" href="#introducting-stemming"></a> Introducting Stemming</h2>
<p>The formal definition of stemming is the process of reducing inflected or derived words to their word stem or root.  More simply put, the process of stemming means often crudely chopping off the end of a word, to leave only the base.  So this means taking words with various suffixes and condensing them under the same root word.  Recall when we removed stop words, it was to reduce the number of words Python has to look at or consider.  Stemming is shooting for the same goal by reducing variations of the same root word.</p>
<p>Examples:</p>
<table>
<thead>
<tr>
<th style="text-align:center">before</th>
<th style="text-align:center">after</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Stemming / stemmed</td>
<td style="text-align:center">Stem</td>
</tr>
<tr>
<td style="text-align:center">Electricity / electrical</td>
<td style="text-align:center">Electr</td>
</tr>
<tr>
<td style="text-align:center">Berries / berry</td>
<td style="text-align:center">berri</td>
</tr>
<tr>
<td style="text-align:center">Connection / connected / connective</td>
<td style="text-align:center">Connect</td>
</tr>
</tbody>
</table>
<p>So this seems pretty useful, but stemming uses very crude rules, so it isn’t perfect.  For instance, look at meaning and meanness.  These words aren’t really all that closely related, but they’ll be both stripped down to a base of mean.  And thus Python will think that meanness and meaning are the same exact thing.  So stemmers are correct in most cases, but the trade-off with these simple rules is that it won’t always be right.</p>
<p>So this all seems interesting, but why do we really care about this?  Why does this actually help us for model building?  If Python sees grew, grow, and growing as three separate things, that means it has to keep those three separate words in memory.  Imagine every variation of every root word.  Maybe we have a thousand root words, but in our corpus, we have two thousand total words with every suffix added to the root words.  The alternative in this grew, grow, and growing example is applying the stemmer, and now it only has to know what grow means, as each variation of grow is replaced simply by grow.  So Python has to look at a lot more tokens without a stemmer and it doesn’t know that these separate tokens are even related.  So the benefits of a stemmer is <strong>it reduces the corpus of words the model is exposed to</strong>, so it’s just grow, instead of grew, grow, and growing, and <strong>it explicitly correlates words with similar meaning</strong>.  So Python could learn through the training process that we’ll discuss later, that grow, grew, and growing are similar in meaning, but it also may not, it depends on a lot of different factors.  In this case, we’re not leaving it up to Python.  We’re being explicit by replacing similar words with just one common root word.  There are a number of different types of stemmers that use various algorithms and methods to generate the stemmed version of words.  A few that are included in the NLTK package are the <strong>Porter Stemmer, the Snowball Stemmer, the Lancaster Stemmer, and a Regex-Based Stemmer</strong>. We’ll be focusing on the most popular stemmer in this list, the <strong>Porter Stemmer</strong>.</p>
<h2 id="using-stemming"><a class="markdownIt-Anchor" href="#using-stemming"></a> Using Stemming</h2>
<p>To make the use of stemming, there are two stages.  First, we’ll test out the stemmer on specific words to understand how it works.  Then we’ll apply the stemmer on the SMS spam collection data set to further clean up our data.</p>
<p>Import package:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line"></span><br><span class="line">ps = nltk.PorterStemmer()</span><br></pre></td></tr></table></figure>
<p>First example of using the function:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(ps.stem(<span class="string">"grows"</span>))</span><br><span class="line">print(ps.stem(<span class="string">"growing"</span>))</span><br><span class="line">print(ps.stem(<span class="string">"grow"</span>))</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grow</span><br><span class="line">grow</span><br><span class="line">grow</span><br></pre></td></tr></table></figure>
<p>So that reduces them all to the proper root word of grow.  So now these three words can be treated as the same word, rather than Python seeing them as three distinctly different words.</p>
<p>We showed before how the stemmer isn’t perfect, where it stemmed both meaning and meanness down to mean, even though they don’t represent the same thing.  However, if you look at a different example that could be a little difficult, we’ll do run, running, and runner.  You could see how all three of these might be reduced down to just run. Even though the first two are actions and the last one describes a person.</p>
<p>Second example of using the function:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(ps.stem(<span class="string">"run"</span>))</span><br><span class="line">print(ps.stem(<span class="string">"running"</span>))</span><br><span class="line">print(ps.stem(<span class="string">"runner"</span>))</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">run</span><br><span class="line">run</span><br><span class="line">runner</span><br></pre></td></tr></table></figure>
<p>So the stemmer can actually tell that the first two are different than the last one in some way.  So stemmers certainly aren’t perfect, but they still do a pretty good job of identifying words that have the same meaning.</p>
<p>Let’s use it for our SMS Spam example!</p>
<p>Import packages and read the file:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">pd.set_option(<span class="string">'display.max_colwidth'</span>, <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">stopwords = nltk.corpus.stopwords.words(<span class="string">'english'</span>)</span><br><span class="line"></span><br><span class="line">data = pd.read_csv(<span class="string">"SMSSpamCollection.tsv"</span>, sep=<span class="string">'\t'</span>)</span><br><span class="line">data.columns = [<span class="string">'label'</span>, <span class="string">'body_text'</span>]</span><br><span class="line"></span><br><span class="line">data.head()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">label</th>
<th style="text-align:center">body_text</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">spam</td>
<td style="text-align:center">Free entry in 2 a wkly comp to win FA Cup final tkts 21st May 2005 Text FA to 87121 to receive …</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">Nah I dont think he goes to usf he lives around here though</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">Even my brother is not like to speak with me They treat me like aids patent.</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">I HAVE A DATE ON SUNDAY WITH WILL!!</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">As per your request ‘Melle Melle (Oru Minnaminunginte Nurungu Vettam)’ has been set as your call…</td>
</tr>
</tbody>
</table>
<p>Clean up text:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clean_text</span><span class="params">(text)</span>:</span></span><br><span class="line">    text = <span class="string">""</span>.join([word <span class="keyword">for</span> word <span class="keyword">in</span> text <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> string.punctuation])</span><br><span class="line">    tokens = re.split(<span class="string">'\W+'</span>, text)</span><br><span class="line">    text = [word <span class="keyword">for</span> word <span class="keyword">in</span> tokens <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> stopwords]</span><br><span class="line">    <span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line">data[<span class="string">'body_text_nostop'</span>] = data[<span class="string">'body_text'</span>].apply(<span class="keyword">lambda</span> x: clean_text(x.lower()))</span><br><span class="line"></span><br><span class="line">data.head()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">label</th>
<th style="text-align:center">body_text</th>
<th style="text-align:center">body_text_nostop</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">spam</td>
<td style="text-align:center">Free entry in 2 a wkly comp to win FA Cup final tkts 21st May 2005 Text FA to 87121 to receive …</td>
<td style="text-align:center">[free, entry, 2, wkly, comp, win, fa, cup, final, tkts, 21st, may, 2005, text, fa, 87121, receiv…</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">Nah I dont think he goes to usf he lives around here though</td>
<td style="text-align:center">[nah, dont, think, goes, usf, lives, around, though]</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">Even my brother is not like to speak with me They treat me like aids patent.</td>
<td style="text-align:center">[even, brother, like, speak, treat, like, aids, patent]</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">I HAVE A DATE ON SUNDAY WITH WILL!!</td>
<td style="text-align:center">[date, sunday]</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">As per your request ‘Melle Melle (Oru Minnaminunginte Nurungu Vettam)’ has been set as your call…</td>
<td style="text-align:center">[per, request, melle, melle, oru, minnaminunginte, nurungu, vettam, set, callertune, callers, pr…</td>
</tr>
</tbody>
</table>
<p>We saw that the ps.stem method is what stems each word.  So the column that we’ll be operating on from this data frame is this tokenized list.  So we’ll want to iterate through the list and stem each word and then return the stemmed version back to the list.  So this should be starting to sound familiar at this point.  We’ll again write our own function using ps.stem within list comprehension in order to stem each word.</p>
<p>The following code is the way to stem the text:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stemming</span><span class="params">(tokenised_text)</span>:</span></span><br><span class="line">    text = [ps.stem(word) <span class="keyword">for</span> word <span class="keyword">in</span> tokenised_text]</span><br><span class="line">    <span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line">data[<span class="string">"body_text_stemmed"</span>] = data[<span class="string">"body_text_nostop"</span>].apply(<span class="keyword">lambda</span> x : stemming(x))</span><br><span class="line"></span><br><span class="line">data.head()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">label</th>
<th style="text-align:center">body_text</th>
<th style="text-align:center">body_text_nostop</th>
<th style="text-align:center">body_text_stemmed</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">spam</td>
<td style="text-align:center">Free entry in 2 a wkly comp to win FA Cup final tkts 21st May 2005 Text FA to 87121 to receive …</td>
<td style="text-align:center">[free, entry, 2, wkly, comp, win, fa, cup, final, tkts, 21st, may, 2005, text, fa, 87121, receiv…</td>
<td style="text-align:center">[free, entri, 2, wkli, comp, win, fa, cup, final, tkt, 21st, may, 2005, text, fa, 87121, receiv,…</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">Nah I dont think he goes to usf he lives around here though</td>
<td style="text-align:center">[nah, dont, think, goes, usf, lives, around, though]</td>
<td style="text-align:center">[nah, dont, think, goe, usf, live, around, though]</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">Even my brother is not like to speak with me They treat me like aids patent.</td>
<td style="text-align:center">[even, brother, like, speak, treat, like, aids, patent]</td>
<td style="text-align:center">[even, brother, like, speak, treat, like, aid, patent]</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">I HAVE A DATE ON SUNDAY WITH WILL!!</td>
<td style="text-align:center">[date, sunday]</td>
<td style="text-align:center">[date, sunday]</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">As per your request ‘Melle Melle (Oru Minnaminunginte Nurungu Vettam)’ has been set as your call…</td>
<td style="text-align:center">[per, request, melle, melle, oru, minnaminunginte, nurungu, vettam, set, callertune, callers, pr…</td>
<td style="text-align:center">[per, request, mell, mell, oru, minnaminungint, nurungu, vettam, set, callertun, caller, press, …</td>
</tr>
</tbody>
</table>
<p>Now it’s worth noting that the stemmer won’t do a great job with slang or abbreviations.  So it’s probably not a great fit for a text message data set.  To be noticed that entry is changed to entri with an i so it could also accommodate plural, entries.  Same thing with wkli.  Another one is on the second line, lives is reduced down to live.  So, we know what stemming represents, and how to actually apply it.  Stemming helps us reduce the corpus of words that the models are exposed to, and it explicitly correlates words with similar meaning.</p>
<h2 id="introducting-lemmatising"><a class="markdownIt-Anchor" href="#introducting-lemmatising"></a> Introducting Lemmatising</h2>
<p>The formal definition is that it’s the process of grouping together the inflected forms of a word so they can be analyzed as a single term, identified by the word’s lemma.  The lemma is the canonical form of a set of words.  For instance, type, typed, and typing would all be forms of the same lemma.  More simply put, lemmatising is using vocabulary analysis of words to remove inflectional endings and return to the dictionary form of a word.  So again, type, typed, and typing would all be simplified down to type, because that’s the root of the word.  Each variation carries the same meaning just with slightly different tense.  So you might be thinking that that sounds an awful lot like stemming, and you wouldn’t be wrong.  They are aiming to accomplish the same thing, but they are doing it in just slightly different ways.  And in practical terms, there’s an accuracy and speed trade-off that you’re making when you opt for one over the other.</p>
<p>The goal of both is to condense derived words down into their base form, to reduce the corpus of words that the model’s exposed to, and to explicitly correlate words with similar meaning.  The difference is that stemming takes a more crude approach by just chopping off the ending of a word using heuristics, without any understanding of the context in which a word is used.  Because of that, stemming may or may not return an actual word in the dictionary.  And it’s usually less accurate, but the benefit is that it’s faster because the rules are quite simple.  lemmatising leverages more informed analysis to create groups of words with similar meaning based on the context around the word, part of speech, and other factors.  lemmatisers will always return a dictionary word.  And because of the additional context it’s considered, this is typically more accurate.  But the downside is that it may be more computationally expensive.  So this is a very brief introduction into lemmatising.</p>
<h2 id="using-lemmatising"><a class="markdownIt-Anchor" href="#using-lemmatising"></a> Using Lemmatising</h2>
<p>To make the use of Lemmatising, there are two stages.  First, we’re going to test out the lemmatiser on specific words to understand how it works and then we’ll apply it on the SMS Spam Collection Data Set to further clean it up.  So the same process that we saw on the stemming notebook.  Just like we saw with stemmers, there are a few different lemmatisers as well that handle words in slightly different ways.  So we’re going to use the WordNet lemmatiser. This is probably the most popular lemmatiser.  WordNet is a collection of nouns, verbs, adjective and adverbs that are grouped together in sets of synonyms, each expressing a distinct concept.  This lemmatiser runs off of this corpus of synonyms, so given a word, it will track that word to its synonyms, and then the distinct concept that that group of words represents.</p>
<h3 id="test-out-wordnet-lemmatiser-read-more-about-wordnet-here"><a class="markdownIt-Anchor" href="#test-out-wordnet-lemmatiser-read-more-about-wordnet-here"></a> Test out WordNet lemmatiser (read more about WordNet <a href="https://wordnet.princeton.edu/" target="_blank" rel="noopener">here</a>)</h3>
<p>Import the nltk package and apply both lemmatiser and stemmer function:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line"></span><br><span class="line">wn = nltk.WordNetlemmatiser()</span><br><span class="line">ps = nltk.PorterStemmer()</span><br></pre></td></tr></table></figure>
<h3 id="comparation-between-lemmatiser-and-stemmer"><a class="markdownIt-Anchor" href="#comparation-between-lemmatiser-and-stemmer"></a> Comparation between Lemmatiser and Stemmer</h3>
<h4 id="first-example"><a class="markdownIt-Anchor" href="#first-example"></a> First Example</h4>
<p>Stemmer:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(ps.stem(<span class="string">"meanness"</span>))</span><br><span class="line">print(ps.stem(<span class="string">"meaning"</span>))</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mean</span><br><span class="line">mean</span><br></pre></td></tr></table></figure>
<p>As we have mentioned that, meanness and meaning are different but stemmer still cuts off and return root words for both words.</p>
<p>Lemmartiser:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(wn.lemmatise(<span class="string">"meanness"</span>))</span><br><span class="line">print(wn.lemmatise(<span class="string">"meaning"</span>))</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">meanness</span><br><span class="line">meaning</span><br></pre></td></tr></table></figure>
<p>Two things need to be highlighted here.  First, stemming uses the algorithmic approach so it’s only concerned with the string that it’s given, and it will essentially chop off the suffix.  lemmatising is a little bit more complex in that it searches the corpus to find related words and condense it down to the core concept.  The problem is that if this word isn’t in the corpus, then it will just return the original word, so that’s what’s happening in this example.  With that said, not condensing it in this case is probably better than incorrectly stemming it using the Porter stemmer.</p>
<h4 id="second-example"><a class="markdownIt-Anchor" href="#second-example"></a> Second Example</h4>
<p>Stemmer:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(ps.stem(<span class="string">"goose"</span>))</span><br><span class="line">print(ps.stem(<span class="string">"geese"</span>))</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">goos</span><br><span class="line">gees</span><br></pre></td></tr></table></figure>
<p>You can see that the stemmer doesn’t quite know what to do here with goose and geese so it returns two different root words. So again, Python will still view goose and geese as two different things even if you use the stemmer.</p>
<p>Lemmartiser:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(wn.lemmatise(<span class="string">"goose"</span>))</span><br><span class="line">print(wn.lemmatise(<span class="string">"geese"</span>))</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">goose</span><br><span class="line">goose</span><br></pre></td></tr></table></figure>
<p>You can see that the lemmatiser correctly maps both of these back to goose.  Python will then be able to now realize that these are the same words, so a lemmatiser can be quite powerful in some relatively complex situations.</p>
<h3 id="apply-lammatiser-to-sms-spam-collection-data"><a class="markdownIt-Anchor" href="#apply-lammatiser-to-sms-spam-collection-data"></a> Apply lammatiser to SMS Spam Collection Data</h3>
<p>Read the text file:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">pd.set_option(<span class="string">'display.max_colwidth'</span>, <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">stopwords = nltk.corpus.stopwords.words(<span class="string">'english'</span>)</span><br><span class="line"></span><br><span class="line">data = pd.read_csv(<span class="string">"SMSSpamCollection.tsv"</span>, sep=<span class="string">'\t'</span>)</span><br><span class="line">data.columns = [<span class="string">'label'</span>, <span class="string">'body_text'</span>]</span><br><span class="line"></span><br><span class="line">data.head()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">label</th>
<th style="text-align:center">body_text</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">spam</td>
<td style="text-align:center">Free entry in 2 a wkly comp to win FA Cup final tkts 21st May 2005 Text FA to 87121 to receive …</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">Nah I dont think he goes to usf he lives around here though</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">Even my brother is not like to speak with me They treat me like aids patent.</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">I HAVE A DATE ON SUNDAY WITH WILL!!</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">As per your request ‘Melle Melle (Oru Minnaminunginte Nurungu Vettam)’ has been set as your call…</td>
</tr>
</tbody>
</table>
<p>Clean up text:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clean_text</span><span class="params">(text)</span>:</span></span><br><span class="line">    text = <span class="string">""</span>.join([word <span class="keyword">for</span> word <span class="keyword">in</span> text <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> string.punctuation])</span><br><span class="line">    tokens = re.split(<span class="string">'\W+'</span>, text)</span><br><span class="line">    text = [word <span class="keyword">for</span> word <span class="keyword">in</span> tokens <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> stopwords]</span><br><span class="line">    <span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line">data[<span class="string">'body_text_nostop'</span>] = data[<span class="string">'body_text'</span>].apply(<span class="keyword">lambda</span> x: clean_text(x.lower()))</span><br><span class="line"></span><br><span class="line">data.head()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">label</th>
<th style="text-align:center">body_text</th>
<th style="text-align:center">body_text_nostop</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">spam</td>
<td style="text-align:center">Free entry in 2 a wkly comp to win FA Cup final tkts 21st May 2005 Text FA to 87121 to receive …</td>
<td style="text-align:center">[free, entry, 2, wkly, comp, win, fa, cup, final, tkts, 21st, may, 2005, text, fa, 87121, receiv…</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">Nah I dont think he goes to usf he lives around here though</td>
<td style="text-align:center">[nah, dont, think, goes, usf, lives, around, though]</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">Even my brother is not like to speak with me They treat me like aids patent.</td>
<td style="text-align:center">[even, brother, like, speak, treat, like, aids, patent]</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">I HAVE A DATE ON SUNDAY WITH WILL!!</td>
<td style="text-align:center">[date, sunday]</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">As per your request ‘Melle Melle (Oru Minnaminunginte Nurungu Vettam)’ has been set as your call…</td>
<td style="text-align:center">[per, request, melle, melle, oru, minnaminunginte, nurungu, vettam, set, callertune, callers, pr…</td>
</tr>
</tbody>
</table>
<p>Lemmatise text using body_text_nostop data:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lemmatising</span><span class="params">(tokenised_text)</span>:</span></span><br><span class="line">    text = [wn.lemmatise(word) <span class="keyword">for</span> word <span class="keyword">in</span> tokenised_text]</span><br><span class="line">    <span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line">data[<span class="string">"body_text_lammatised"</span>] = data[<span class="string">"body_text_nostop"</span>].apply(<span class="keyword">lambda</span> x : lemmatising(x))</span><br><span class="line"></span><br><span class="line">data.head(<span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">label</th>
<th style="text-align:center">body_text</th>
<th style="text-align:center">body_text_nostop</th>
<th style="text-align:center">body_text_lammatised</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">spam</td>
<td style="text-align:center">Free entry in 2 a wkly comp to win FA Cup final tkts 21st May 2005 Text FA to 87121 to receive …</td>
<td style="text-align:center">[free, entry, 2, wkly, comp, win, fa, cup, final, tkts, 21st, may, 2005, text, fa, 87121, receiv…</td>
<td style="text-align:center">[free, entry, 2, wkly, comp, win, fa, cup, final, tkts, 21st, may, 2005, text, fa, 87121, receiv…</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">Nah I dont think he goes to usf he lives around here though</td>
<td style="text-align:center">[nah, dont, think, goes, usf, lives, around, though]</td>
<td style="text-align:center">[nah, dont, think, go, usf, life, around, though]</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">Even my brother is not like to speak with me They treat me like aids patent.</td>
<td style="text-align:center">[even, brother, like, speak, treat, like, aids, patent]</td>
<td style="text-align:center">[even, brother, like, speak, treat, like, aid, patent]</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">I HAVE A DATE ON SUNDAY WITH WILL!!</td>
<td style="text-align:center">[date, sunday]</td>
<td style="text-align:center">[date, sunday]</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">As per your request ‘Melle Melle (Oru Minnaminunginte Nurungu Vettam)’ has been set as your call…</td>
<td style="text-align:center">[per, request, melle, melle, oru, minnaminunginte, nurungu, vettam, set, callertune, callers, pr…</td>
<td style="text-align:center">[per, request, melle, melle, oru, minnaminunginte, nurungu, vettam, set, callertune, caller, pre…</td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:center">spam</td>
<td style="text-align:center">WINNER!! As a valued network customer you have been selected to receivea £900 prize reward! To c…</td>
<td style="text-align:center">[winner, valued, network, customer, selected, receivea, 900, prize, reward, claim, call, 0906170…</td>
<td style="text-align:center">[winner, valued, network, customer, selected, receivea, 900, prize, reward, claim, call, 0906170…</td>
</tr>
<tr>
<td style="text-align:center">6</td>
<td style="text-align:center">spam</td>
<td style="text-align:center">Had your mobile 11 months or more? U R entitled to Update to the latest colour mobiles with came…</td>
<td style="text-align:center">[mobile, 11, months, u, r, entitled, update, latest, colour, mobiles, camera, free, call, mobile…</td>
<td style="text-align:center">[mobile, 11, month, u, r, entitled, update, latest, colour, mobile, camera, free, call, mobile, …</td>
</tr>
<tr>
<td style="text-align:center">7</td>
<td style="text-align:center">ham</td>
<td style="text-align:center">I’m gonna be home soon and i don’t want to talk about this stuff anymore tonight, k? I’ve cried …</td>
<td style="text-align:center">[im, gonna, home, soon, dont, want, talk, stuff, anymore, tonight, k, ive, cried, enough, today]</td>
<td style="text-align:center">[im, gonna, home, soon, dont, want, talk, stuff, anymore, tonight, k, ive, cried, enough, today]</td>
</tr>
<tr>
<td style="text-align:center">8</td>
<td style="text-align:center">spam</td>
<td style="text-align:center">SIX chances to win CASH! From 100 to 20,000 pounds txt&gt; CSH11 and send to 87575. Cost 150p/day, …</td>
<td style="text-align:center">[six, chances, win, cash, 100, 20000, pounds, txt, csh11, send, 87575, cost, 150pday, 6days, 16,…</td>
<td style="text-align:center">[six, chance, win, cash, 100, 20000, pound, txt, csh11, send, 87575, cost, 150pday, 6days, 16, t…</td>
</tr>
<tr>
<td style="text-align:center">9</td>
<td style="text-align:center">spam</td>
<td style="text-align:center">URGENT! You have won a 1 week FREE membership in our £100,000 Prize Jackpot! Txt the word: CLAIM…</td>
<td style="text-align:center">[urgent, 1, week, free, membership, 100000, prize, jackpot, txt, word, claim, 81010, tc, wwwdbuk…</td>
<td style="text-align:center">[urgent, 1, week, free, membership, 100000, prize, jackpot, txt, word, claim, 81010, tc, wwwdbuk…</td>
</tr>
</tbody>
</table>
<p>Just like the stemmer, the lemmatiser won’t do particularly well with slang or abbreviations, so it’s not ideal for this data set.  It might be much more effective if it was used on a collection of book reports or journal articles.  There are a couple things that the lemmatiser was able to impact.  It transitioned this lives down into life, and it also transitioned mobiles into mobile, and so you’ll notice that these aren’t super interesting examples necessarily, but as you saw above, the lemmatiser can do some relatively sophisticated things, at least more sophisticated than the stemmer.  Now you’ve learned what lemmatising is, and how to actually apply it, so both stemming and lemmatising helps us reduce the corpus of words that the model is exposed to, and it explicitly correlates words with similar meaning.  The lemmatiser is typically more accurate than the stemmer but the trade-off is that it takes a little bit longer to run.  Based on your machine learning pipeline, if the lemmatiser is going to be a bottleneck, then you may opt for the more simple stemmer.</p>
<h1 id="vectorising-raw-data"><a class="markdownIt-Anchor" href="#vectorising-raw-data"></a> Vectorising Raw Data</h1>
<h2 id="introducing-vectorising"><a class="markdownIt-Anchor" href="#introducing-vectorising"></a> Introducing Vectorising</h2>
<p>The process that we use to convert text to a form that Python and a machine learning model can understand is called vectorizing.  This is defined as the process of encoding text as integers to create feature vectors.  Now if you don’t have much machine learning experience, you may be wondering what a feature vector is.  A feature vector is an n-dimensional vector of numerical features that represent some object.  So in our context, that means we’ll be taking an individual text message and converting it to a numeric vector that represents that text message.</p>
<p>Based on the following example, what we’re doing when we vectorize text is we’re taking this dataset that has one line per document with the cell entry as the actual text message and then we’re converting it to a matrix that still has one line per document, but then you have every word used across all documents as the columns of your matrix.  And then within each cell is counting how many times that certain word appeared in that document.  And this is called your document term matrix.  We’ll be referring to this term quite a bit.  Then once we have this numeric representation of each text message, then we can carry on down the pipeline and fit and train a model.</p>
<table>
<thead>
<tr>
<th style="text-align:center">body_text</th>
<th style="text-align:center">call</th>
<th style="text-align:center">claim</th>
<th style="text-align:center">free</th>
<th style="text-align:center">txt</th>
<th style="text-align:center">label</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Free entry in 2 a wkly comp to win FA Cup final tkts 21st May 2005 Text FA to 87121 to receive …</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">spam</td>
</tr>
<tr>
<td style="text-align:center">Nah I dont think he goes to usf he lives around here though</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">ham</td>
</tr>
<tr>
<td style="text-align:center">Even my brother is not like to speak with me They treat me like aids patent.</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">ham</td>
</tr>
<tr>
<td style="text-align:center">I HAVE A DATE ON SUNDAY WITH WILL!!</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">ham</td>
</tr>
<tr>
<td style="text-align:center">As per your request ‘Melle Melle (Oru Minnaminunginte Nurungu Vettam)’ has been set as your call…</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">ham</td>
</tr>
<tr>
<td style="text-align:center">WINNER!! As a valued network customer you have been selected to receivea £900 prize reward! To c…</td>
<td style="text-align:center">1</td>
<td style="text-align:center">2</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">spam</td>
</tr>
<tr>
<td style="text-align:center">Had your mobile 11 months or more? U R entitled to Update to the latest colour mobiles with came…</td>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">2</td>
<td style="text-align:center">0</td>
<td style="text-align:center">spam</td>
</tr>
<tr>
<td style="text-align:center">I’m gonna be home soon and i don’t want to talk about this stuff anymore tonight, k? I’ve cried …</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">ham</td>
</tr>
<tr>
<td style="text-align:center">SIX chances to win CASH! From 100 to 20,000 pounds txt&gt; CSH11 and send to 87575. Cost 150p/day, …</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">spam</td>
</tr>
<tr>
<td style="text-align:center">URGENT! You have won a 1 week FREE membership in our £100,000 Prize Jackpot! Txt the word: CLAIM…</td>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">spam</td>
</tr>
</tbody>
</table>
<p>To understand the motivation behind this process, as we mentioned previously that when looking at a word, Python only sees characters.  So we need to convert this into a format that Python can understand in order for our machine learning models to start to learn what certain words indicate about the overall sentence or document or label that we’re trying to predict.  So we vectorize this text to create a matrix that only has numeric entries.  So in our case, counting how many times each word appears in each text message.  The machine learning algorithm understands these counts.  So if it sees a one or a two or a three in a cell, then that model can start to correlate that with whatever we’re trying to predict.  In our case, that’s spam.  To roughly understand then, what the words, sentences, and documents represent.  So in our context, this means it can use how frequently these certain words appear to determine whether the individual text message is spam or not.</p>
<p>Let’s classify the following document term matrix each as either spam or ham.  We’re just focusing on two words here used in text messages, offer and lol, along with the label of either spam or ham.  So that’s what this looks like after vectorizing.  Now how does a machine learning model use this information to learn what these words mean?  It was mentioned before that by looking at the counts in the cells, that it can start to correlate which words happen in combination with certain labels.</p>
<p>Original:</p>
<table>
<thead>
<tr>
<th style="text-align:center">id</th>
<th style="text-align:center">offer</th>
<th style="text-align:center">lol</th>
<th style="text-align:center">label</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">4</td>
<td style="text-align:center">ham</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">ham</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">4</td>
<td style="text-align:center">0</td>
<td style="text-align:center">spam</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">1</td>
<td style="text-align:center">2</td>
<td style="text-align:center">ham</td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:center">2</td>
<td style="text-align:center">0</td>
<td style="text-align:center">spam</td>
</tr>
<tr>
<td style="text-align:center">6</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">spam</td>
</tr>
</tbody>
</table>
<p>So let’s isolate just the non-spam messages in following table. You can start to notice that offer occurs very infrequently, but lol occurs in a lot of these non-spam text messages.  From the numbers here, the model could pretty easily pick up on the fact that lol occurs quite frequently with non-spam text messages and offer occurs very infrequently.  You could see how this would allow a model to start to learn how to predict when a text is spam or not, based just on the text body.</p>
<p>Filtered ham:</p>
<table>
<thead>
<tr>
<th style="text-align:center">id</th>
<th style="text-align:center">offer</th>
<th style="text-align:center">lol</th>
<th style="text-align:center">label</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">4</td>
<td style="text-align:center">ham</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">ham</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">1</td>
<td style="text-align:center">2</td>
<td style="text-align:center">ham</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<p>So now, let’s do the same thing, but we’ll jump over to the spam messages in the following table. You can pretty quickly notice that it’s the opposite.  Offer occurs quite frequently, while lol occurs quite infrequently.  So the model would pick up on the fact that offer occurs quite frequently in spam messages and lol occurs quite infrequently.</p>
<p>Filtered spam:</p>
<table>
<thead>
<tr>
<th style="text-align:center">id</th>
<th style="text-align:center">offer</th>
<th style="text-align:center">lol</th>
<th style="text-align:center">label</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">4</td>
<td style="text-align:center">0</td>
<td style="text-align:center">spam</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:center">2</td>
<td style="text-align:center">0</td>
<td style="text-align:center">spam</td>
</tr>
<tr>
<td style="text-align:center">6</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">spam</td>
</tr>
</tbody>
</table>
<p>So now, only considering these two words, the model has learned that offer occurs frequently with spam and infrequently with non-spam, while lol occurs frequently with non-spam and infrequently with spam.  So you could see how maybe with even just these two words, the model could start making ham or spam predictions about new text messages based only on the number of times these two words occur.  With that said, this is an extremely simple and exaggerated example for the purpose of illustration.  In reality, the model would need to learn the relationships of much more than two words to make an accurate prediction. But this example was meant to show how vectorizing helps the model roughly learn what words correlate with which labels.</p>
<p>So far, the post been talking about the entry of each cell in the document term matrix containing the count of how many times a given word appears in that text message, but that’s only one method of vectorization.  And that’s called, not surprisingly, count vectorization.  There are two other variations of count vectorization called N-grams and term frequency - inverse document frequency, which is often referred to as TF-IDF.  We’re going to cover each of these three methods of vectorization in more detail.</p>
<p>All three of these methods will generate very similar document-term matrices where there’s one line per document, or text message in our case, and then the columns will represent each word or potentially a combination of words. The main difference between the three is what’s in the actual cells of the matrix. So we’ll start with count vectorization.</p>
<h2 id="count-vectorisation"><a class="markdownIt-Anchor" href="#count-vectorisation"></a> Count Vectorisation</h2>
<p>Count vectorization creates the document-term matrix and then simply counts the number of times each word appears in that given document, or text message in our case, and that’s what’s stored in the given cell, so it’s pretty straight forward.</p>
<p>We’re going to use our SMSSpamCollection dataset, and then we’ll build a function to clean it up.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line">pd.set_option(<span class="string">'display.max_colwidth'</span>, <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">stopwords = nltk.corpus.stopwords.words(<span class="string">'english'</span>)</span><br><span class="line">ps = nltk.PorterStemmer()</span><br><span class="line"></span><br><span class="line">data = pd.read_csv(<span class="string">"SMSSpamCollection.tsv"</span>, sep=<span class="string">'\t'</span>)</span><br><span class="line">data.columns = [<span class="string">'label'</span>, <span class="string">'body_text'</span>]</span><br></pre></td></tr></table></figure>
<p>Create function to remove punctuation, tokenize, remove stopwords, and stem:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clean_text</span><span class="params">(text)</span>:</span></span><br><span class="line">    text = <span class="string">""</span>.join([word.lower() <span class="keyword">for</span> word <span class="keyword">in</span> text <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> string.punctuation])</span><br><span class="line">    tokens = re.split(<span class="string">'\W+'</span>, text)</span><br><span class="line">    text = [ps.stem(word) <span class="keyword">for</span> word <span class="keyword">in</span> tokens <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> stopwords]</span><br><span class="line">    <span class="keyword">return</span> text</span><br></pre></td></tr></table></figure>
<p>The difference here is, we’re not going to use a lambda function to apply it to our data, like we have in the past. The CountVectorizer actually allows you to pass in a function to clean and tokenize your data.</p>
<p>Apply CountVectorizer:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> CountVectorizer</span><br><span class="line"></span><br><span class="line"><span class="comment"># To allow us passing in the function that we created to clean up the text</span></span><br><span class="line"><span class="comment"># and it'll apply that function all at the same time that it's vectorizing the text.</span></span><br><span class="line">count_vect = CountVectorizer(analyzer = clean_text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># If we only fit it, it won't actually do anything to our data.</span></span><br><span class="line"><span class="comment"># It'll just train the vectorizer object to learn what words are in the corpus.</span></span><br><span class="line"><span class="comment"># So if we want to actually fit it, and then transform our data, in other words,</span></span><br><span class="line"><span class="comment"># if we want to fit the vectorizer,</span></span><br><span class="line"><span class="comment"># and then actually vectorize our data and turn them into feature vectors,</span></span><br><span class="line"><span class="comment"># then we'll need to call fit_transform, and that'll actually do the fitting and transform our data.</span></span><br><span class="line">X_counts = count_vect.fit_transform(data[<span class="string">"body_text"</span>])</span><br><span class="line"></span><br><span class="line">print(X_counts.shape)</span><br><span class="line">print(count_vect.get_feature_names())</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">5567</span>, <span class="number">8104</span>)</span><br><span class="line">[<span class="string">''</span>, <span class="string">'0'</span>, <span class="string">'008704050406'</span>, <span class="string">'0089mi'</span>, <span class="string">'0121'</span>, <span class="string">'01223585236'</span>, <span class="string">'01223585334'</span>, <span class="string">'0125698789'</span>, <span class="string">'02'</span>, <span class="string">'020603'</span>, <span class="string">'0207'</span>, <span class="string">'02070836089'</span>, <span class="string">'02072069400'</span>, <span class="string">'02073162414'</span>, <span class="string">'02085076972'</span>, <span class="string">'020903'</span>, <span class="string">'021'</span>, <span class="string">'050703'</span>, <span class="string">'0578'</span>, <span class="string">'06'</span>, <span class="string">'060505'</span>, <span class="string">'061104'</span>, <span class="string">'07008009200'</span>, <span class="string">'07046744435'</span>, <span class="string">'07090201529'</span>, <span class="string">'07090298926'</span>, <span class="string">'07099833605'</span>, <span class="string">'071104'</span>, <span class="string">'07123456789'</span>, <span class="string">'0721072'</span>, <span class="string">'07732584351'</span>, <span class="string">'07734396839'</span>, <span class="string">'07742676969'</span>, <span class="string">'07753741225'</span>, <span class="string">'0776xxxxxxx'</span>, <span class="string">'07786200117'</span>, <span class="string">'077xxx'</span>, <span class="string">'078'</span>, <span class="string">'07801543489'</span>, <span class="string">'07808'</span>, <span class="string">'07808247860'</span>, <span class="string">'07808726822'</span>, <span class="string">'07815296484'</span>, <span class="string">'07821230901'</span>, <span class="string">'0784987'</span>, <span class="string">'0789xxxxxxx'</span>, <span class="string">'0794674629107880867867'</span>, <span class="string">'0796xxxxxx'</span>, <span class="string">'07973788240'</span>, <span class="string">'07xxxxxxxxx'</span>, <span class="string">'0800'</span>, <span class="string">'08000407165'</span>, <span class="string">'08000776320'</span>, <span class="string">'08000839402'</span>, <span class="string">'08000930705'</span>, <span class="string">'08000938767'</span>, <span class="string">'08001950382'</span>...]</span><br></pre></td></tr></table></figure>
<p>This tell us there are 5567 text messages, and across those 5567 text messages, there are 8104 unique words, which means, our document-term matrix has 5567 rows and 8104 columns, and then the get_feature_names, basically means, here are the names of the columns of our document-term matrix.</p>
<p>Smaller example:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">data_sample = data[<span class="number">0</span>:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">count_vect_sample = CountVectorizer(analyzer = clean_text)</span><br><span class="line">X_counts_sample = count_vect_sample.fit_transform(data_sample[<span class="string">"body_text"</span>])</span><br><span class="line"></span><br><span class="line">print(X_counts_sample.shape)</span><br><span class="line">print(count_vect_sample.get_feature_names())</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">20</span>, <span class="number">192</span>)</span><br><span class="line">[<span class="string">'08002986030'</span>, <span class="string">'08452810075over18'</span>, <span class="string">'09061701461'</span>, <span class="string">'1'</span>, <span class="string">'100'</span>, <span class="string">'100000'</span>, <span class="string">'11'</span>, <span class="string">'12'</span>, <span class="string">'150pday'</span>, <span class="string">'16'</span>, <span class="string">'2'</span>, <span class="string">'20000'</span>, <span class="string">'2005'</span>, <span class="string">'21st'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>, <span class="string">'4403ldnw1a7rw18'</span>, <span class="string">'4txtú120'</span>, <span class="string">'6day'</span>, <span class="string">'81010'</span>, <span class="string">'87077'</span>, <span class="string">'87121'</span>, <span class="string">'87575'</span>, <span class="string">'9'</span>, <span class="string">'900'</span>, <span class="string">'aft'</span>, <span class="string">'aid'</span>, <span class="string">'alreadi'</span>, <span class="string">'alright'</span>, <span class="string">'anymor'</span>, <span class="string">'appli'</span>, <span class="string">'ard'</span>, <span class="string">'around'</span>, <span class="string">'b'</span>, <span class="string">'brother'</span>, <span class="string">'call'</span>, <span class="string">'caller'</span>, <span class="string">'callertun'</span>, <span class="string">'camera'</span>, <span class="string">'cash'</span>, <span class="string">'chanc'</span>, <span class="string">'claim'</span>, <span class="string">'click'</span>, <span class="string">'co'</span>, <span class="string">'code'</span>, <span class="string">'colour'</span>, <span class="string">'comin'</span>, <span class="string">'comp'</span>, <span class="string">'copi'</span>, <span class="string">'cost'</span>, <span class="string">'credit'</span>, <span class="string">'cri'</span>, <span class="string">'csh11'</span>, <span class="string">'cup'</span>, <span class="string">'custom'</span>, <span class="string">'da'</span>, <span class="string">'date'</span>, <span class="string">'dont'</span>, <span class="string">'eg'</span>, <span class="string">'eh'</span>, <span class="string">'england'</span>, <span class="string">'enough'</span>, <span class="string">'entitl'</span>, <span class="string">'entri'</span>, <span class="string">'even'</span>, <span class="string">'fa'</span>, <span class="string">'feel'</span>, <span class="string">'ffffffffff'</span>, <span class="string">'final'</span>, <span class="string">'fine'</span>, <span class="string">'finish'</span>, <span class="string">'first'</span>, <span class="string">'free'</span>, <span class="string">'friend'</span>, <span class="string">'go'</span>, <span class="string">'goalsteam'</span>, <span class="string">'goe'</span>, <span class="string">'gonna'</span>, <span class="string">'gota'</span>, <span class="string">'ha'</span>, <span class="string">'hl'</span>, <span class="string">'home'</span>, <span class="string">'hour'</span>, <span class="string">'httpwap'</span>, <span class="string">'im'</span>, <span class="string">'info'</span>, <span class="string">'ive'</span>, <span class="string">'jackpot'</span>, <span class="string">'joke'</span>, <span class="string">'k'</span>, <span class="string">'kim'</span>, <span class="string">'kl341'</span>, <span class="string">'lar'</span>, <span class="string">'latest'</span>, <span class="string">'lccltd'</span>, <span class="string">'like'</span>, <span class="string">'link'</span>, <span class="string">'live'</span>, <span class="string">'lor'</span>, <span class="string">'lunch'</span>, <span class="string">'macedonia'</span>, <span class="string">'make'</span>, <span class="string">'may'</span>, <span class="string">'meet'</span>, <span class="string">'mell'</span>, <span class="string">'membership'</span>, <span class="string">'messag'</span>, <span class="string">'minnaminungint'</span>, <span class="string">'miss'</span>, <span class="string">'mobil'</span>, <span class="string">'month'</span>, <span class="string">'nah'</span>, <span class="string">'name'</span>, <span class="string">'nation'</span>, <span class="string">'naughti'</span>, <span class="string">'network'</span>, <span class="string">'news'</span>, <span class="string">'next'</span>, <span class="string">'nurungu'</span>, <span class="string">'oh'</span>, <span class="string">'oru'</span>, <span class="string">'patent'</span>, <span class="string">'pay'</span>, <span class="string">'per'</span>, <span class="string">'pobox'</span>, <span class="string">'poboxox36504w45wq'</span>, <span class="string">'pound'</span>, <span class="string">'press'</span>, <span class="string">'prize'</span>, <span class="string">'questionstd'</span>, <span class="string">'r'</span>, <span class="string">'ratetc'</span>, <span class="string">'receiv'</span>, <span class="string">'receivea'</span>, <span class="string">'rememb'</span>, <span class="string">'repli'</span>, <span class="string">'request'</span>, <span class="string">'reward'</span>, <span class="string">'scotland'</span>, <span class="string">'select'</span>, <span class="string">'send'</span>, <span class="string">'serious'</span>, <span class="string">'set'</span>, <span class="string">'six'</span>, <span class="string">'smth'</span>, <span class="string">'soon'</span>, <span class="string">'sooner'</span>, <span class="string">'speak'</span>, <span class="string">'spell'</span>, <span class="string">'stock'</span>, <span class="string">'str'</span>, <span class="string">'stuff'</span>, <span class="string">'sunday'</span>, <span class="string">'talk'</span>, <span class="string">'tc'</span>, <span class="string">'team'</span>, <span class="string">'text'</span>, <span class="string">'think'</span>, <span class="string">'though'</span>, <span class="string">'tkt'</span>, <span class="string">'today'</span>, <span class="string">'tonight'</span>, <span class="string">'treat'</span>, <span class="string">'tri'</span>, <span class="string">'trywal'</span>, <span class="string">'tsandc'</span>, <span class="string">'txt'</span>, <span class="string">'u'</span>, <span class="string">'updat'</span>, <span class="string">'ur'</span>, <span class="string">'urgent'</span>, <span class="string">'use'</span>, <span class="string">'usf'</span>, <span class="string">'v'</span>, <span class="string">'valid'</span>, <span class="string">'valu'</span>, <span class="string">'vettam'</span>, <span class="string">'want'</span>, <span class="string">'wap'</span>, <span class="string">'watch'</span>, <span class="string">'way'</span>, <span class="string">'week'</span>, <span class="string">'wet'</span>, <span class="string">'win'</span>, <span class="string">'winner'</span>, <span class="string">'wkli'</span>, <span class="string">'word'</span>, <span class="string">'wwwdbuknet'</span>, <span class="string">'xxxmobilemovieclub'</span>, <span class="string">'xxxmobilemovieclubcomnqjkgighjjgcbl'</span>, <span class="string">'ye'</span>, <span class="string">'ü'</span>]</span><br></pre></td></tr></table></figure>
<p>Instead of 5,567 by 8,104, our matrix is just 20 rows by 192 columns, and here are the new feature names.  So there’s some numbers in there, but you can also see around, brother, call, caller.</p>
<p>One thing to be noted is that the raw data output of the CountVectorizer, is what’s called a Sparse Matrix.  So what is a Sparse Matrix?  when you have a matrix in which a very high percent of the entries are zero, as we do in this case, instead of storing all these zeros in the full matrix, which would make it extremely inefficient, it’ll just be converted to only storing the locations and the values of the non-zero elements, which is much more efficient for storage.</p>
<p>So if we just try and print out this X_counts_sample, you would’ve previously expected it just to give us our matrix, but instead, it’ll just say this is a sparse matrix object with 218 stored elements in the following example.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X_counts_sample</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="number">20</span>x192 sparse matrix of type <span class="string">'&lt;class '</span>numpy.int64<span class="string">'&gt;'</span></span><br><span class="line">	<span class="keyword">with</span> <span class="number">218</span> stored elements <span class="keyword">in</span> Compressed Sparse Row format&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X_counts_df = pd.DataFrame(X_counts_sample.toarray())</span><br><span class="line">X_counts_df</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">0</th>
<th style="text-align:right">1</th>
<th style="text-align:right">2</th>
<th style="text-align:right">3</th>
<th style="text-align:right">4</th>
<th style="text-align:right">5</th>
<th style="text-align:right">6</th>
<th style="text-align:right">7</th>
<th style="text-align:right">8</th>
<th style="text-align:right">9</th>
<th style="text-align:right">…</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">…</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">…</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">…</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">…</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">…</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">…</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">…</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">…</td>
</tr>
<tr>
<td style="text-align:right">8</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">…</td>
</tr>
<tr>
<td style="text-align:right">9</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">…</td>
</tr>
<tr>
<td style="text-align:right">10</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">…</td>
</tr>
<tr>
<td style="text-align:right">11</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">…</td>
</tr>
<tr>
<td style="text-align:right">12</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">…</td>
</tr>
<tr>
<td style="text-align:right">13</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">…</td>
</tr>
<tr>
<td style="text-align:right">14</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">…</td>
</tr>
<tr>
<td style="text-align:right">15</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">…</td>
</tr>
<tr>
<td style="text-align:right">16</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">…</td>
</tr>
<tr>
<td style="text-align:right">17</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">…</td>
</tr>
<tr>
<td style="text-align:right">18</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">…</td>
</tr>
<tr>
<td style="text-align:right">19</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">…</td>
</tr>
</tbody>
</table>
<p>20 rows × 192 columns</p>
<p>You’ll notice that the column names don’t contain the word they actually represent. They’re just numbered from zero to 191. Now again, for Python, this doesn’t really matter because it doesn’t know the difference between a column name of 5, and a column name of text. So it’s just going to learn from the entries in that column, and its relationship with our label, to figure out how it can contribute to the model.</p>
<p>To be able to see what words those columns actually represent:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X_counts_df.columns = count_vect_sample.get_feature_names()</span><br><span class="line">X_counts_df</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">…</th>
<th style="text-align:right">want</th>
<th style="text-align:right">wap</th>
<th style="text-align:right">watch</th>
<th style="text-align:right">way</th>
<th style="text-align:right">week</th>
<th style="text-align:right">wet</th>
<th style="text-align:right">win</th>
<th style="text-align:right">winner</th>
<th style="text-align:right">wkli</th>
<th style="text-align:right">word</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">…</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">…</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">…</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">…</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">…</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">…</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">…</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">…</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">8</td>
<td style="text-align:right">…</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">9</td>
<td style="text-align:right">…</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">10</td>
<td style="text-align:right">…</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">11</td>
<td style="text-align:right">…</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">12</td>
<td style="text-align:right">…</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">13</td>
<td style="text-align:right">…</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">2</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">14</td>
<td style="text-align:right">…</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">15</td>
<td style="text-align:right">…</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">16</td>
<td style="text-align:right">…</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">17</td>
<td style="text-align:right">…</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">18</td>
<td style="text-align:right">…</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">19</td>
<td style="text-align:right">…</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
</tbody>
</table>
<p>20 rows × 192 columns</p>
<p>Now you’ll see this is exactly the same data frame, now we just have the actual column names here.</p>
<h2 id="n-gram-vectorising"><a class="markdownIt-Anchor" href="#n-gram-vectorising"></a> N-gram Vectorising</h2>
<p>Creates a document-term matrix where counts still occupy the cell but instead of the columns representing single terms, they represent all combinations of adjacent words of length n in your text.</p>
<p>“NLP is an interesting topic”</p>
<table>
<thead>
<tr>
<th>n</th>
<th>Name</th>
<th>Tokens</th>
</tr>
</thead>
<tbody>
<tr>
<td>2</td>
<td>bigram</td>
<td>[“nlp is”, “is an”, “an interesting”, “interesting topic”]</td>
</tr>
<tr>
<td>3</td>
<td>trigram</td>
<td>[“nlp is an”, “is an interesting”, “an interesting topic”]</td>
</tr>
<tr>
<td>4</td>
<td>four-gram</td>
<td>[“nlp is an interesting”, “is an interesting topic”]</td>
</tr>
</tbody>
</table>
<p>The n-grams process creates a document-term matrix like we saw before.  Now we still have one row per text message and we still have counts that occupy the individual cells but instead of the columns representing single terms like we saw in the previous method, now they represent all combinations of adjacent words of length and in your text.  As the above example, let’s use the string NLP is an interesting topic.  This table shows how that would break down.  In n-grams if n equals two then that’s called the bigram and it’ll pull all combinations of two adjacent words in our string.  In NLP is an interesting topic, it will pull out four tokens, NLP is, is an, an interesting, interesting topic.  When n equals three that’s called trigrams.  It’ll pull all combinations of three adjacent words in our string.  We’ll create three tokens, NLP is an, is an interesting, and an interesting topic.  Again, when n equals four, that’s called a four-gram.  It’ll pull all combinations of four adjacent words in our string as you see here with these two tokens.  You can make n as large or as small as you’d like.  You could think of count vectorization as n-grams with n equal a two.  It’ll just pull out the unigrams.  When you use n-grams there’s usually an optimal n value or range that will yield the best performance.  Generally you’ll tune this value to see what generates the best model.  The value here is that you get a little more context around your words.  Rather than only seeing one word at a time, you’ll see two or three or four.  Just to tie this back to something that we talked about earlier, NLP in everyday life, Google’s auto complete uses an n-grams like approach.  If you type natural language into Google, it knows that a very regularly used trigram starting with natural language is natural language processing.  It might suggest that as a full phrase that you’d like to search for.</p>
<p>Read the data:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line">pd.set_option(<span class="string">'display.max_colwidth'</span>, <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">stopwords = nltk.corpus.stopwords.words(<span class="string">'english'</span>)</span><br><span class="line">ps = nltk.PorterStemmer()</span><br><span class="line"></span><br><span class="line">data = pd.read_csv(<span class="string">"SMSSpamCollection.tsv"</span>, sep=<span class="string">'\t'</span>)</span><br><span class="line">data.columns = [<span class="string">'label'</span>, <span class="string">'body_text'</span>]</span><br></pre></td></tr></table></figure>
<p>Create function to remove punctuation, tokenize, remove stopwords, and stem:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clean_text</span><span class="params">(text)</span>:</span></span><br><span class="line">    text = <span class="string">""</span>.join([word.lower() <span class="keyword">for</span> word <span class="keyword">in</span> text <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> string.punctuation])</span><br><span class="line">    tokens = re.split(<span class="string">'\W+'</span>, text)</span><br><span class="line">    text = <span class="string">" "</span>.join([ps.stem(word) <span class="keyword">for</span> word <span class="keyword">in</span> tokens <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> stopwords])</span><br><span class="line">    <span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line">data[<span class="string">'cleaned_text'</span>] = data[<span class="string">'body_text'</span>].apply(<span class="keyword">lambda</span> x: clean_text(x))</span><br><span class="line">data.head()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:left">label</th>
<th style="text-align:left">body_text</th>
<th style="text-align:left">cleaned_text</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:left">spam</td>
<td style="text-align:left">Free entry in 2 a wkly comp to win FA Cup final tkts 21st May 2005. Text FA to 87121 to receive entry question(std txt rate)T&amp;C’s apply 08452810075over18’s</td>
<td style="text-align:left">free entri 2 wkli comp win fa cup final tkt 21st may 2005 text fa 87121 receiv entri questionstd txt ratetc appli 08452810075over18</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:left">ham</td>
<td style="text-align:left">Nah I don’t think he goes to usf, he lives around here though</td>
<td style="text-align:left">nah dont think goe usf live around though</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:left">ham</td>
<td style="text-align:left">Even my brother is not like to speak with me. They treat me like aids patent.</td>
<td style="text-align:left">even brother like speak treat like aid patent</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:left">ham</td>
<td style="text-align:left">I HAVE A DATE ON SUNDAY WITH WILL!!</td>
<td style="text-align:left">date sunday</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:left">ham</td>
<td style="text-align:left">As per your request ‘Melle Melle (Oru Minnaminunginte Nurungu Vettam)’ has been set as your callertune for all Callers. Press *9 to copy your friends Callertune</td>
<td style="text-align:left">per request mell mell oru minnaminungint nurungu vettam set callertun caller press 9 copi friend callertun</td>
</tr>
</tbody>
</table>
<p>Apply CountVectorizer with N-Grams:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> CountVectorizer</span><br><span class="line"><span class="comment"># Only search for bigram (2, 2)</span></span><br><span class="line"><span class="comment"># if search both unigram and bigram, do (1, 2)</span></span><br><span class="line">ngram_vect = CountVectorizer(ngram_range = (<span class="number">2</span>, <span class="number">2</span>))</span><br><span class="line">X_counts = ngram_vect.fit_transform(data[<span class="string">"cleaned_text"</span>])</span><br><span class="line">print(X_counts.shape)</span><br><span class="line">print(ngram_vect.get_feature_names())</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">5567</span>, <span class="number">31260</span>)</span><br><span class="line">[<span class="string">'008704050406 sp'</span>, <span class="string">'0089mi last'</span>, <span class="string">'0121 2025050'</span>, <span class="string">'01223585236 xx'</span>, <span class="string">'01223585334 cum'</span>, <span class="string">'0125698789 ring'</span>, <span class="string">'02 user'</span>, <span class="string">'020603 2nd'</span>, <span class="string">'0207 153'</span>, <span class="string">'02072069400 bx'</span>, <span class="string">'02073162414 cost'</span>, <span class="string">'02085076972 repli'</span>, <span class="string">'020903 2nd'</span>, <span class="string">'021 3680'</span>, <span class="string">'021 3680offer'</span>, <span class="string">'050703 tcsbcm4235wc1n3xx'</span>, <span class="string">'06 good'</span>, <span class="string">'07046744435 arrang'</span>, <span class="string">'07090298926 reschedul'</span>, <span class="string">'07099833605 reschedul'</span>, <span class="string">'07123456789 87077'</span>, <span class="string">'0721072 find'</span>, <span class="string">'07732584351 rodger'</span>, ...]</span><br></pre></td></tr></table></figure>
<p>You can see that we still have the same 5,567 rows but now instead of the 8,000 that we saw before, you can seen that there’s over 31,000 columns.  That means 31,000 unique combinations of two words. In these feature names, you’ll see two-word combinations.</p>
<p>A smaller example:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">data_sample = data[<span class="number">0</span>:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Only search for bigram (2, 2)</span></span><br><span class="line"><span class="comment"># if search both unigram and bigram, do (1, 2)</span></span><br><span class="line">ngram_vect_sample = CountVectorizer(ngram_range = (<span class="number">2</span>, <span class="number">2</span>))</span><br><span class="line">X_counts_sample = ngram_vect_sample.fit_transform(data_sample[<span class="string">"cleaned_text"</span>])</span><br><span class="line">print(X_counts_sample.shape)</span><br><span class="line">print(ngram_vect_sample.get_feature_names())</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">20</span>, <span class="number">198</span>)</span><br><span class="line">[<span class="string">'09061701461 claim'</span>, <span class="string">'100 20000'</span>, <span class="string">'100000 prize'</span>, <span class="string">'11 month'</span>, <span class="string">'12 hour'</span>, <span class="string">'150pday 6day'</span>, <span class="string">'16 tsandc'</span>, <span class="string">'20000 pound'</span>, <span class="string">'2005 text'</span>, <span class="string">'21st may'</span>, <span class="string">'4txtú120 poboxox36504w45wq'</span>, <span class="string">'6day 16'</span>, <span class="string">'81010 tc'</span>, <span class="string">'87077 eg'</span>, <span class="string">'87077 trywal'</span>, <span class="string">'87121 receiv'</span>, <span class="string">'87575 cost'</span>, <span class="string">'900 prize'</span>, <span class="string">'aft finish'</span>, <span class="string">'aid patent'</span>, <span class="string">'alright way'</span>, <span class="string">'anymor tonight'</span>, <span class="string">'appli 08452810075over18'</span>, <span class="string">'appli repli'</span>, <span class="string">'ard smth'</span>, <span class="string">'around though'</span>, <span class="string">'brother like'</span>, <span class="string">'call 09061701461'</span>, <span class="string">'call mobil'</span>, <span class="string">'caller press'</span>, <span class="string">'callertun caller'</span>, <span class="string">'camera free'</span>, <span class="string">'cash 100'</span>, <span class="string">'chanc win'</span>, <span class="string">'claim 81010'</span>, <span class="string">'claim call'</span>, <span class="string">'claim code'</span>, <span class="string">'click httpwap'</span>, <span class="string">'click wap'</span>, <span class="string">'co free'</span>, <span class="string">'code kl341'</span>, <span class="string">'colour mobil'</span>, <span class="string">'comp win'</span>, <span class="string">'copi friend'</span>, <span class="string">'cost 150pday'</span>, <span class="string">'credit click'</span>, <span class="string">'cri enough'</span>, <span class="string">'csh11 send'</span>, <span class="string">'cup final'</span>, <span class="string">'custom select'</span>, <span class="string">'da stock'</span>, <span class="string">'date sunday'</span>, <span class="string">'dont miss'</span>, <span class="string">'dont think'</span>, <span class="string">'dont want'</span>, <span class="string">'eg england'</span>, <span class="string">'eh rememb'</span>, <span class="string">'england 87077'</span>, <span class="string">'england macedonia'</span>, <span class="string">'enough today'</span>, <span class="string">'entitl updat'</span>, <span class="string">'entri questionstd'</span>, <span class="string">'entri wkli'</span>, <span class="string">'even brother'</span>, <span class="string">'fa 87121'</span>, <span class="string">'fa cup'</span>, <span class="string">'feel way'</span>, ...]</span><br></pre></td></tr></table></figure>
<p>Instead of over 31,000 columns, now we’re back down to 198.  If you remember, that’s still higher than the 192 unigrams that we saw in our last notebook.  At this point, it’s worth noting that using this n-gram range can end up creating a matrix with a ton of features.  If you did an n-gram range of one comma two so that’s grabbing all the unigrams and bigrams.  In the previous session we saw that there are over 8,000 unigrams in the full data set and in this session we saw that there are 31,000 bigrams in the full sample.  Together that’s 39,000 columns that are only using unigrams and bigrams.  Imagine if we added trigrams on top of that.  Just be careful with the n-grams.  It’s definitely worth experimenting to see both what’s going to work within memory and which is going to help you generate the best model.</p>
<p>Vectorizers output sparse matrices:</p>
<p><em><strong>Sparse Matrix</strong>: A matrix in which most entries are 0. In the interest of efficient storage, a sparse matrix will be stored by only storing the locations of the non-zero elements.</em></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">X_counts_df = pd.DataFrame(X_counts_sample.toarray())</span><br><span class="line">X_counts_df.columns = ngram_vect_sample.get_feature_names()</span><br><span class="line">X_counts_df</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">vettam set</th>
<th style="text-align:right">want talk</th>
<th style="text-align:right">wap link</th>
<th style="text-align:right">way feel</th>
<th style="text-align:right">way gota</th>
<th style="text-align:right">way meet</th>
<th style="text-align:right">week free</th>
<th style="text-align:right">win cash</th>
<th style="text-align:right">win fa</th>
<th style="text-align:right">winner valu</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">8</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">9</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">10</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">11</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">12</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">13</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">14</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">15</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">16</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">17</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">18</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">19</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
</tbody>
</table>
<p>20 rows × 198 columns</p>
<p>This is a brief introduction to how you implement n-grams. The value to n-grams over regular count vectorization is that it provides a little bit more context around words. There is certainly a trade-off when you’re choosing your n value for your n-grams. If you select only bigrams, then maybe that’s not enough to provide useful context. If you go all the way up to sevengrams, you’re going to have a ton of features and you’ll only see the same sevengram, in other words, the same sequence of seven words maybe in one text message. In other words what that means is every column of sevengrams would be non zero in only one row and you’d have a massive matrix. N-grams can be powerful but they require a little bit more care in implementing.</p>
<h2 id="inverse-document-frequency-weighting-tf-idf"><a class="markdownIt-Anchor" href="#inverse-document-frequency-weighting-tf-idf"></a> Inverse Document Frequency Weighting (TF-IDF)</h2>
<p>TF-IDF creates a document term matrix, where there’s still one row per text message and the columns still represent single unique terms. But instead of the cells representing the count, the cells represent a weighting that’s meant to identify how important a word is to an individual text message.</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>=</mo><mi>t</mi><msub><mi>f</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>×</mo><mi>l</mi><mi>o</mi><mi>g</mi><mfrac><mi>N</mi><mrow><mi>d</mi><msub><mi>f</mi><mi>i</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">w_{i,j} = tf_{i,j} \times log\frac{N}{df_i} 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord mathdefault">t</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.2407700000000004em;vertical-align:-0.8804400000000001em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>The above formula lays out how this weighting is determined. It may look a little bit intimidating, but it’s actually quite simple.</p>
<p>You start with this TF term, which is just the number of times that term I occurs in text message J, divided by the number of terms in text message J. It’s just the percent of terms in this given text message that are this specific word.</p>
<p>For example (Descriptions below):</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><msub><mi>f</mi><mrow><mi>N</mi><mi>L</mi><mi>P</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>=</mo><mfrac><mtext># of occurences of NLP</mtext><mtext>number of words in text message</mtext></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>3</mn></mfrac><mo>=</mo><mn>0.</mn><mover accent="true"><mn>33</mn><mo stretchy="true">‾</mo></mover></mrow><annotation encoding="application/x-tex">tf_{NLP,j} = \frac{\text{\# of occurences of NLP}}{\text{number of words in text message}} = \frac{1}{3} = 0.\overline{33} 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord mathdefault">t</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.328331em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span><span class="mord mathdefault mtight">L</span><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.25188em;vertical-align:-0.8804400000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">number of words in text message</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord"># of occurences of NLP</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">3</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8444400000000001em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8444400000000001em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">3</span><span class="mord">3</span></span></span><span style="top:-3.76444em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi><mo>=</mo><mn>20</mn></mrow><annotation encoding="application/x-tex">N = 20 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">0</span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi><msub><mi>f</mi><mrow><mi>N</mi><mi>L</mi><mi>P</mi></mrow></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">df_{NLP} = 1 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">d</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span><span class="mord mathdefault mtight">L</span><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>=</mo><mi>t</mi><msub><mi>f</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>×</mo><mi>l</mi><mi>o</mi><mi>g</mi><mfrac><mi>N</mi><mrow><mi>d</mi><msub><mi>f</mi><mi>i</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">w_{i,j} = tf_{i,j} \times log{\frac{N}{df_i}} 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord mathdefault">t</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.2407700000000004em;vertical-align:-0.8804400000000001em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>=</mo><mn>0.</mn><mover accent="true"><mn>33</mn><mo stretchy="true">‾</mo></mover><mo>×</mo><mi>l</mi><mi>o</mi><mi>g</mi><mfrac><mn>20</mn><mn>1</mn></mfrac></mrow><annotation encoding="application/x-tex">w_{i,j} = 0.\overline{33} \times log{\frac{20}{1}} 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.9277700000000001em;vertical-align:-0.08333em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8444400000000001em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">3</span><span class="mord">3</span></span></span><span style="top:-3.76444em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>=</mo><mn>0.</mn><mover accent="true"><mn>33</mn><mo stretchy="true">‾</mo></mover><mo>×</mo><mn>1.301</mn></mrow><annotation encoding="application/x-tex">w_{i,j} = 0.\overline{33} \times 1.301 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.9277700000000001em;vertical-align:-0.08333em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8444400000000001em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">3</span><span class="mord">3</span></span></span><span style="top:-3.76444em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">3</span><span class="mord">0</span><span class="mord">1</span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>=</mo><mn>0.43</mn></mrow><annotation encoding="application/x-tex">w_{i,j} = 0.43 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">4</span><span class="mord">3</span></span></span></span></span></p>
<p>In the above calculations, if we use “I like NLP,” and the word we’re focused on is NLP, then this term would be 1 divided by 3, or 0.33.  Then the second part of this equation measures how frequently this word occurs across all other text messages.  It calculates the number of text messages in the data set divided by the number of text messages that this word appears in.  That takes the log of all of that.  Let’s just say that we have 20 text messages, so that’s going to represent N in this case, and only one of those contains NLP.  That’s going to be df.  The second part of this equation would then be log of 20 divided by 1.  As this fraction inside the log gets larger, the log of that fraction also gets larger.  Now let’s say that you have 40 text messages instead of 20, but NLP still only occurs in one of them, so the denominator here will still only be 1.  Now this fraction is 40 over 1.  The term NLP is less frequent, and this term collectively is going to be larger.  Basically, all this says is that the rarer the word is, the higher that this value’s going to be.  If a word occurs very frequently within a particular text message, so that’s TF, but very infrequently elsewhere, that’s going to be the second term.  Then a very large number will be assigned, and it’ll be assumed to be very important to differentiating that text message from others.  In summary, this method helps you pull out important but seldom-used words.</p>
<p>The following code is going to read the data:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line">pd.set_option(<span class="string">'display.max_colwidth'</span>, <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">stopwords = nltk.corpus.stopwords.words(<span class="string">'english'</span>)</span><br><span class="line">ps = nltk.PorterStemmer()</span><br><span class="line"></span><br><span class="line">data = pd.read_csv(<span class="string">"SMSSpamCollection.tsv"</span>, sep=<span class="string">'\t'</span>)</span><br><span class="line">data.columns = [<span class="string">'label'</span>, <span class="string">'body_text'</span>]</span><br></pre></td></tr></table></figure>
<p>Create function to remove punctuation, tokenize, remove stopwords, and stem:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clean_text</span><span class="params">(text)</span>:</span></span><br><span class="line">    text = <span class="string">""</span>.join([word.lower() <span class="keyword">for</span> word <span class="keyword">in</span> text <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> string.punctuation])</span><br><span class="line">    tokens = re.split(<span class="string">'\W+'</span>, text)</span><br><span class="line">    text = [ps.stem(word) <span class="keyword">for</span> word <span class="keyword">in</span> tokens <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> stopwords]</span><br><span class="line">    <span class="keyword">return</span> text</span><br></pre></td></tr></table></figure>
<p>Apply TfidfVectorizer:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfVectorizer</span><br><span class="line"></span><br><span class="line">tfidf_vect = TfidfVectorizer(analyzer = clean_text)</span><br><span class="line">X_tfidf = tfidf_vect.fit_transform(data[<span class="string">"body_text"</span>])</span><br><span class="line">print(X_tfidf.shape)</span><br><span class="line">print(tfidf_vect.get_feature_names())</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">5567</span>, <span class="number">8104</span>)</span><br><span class="line">[<span class="string">''</span>, <span class="string">'0'</span>, <span class="string">'008704050406'</span>, <span class="string">'0089mi'</span>, <span class="string">'0121'</span>, <span class="string">'01223585236'</span>, <span class="string">'01223585334'</span>, <span class="string">'0125698789'</span>, <span class="string">'02'</span>, <span class="string">'020603'</span>, <span class="string">'0207'</span>, <span class="string">'02070836089'</span>, <span class="string">'02072069400'</span>, <span class="string">'02073162414'</span>, <span class="string">'02085076972'</span>, <span class="string">'020903'</span>, <span class="string">'021'</span>, <span class="string">'050703'</span>, <span class="string">'0578'</span>, <span class="string">'06'</span>, <span class="string">'060505'</span>, <span class="string">'061104'</span>, <span class="string">'07008009200'</span>, <span class="string">'07046744435'</span>, <span class="string">'07090201529'</span>, <span class="string">'07090298926'</span>, <span class="string">'07099833605'</span>, <span class="string">'071104'</span>, <span class="string">'07123456789'</span>, <span class="string">'0721072'</span>, <span class="string">'07732584351'</span>, <span class="string">'07734396839'</span>, <span class="string">'07742676969'</span>, <span class="string">'07753741225'</span>, <span class="string">'0776xxxxxxx'</span>, <span class="string">'07786200117'</span>, <span class="string">'077xxx'</span>, <span class="string">'078'</span>, <span class="string">'07801543489'</span>, <span class="string">'07808'</span>, <span class="string">'07808247860'</span>, <span class="string">'07808726822'</span>, <span class="string">'07815296484'</span>, <span class="string">'07821230901'</span>, <span class="string">'0784987'</span>, <span class="string">'0789xxxxxxx'</span>, <span class="string">'0794674629107880867867'</span>, <span class="string">'0796xxxxxx'</span>, <span class="string">'07973788240'</span>, <span class="string">'07xxxxxxxxx'</span>, <span class="string">'0800'</span>, <span class="string">'08000407165'</span>, <span class="string">'08000776320'</span>, <span class="string">'08000839402'</span>, <span class="string">'08000930705'</span>, <span class="string">'08000938767'</span>, <span class="string">'08001950382'</span>, <span class="string">'08002888812'</span>, <span class="string">'08002986030'</span>, <span class="string">'08002986906'</span>, <span class="string">'08002988890'</span>, <span class="string">'08006344447'</span>, <span class="string">'0808'</span>, <span class="string">'08081263000'</span>, <span class="string">'08081560665'</span>, <span class="string">'0825'</span>, <span class="string">'0844'</span>, <span class="string">'08448350055'</span>, <span class="string">'08448714184'</span>, <span class="string">'0845'</span>, <span class="string">'08450542832'</span>, <span class="string">'08452810071'</span>, ...]</span><br></pre></td></tr></table></figure>
<p>Apply TfidfVectorizer to smaller sample:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">data_sample = data[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">tfidf_vect_sample = TfidfVectorizer(analyzer = clean_text)</span><br><span class="line">X_tfidf_sample = tfidf_vect_sample.fit_transform(data_sample[<span class="string">"body_text"</span>])</span><br><span class="line">print(X_tfidf_sample.shape)</span><br><span class="line">print(tfidf_vect_sample.get_feature_names())</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">20</span>, <span class="number">192</span>)</span><br><span class="line">[<span class="string">'08002986030'</span>, <span class="string">'08452810075over18'</span>, <span class="string">'09061701461'</span>, <span class="string">'1'</span>, <span class="string">'100'</span>, <span class="string">'100000'</span>, <span class="string">'11'</span>, <span class="string">'12'</span>, <span class="string">'150pday'</span>, <span class="string">'16'</span>, <span class="string">'2'</span>, <span class="string">'20000'</span>, <span class="string">'2005'</span>, <span class="string">'21st'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>, <span class="string">'4403ldnw1a7rw18'</span>, <span class="string">'4txtú120'</span>, <span class="string">'6day'</span>, <span class="string">'81010'</span>, <span class="string">'87077'</span>, <span class="string">'87121'</span>, <span class="string">'87575'</span>, <span class="string">'9'</span>, <span class="string">'900'</span>, <span class="string">'aft'</span>, <span class="string">'aid'</span>, <span class="string">'alreadi'</span>, <span class="string">'alright'</span>, <span class="string">'anymor'</span>, <span class="string">'appli'</span>, <span class="string">'ard'</span>, <span class="string">'around'</span>, <span class="string">'b'</span>, <span class="string">'brother'</span>, <span class="string">'call'</span>, <span class="string">'caller'</span>, <span class="string">'callertun'</span>, <span class="string">'camera'</span>, <span class="string">'cash'</span>, <span class="string">'chanc'</span>, <span class="string">'claim'</span>, <span class="string">'click'</span>, <span class="string">'co'</span>, <span class="string">'code'</span>, <span class="string">'colour'</span>, <span class="string">'comin'</span>, <span class="string">'comp'</span>, <span class="string">'copi'</span>, <span class="string">'cost'</span>, <span class="string">'credit'</span>, <span class="string">'cri'</span>, <span class="string">'csh11'</span>, <span class="string">'cup'</span>, <span class="string">'custom'</span>, <span class="string">'da'</span>, <span class="string">'date'</span>, <span class="string">'dont'</span>, <span class="string">'eg'</span>, <span class="string">'eh'</span>, <span class="string">'england'</span>, <span class="string">'enough'</span>, <span class="string">'entitl'</span>, <span class="string">'entri'</span>, <span class="string">'even'</span>, <span class="string">'fa'</span>, <span class="string">'feel'</span>, <span class="string">'ffffffffff'</span>, <span class="string">'final'</span>, <span class="string">'fine'</span>, <span class="string">'finish'</span>, <span class="string">'first'</span>, <span class="string">'free'</span>, <span class="string">'friend'</span>, <span class="string">'go'</span>, <span class="string">'goalsteam'</span>, <span class="string">'goe'</span>, <span class="string">'gonna'</span>, <span class="string">'gota'</span>, <span class="string">'ha'</span>, <span class="string">'hl'</span>, <span class="string">'home'</span>, <span class="string">'hour'</span>, <span class="string">'httpwap'</span>, <span class="string">'im'</span>, <span class="string">'info'</span>, <span class="string">'ive'</span>, <span class="string">'jackpot'</span>, <span class="string">'joke'</span>, <span class="string">'k'</span>, <span class="string">'kim'</span>, <span class="string">'kl341'</span>, <span class="string">'lar'</span>, <span class="string">'latest'</span>, <span class="string">'lccltd'</span>, <span class="string">'like'</span>, <span class="string">'link'</span>, <span class="string">'live'</span>, <span class="string">'lor'</span>, <span class="string">'lunch'</span>, <span class="string">'macedonia'</span>, <span class="string">'make'</span>, <span class="string">'may'</span>, <span class="string">'meet'</span>, <span class="string">'mell'</span>, <span class="string">'membership'</span>, <span class="string">'messag'</span>, <span class="string">'minnaminungint'</span>, <span class="string">'miss'</span>, <span class="string">'mobil'</span>, <span class="string">'month'</span>, <span class="string">'nah'</span>, <span class="string">'name'</span>, <span class="string">'nation'</span>, <span class="string">'naughti'</span>, <span class="string">'network'</span>, <span class="string">'news'</span>, <span class="string">'next'</span>, <span class="string">'nurungu'</span>, <span class="string">'oh'</span>, <span class="string">'oru'</span>, <span class="string">'patent'</span>, <span class="string">'pay'</span>, <span class="string">'per'</span>, <span class="string">'pobox'</span>, <span class="string">'poboxox36504w45wq'</span>, <span class="string">'pound'</span>, <span class="string">'press'</span>, <span class="string">'prize'</span>, <span class="string">'questionstd'</span>, <span class="string">'r'</span>, <span class="string">'ratetc'</span>, <span class="string">'receiv'</span>, <span class="string">'receivea'</span>, <span class="string">'rememb'</span>, <span class="string">'repli'</span>, <span class="string">'request'</span>, <span class="string">'reward'</span>, <span class="string">'scotland'</span>, <span class="string">'select'</span>, <span class="string">'send'</span>, <span class="string">'serious'</span>, <span class="string">'set'</span>, <span class="string">'six'</span>, <span class="string">'smth'</span>, <span class="string">'soon'</span>, <span class="string">'sooner'</span>, <span class="string">'speak'</span>, <span class="string">'spell'</span>, <span class="string">'stock'</span>, <span class="string">'str'</span>, <span class="string">'stuff'</span>, <span class="string">'sunday'</span>, <span class="string">'talk'</span>, <span class="string">'tc'</span>, <span class="string">'team'</span>, <span class="string">'text'</span>, <span class="string">'think'</span>, <span class="string">'though'</span>, <span class="string">'tkt'</span>, <span class="string">'today'</span>, <span class="string">'tonight'</span>, <span class="string">'treat'</span>, <span class="string">'tri'</span>, <span class="string">'trywal'</span>, <span class="string">'tsandc'</span>, <span class="string">'txt'</span>, <span class="string">'u'</span>, <span class="string">'updat'</span>, <span class="string">'ur'</span>, <span class="string">'urgent'</span>, <span class="string">'use'</span>, <span class="string">'usf'</span>, <span class="string">'v'</span>, <span class="string">'valid'</span>, <span class="string">'valu'</span>, <span class="string">'vettam'</span>, <span class="string">'want'</span>, <span class="string">'wap'</span>, <span class="string">'watch'</span>, <span class="string">'way'</span>, <span class="string">'week'</span>, <span class="string">'wet'</span>, <span class="string">'win'</span>, <span class="string">'winner'</span>, <span class="string">'wkli'</span>, <span class="string">'word'</span>, <span class="string">'wwwdbuknet'</span>, <span class="string">'xxxmobilemovieclub'</span>, <span class="string">'xxxmobilemovieclubcomnqjkgighjjgcbl'</span>, <span class="string">'ye'</span>, <span class="string">'ü'</span>]</span><br></pre></td></tr></table></figure>
<p>Vectorizers output sparse matrices:</p>
<p><em><strong>Sparse Matrix</strong>: A matrix in which most entries are 0. In the interest of efficient storage, a sparse matrix will be stored by only storing the locations of the non-zero elements.</em></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">X_tfidf_df = pd.DataFrame(X_tfidf_sample.toarray())</span><br><span class="line">X_tfidf_df.columns = tfidf_vect_sample.get_feature_names()</span><br><span class="line">X_tfidf_df</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">100000</th>
<th style="text-align:right">11</th>
<th style="text-align:right">12</th>
<th style="text-align:right">150pday</th>
<th style="text-align:right">16</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.231645</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.197682</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">8</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0.224905</td>
<td style="text-align:right">0.197695</td>
</tr>
<tr>
<td style="text-align:right">9</td>
<td style="text-align:right">0.252972</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
</tbody>
</table>
<p>20 rows × 192 columns</p>
<p>You’ll notice this looks a lot different than our other matrices.  Instead of regular integers in the cells, you have decimals.  The .2316 in column ‘12’ and 5th text message is likely more important than the .1977 in column ‘11’ and 6th text message.  This .2316 is likely more important than this .1976.  What that means is, either 12 occurs more frequently in the 5th text message than 11 does in the 6th text message, or it means 12 occurs less frequently across all the other text messages than 11 does across all the other text messages.</p>
<p>So in summary, we created this false choice here, indicating that there are three different ways to vectorize.  These are all very closely related, though, and some can actually be used together.  TF-IDF is basically a count vectorizer that includes some consideration for the length of the document, and also how common the word is across other text messages.  And then n-grams is just used within either of these two methods to look for groups of adjacent words instead of just looking for single terms.  They’re all just slight modifications of each other, and typically you’ll test different vectorization methods depending on your problem, and then you let the results determine which one you use.</p>
<h1 id="feature-engineering"><a class="markdownIt-Anchor" href="#feature-engineering"></a> Feature Engineering</h1>
<h2 id="introducing-feature-engineering"><a class="markdownIt-Anchor" href="#introducing-feature-engineering"></a> Introducing Feature Engineering</h2>
<p>Feature engineering is the process of creating new features and/or transforming existing features to get the most out of your data.  So up to this point, we’ve just been talking about what we’re given without really imagining what other features we might be able to extract from this data that would be helpful to predict spam or ham.  The absence of this step could mean we’re potentially leaving some significant value on the table.  So the model will now see the words in the text as represented by the vectorization, but nothing else.</p>
<p>What else could we extract from that text that would be helpful for the model to decipher spam from ham?  For instance, maybe we could include the length of the text field.  Maybe spam tends to be a little bit longer than real text messages.  Or maybe we could include what percent of the characters in the text message are punctuation.  Maybe real text messages underuse punctuation.  Or maybe what percent of characters are capitalized are indicative of whether it’s spam or not.  So that’s a couple ideas of some features that you could create that would help our model identify spam from nonspam.</p>
<p>So given these new features, or really any other already existing features, maybe you need to apply some sort of transformation to your data to make it more well-behaved.  One broad popular type of transformations are called power transformations.  So this would include squaring your data, taking the square root, et cetera.  One example of why you might need to transform your data would be if you have a very skewed data set with a very long right tail where you have a lot of outliers.  In that case, you might want to apply a log transformation which basically pulls that long tail and all those outliers back towards the bulk of the data.  And what this does is it helps the model draw correlations and better understand the data without trying to overfit to that long tail and those outliers.</p>
<p>Another topic that falls under transformations is standardizing your data, or transforming it all to be on the same scale.  Some models perform better when all features are on the same scale.  It’s especially important as you get to this phase that you’re keeping the problem context in mind.  When you do feature creation, you’re always trying to imagine what additional information might be helpful to the model within the context and understanding of what exactly it’s trying to predict.  For instance, as an extreme example in our spam detection problem, the number of As that appear in a text message likely isn’t predictive of whether this is spam or ham.  But maybe the amount of punctuation or the length of a text message is.  So always keep your problem in mind.  And this is the stage where you’re allowed to get a little bit creative to try to extract as much value out of your data as possible.</p>
<h2 id="feature-creation"><a class="markdownIt-Anchor" href="#feature-creation"></a> Feature Creation</h2>
<p>Read in the data:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">data = pd.read_csv(<span class="string">"SMSSpamCollection.tsv"</span>, sep=<span class="string">'\t'</span>)</span><br><span class="line">data.columns = [<span class="string">'label'</span>, <span class="string">'body_text'</span>]</span><br></pre></td></tr></table></figure>
<p>Create feature for text message length:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Be careful of the white spaces, need to be subtract them</span></span><br><span class="line">data[<span class="string">"body_len"</span>] = data[<span class="string">"body_text"</span>].apply(<span class="keyword">lambda</span> x : len(x) - x.count(<span class="string">" "</span>))</span><br><span class="line">data.head()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:left">label</th>
<th style="text-align:left">body_text</th>
<th style="text-align:right">body_len</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:left">spam</td>
<td style="text-align:left">Free entry in 2 a wkly comp to win FA Cup final tkts 21st May 2005. Text FA to 87121 to receive entry question(std txt rate)T&amp;C’s apply 08452810075over18’s</td>
<td style="text-align:right">128</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:left">ham</td>
<td style="text-align:left">Nah I don’t think he goes to usf, he lives around here though</td>
<td style="text-align:right">49</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:left">ham</td>
<td style="text-align:left">Even my brother is not like to speak with me. They treat me like aids patent.</td>
<td style="text-align:right">62</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:left">ham</td>
<td style="text-align:left">I HAVE A DATE ON SUNDAY WITH WILL!!</td>
<td style="text-align:right">28</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:left">ham</td>
<td style="text-align:left">As per your request ‘Melle Melle (Oru Minnaminunginte Nurungu Vettam)’ has been set as your callertune for all Callers. Press *9 to copy your friends Callertune</td>
<td style="text-align:right">135</td>
</tr>
</tbody>
</table>
<p>Create feature for % of text that is punctuation:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count_punct</span><span class="params">(text)</span>:</span></span><br><span class="line">    count = sum([<span class="number">1</span> <span class="keyword">for</span> char <span class="keyword">in</span> text <span class="keyword">if</span> char <span class="keyword">in</span> string.punctuation])</span><br><span class="line">    <span class="keyword">return</span> round(count / (len(text) - text.count(<span class="string">" "</span>)), <span class="number">3</span>) * <span class="number">100</span></span><br><span class="line"></span><br><span class="line">data[<span class="string">"punct%"</span>] = data[<span class="string">"body_text"</span>].apply(<span class="keyword">lambda</span> x : count_punct(x))</span><br><span class="line"></span><br><span class="line">data.head()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:left">label</th>
<th style="text-align:left">body_text</th>
<th style="text-align:right">body_len</th>
<th style="text-align:right">punct%</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:left">spam</td>
<td style="text-align:left">Free entry in 2 a wkly comp to win FA Cup final tkts 21st May 2005. Text FA to 87121 to receive entry question(std txt rate)T&amp;C’s apply 08452810075over18’s</td>
<td style="text-align:right">128</td>
<td style="text-align:right">4.7</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:left">ham</td>
<td style="text-align:left">Nah I don’t think he goes to usf, he lives around here though</td>
<td style="text-align:right">49</td>
<td style="text-align:right">4.1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:left">ham</td>
<td style="text-align:left">Even my brother is not like to speak with me. They treat me like aids patent.</td>
<td style="text-align:right">62</td>
<td style="text-align:right">3.2</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:left">ham</td>
<td style="text-align:left">I HAVE A DATE ON SUNDAY WITH WILL!!</td>
<td style="text-align:right">28</td>
<td style="text-align:right">7.1</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:left">ham</td>
<td style="text-align:left">As per your request ‘Melle Melle (Oru Minnaminunginte Nurungu Vettam)’ has been set as your callertune for all Callers. Press *9 to copy your friends Callertune</td>
<td style="text-align:right">135</td>
<td style="text-align:right">4.4</td>
</tr>
</tbody>
</table>
<p>The goal here is to generate new features that help a model distinguish spam from real text messages. So it’s always useful to find some way to see if your new features appear to be predictive, or correlated to the response in some way.</p>
<h2 id="feature-evaluation"><a class="markdownIt-Anchor" href="#feature-evaluation"></a> Feature Evaluation</h2>
<p>We’ll use overlayed histograms to look at the value of these created features. So we’re going to import pyplot from matplotlib and we’re going to import numpy and store it as np. And then we’re going to tell Python to print out matplotlib inline right in our notebook.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">%matplotlib inline</span><br></pre></td></tr></table></figure>
<p>We’re going to build two histograms. The first is going to look at the distribution of our body length for spam, and then the second one is going to look at the distribution of body length for non-spam, and that’s how we’re going to use these histograms to see if this new created feature is helpful for distinguishing spam from non-spam.</p>
<p>The first parameter that we have to pass in is the thing that we actually want to plot, so that’s body_len.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># We're going to pass in the starting point, which is going to be zero,</span></span><br><span class="line"><span class="comment"># and then the maximum, and in our case for body length, we'll say it won't go any higher than 200.</span></span><br><span class="line"><span class="comment"># Then we tell it how many cut points we want in there, and we'll just say 40.</span></span><br><span class="line"><span class="comment"># So this will return an array with 40 evenly spaced numbers between zero and 200,</span></span><br><span class="line"><span class="comment"># and then these will basically be used as the cut points and determine where our bins are placed.</span></span><br><span class="line">bins = np.linspace(<span class="number">0</span>, <span class="number">200</span>, <span class="number">40</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># The next parameter we'll pass in is the alpha parameter,</span></span><br><span class="line"><span class="comment"># and this just tells is how dark we want the shading of this histogram to be. We'll use 0.5.</span></span><br><span class="line"><span class="comment"># Then we pass in normed equals True, and this will normalize our plots to the same scale.</span></span><br><span class="line"><span class="comment"># So this is helpful because there's a lot more ham, for instance, in this data set, than spam, so if we don't normalize, it'll just be the count,</span></span><br><span class="line"><span class="comment"># so the ham histogram will dwarf the spam histogram and it'll be really difficult to tell the differences here.</span></span><br><span class="line"><span class="comment"># So this normed one just puts them on the same scale.</span></span><br><span class="line"><span class="comment"># And then lastly, we'll tell it what we want the label to be.</span></span><br><span class="line">pyplot.hist(data[data[<span class="string">"label"</span>] == <span class="string">"spam"</span>][<span class="string">"body_len"</span>], bins, alpha = <span class="number">0.5</span>, normed = <span class="literal">True</span>, label = <span class="string">"spam"</span>)</span><br><span class="line">pyplot.hist(data[data[<span class="string">"label"</span>] == <span class="string">"ham"</span>][<span class="string">"body_len"</span>], bins, alpha = <span class="number">0.5</span>, normed = <span class="literal">True</span>, label = <span class="string">"ham"</span>)</span><br><span class="line">pyplot.legend(loc = <span class="string">"upper left"</span>)</span><br><span class="line">pyplot.show()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<p><img alt="Length of the Body between Spam and Ham" data-src="https://live.staticflickr.com/65535/48762959913_997b1745f0_o.png" class="lozad"></p>
<p>You can see that body length is very different for ham versus spam. So spam text messages seem to be quite a bit longer than regular text messages.  So it appears that this extra feature could be really helpful for the model to distinguish ham from spam.  So if we didn’t create this feature, the model may not necessarily pick up on this difference.</p>
<p>Evaluation to Punctuation Percentage Feature:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Change the upper bound to 50</span></span><br><span class="line">bins = np.linspace(<span class="number">0</span>, <span class="number">50</span>, <span class="number">40</span>)</span><br><span class="line"></span><br><span class="line">pyplot.hist(data[data[<span class="string">"label"</span>] == <span class="string">"spam"</span>][<span class="string">"punct%"</span>], bins, alpha = <span class="number">0.5</span>, normed = <span class="literal">True</span>, label = <span class="string">"spam"</span>)</span><br><span class="line">pyplot.hist(data[data[<span class="string">"label"</span>] == <span class="string">"ham"</span>][<span class="string">"punct%"</span>], bins, alpha = <span class="number">0.5</span>, normed = <span class="literal">True</span>, label = <span class="string">"ham"</span>)</span><br><span class="line">pyplot.legend(loc = <span class="string">"upper right"</span>)</span><br><span class="line">pyplot.show()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<p><img alt="Punctuation Percentage between Spam and Ham" data-src="https://live.staticflickr.com/65535/48763469067_51f85362e7_o.png" class="lozad"></p>
<p>You can see there’s not nearly as much of a difference in punctuation use.  You can also see that spam might be a little bit more concentrated here on the left, whereas ham tends to have more of a tail over to the right-hand side.</p>
<p>It’s pretty clear which one of these new features is likely to help out the model the most.  So in terms of our original hypotheses, our hypothesis that spam messages tend to be longer than non-spam messages seems to be correct based on this evaluation, and this feature is likely to provide some value to the model.  However, our hypothesis that ham messages contain less punctuation than spam doesn’t appear to be accurate, and it isn’t quite clear whether this feature will provide value to the model.  Now, in cases like this where there is some separation between the distributions, typically we’ll err on the side of leaving this feature in the model just to see what kind of value the model itself may be able to extract out of it.  qSo this is an example of how you might evaluate whether some newly created features will be useful to the model.</p>
<h2 id="identifying-features-for-treansformation"><a class="markdownIt-Anchor" href="#identifying-features-for-treansformation"></a> Identifying Features for Treansformation</h2>
<p>Reading the raw data:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">data = pd.read_csv(<span class="string">"SMSSpamCollection.tsv"</span>, sep=<span class="string">'\t'</span>)</span><br><span class="line">data.columns = [<span class="string">'label'</span>, <span class="string">'body_text'</span>]</span><br></pre></td></tr></table></figure>
<p>Create the two new features</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count_punct</span><span class="params">(text)</span>:</span></span><br><span class="line">    count = sum([<span class="number">1</span> <span class="keyword">for</span> char <span class="keyword">in</span> text <span class="keyword">if</span> char <span class="keyword">in</span> string.punctuation])</span><br><span class="line">    <span class="keyword">return</span> round(count/(len(text) - text.count(<span class="string">" "</span>)), <span class="number">3</span>)*<span class="number">100</span></span><br><span class="line"></span><br><span class="line">data[<span class="string">'body_len'</span>] = data[<span class="string">'body_text'</span>].apply(<span class="keyword">lambda</span> x: len(x) - x.count(<span class="string">" "</span>))</span><br><span class="line">data[<span class="string">'punct%'</span>] = data[<span class="string">'body_text'</span>].apply(<span class="keyword">lambda</span> x: count_punct(x))</span><br><span class="line">data.head()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:left">label</th>
<th style="text-align:left">body_text</th>
<th style="text-align:right">body_len</th>
<th style="text-align:right">punct%</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:left">spam</td>
<td style="text-align:left">Free entry in 2 a wkly comp to win FA Cup final tkts 21st May 2005. Text FA to 87121 to receive entry question(std txt rate)T&amp;C’s apply 08452810075over18’s</td>
<td style="text-align:right">128</td>
<td style="text-align:right">4.7</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:left">ham</td>
<td style="text-align:left">Nah I don’t think he goes to usf, he lives around here though</td>
<td style="text-align:right">49</td>
<td style="text-align:right">4.1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:left">ham</td>
<td style="text-align:left">Even my brother is not like to speak with me. They treat me like aids patent.</td>
<td style="text-align:right">62</td>
<td style="text-align:right">3.2</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:left">ham</td>
<td style="text-align:left">I HAVE A DATE ON SUNDAY WITH WILL!!</td>
<td style="text-align:right">28</td>
<td style="text-align:right">7.1</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:left">ham</td>
<td style="text-align:left">As per your request ‘Melle Melle (Oru Minnaminunginte Nurungu Vettam)’ has been set as your callertune for all Callers. Press *9 to copy your friends Callertune</td>
<td style="text-align:right">135</td>
<td style="text-align:right">4.4</td>
</tr>
</tbody>
</table>
<p>In order to determine whether transformation might be helpful, we can look at the distribution of our data using a histogram.  Now, on the previous session, we looked at the normalized overlayed histograms, but we didn’t look at the full histogram so we’re still not exactly sure what the full distribution looks like for these new features.  We only know when it’s split by label.  The first thing we’ll do is look at those full distributions and then we can determine which one might be a fit for transformation.  Now, what we’re looking for here is a dramatic skew with a really long tail or maybe a few outliers.  These are scenarios that would make a feature a prime candidate for transformation.</p>
<p>Import some necessary packages:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">%matplotlib inline</span><br></pre></td></tr></table></figure>
<p>Plot the two new features:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bins = np.linspace(<span class="number">0</span>, <span class="number">200</span>, <span class="number">40</span>)</span><br><span class="line"></span><br><span class="line">pyplot.hist(data[<span class="string">"body_len"</span>], bins)</span><br><span class="line">pyplot.title(<span class="string">"Body Length Distribution"</span>)</span><br><span class="line">pyplot.show()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<p><img alt="Body Length Distribution" data-src="https://live.staticflickr.com/65535/48779477607_7fc4a364e5_o.png" class="lozad"></p>
<p>We saw that spam were mostly long so those are the ones concentrated down here.  And real text are mostly short so those are the ones kind of concentrated down here.  So we see this bimodal distribution here with two different spikes.  I seems that this isn’t really a great candidate for transformation because it’s not really heavily skewed and there’s not really any clear outliers.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bins = np.linspace(<span class="number">0</span>, <span class="number">50</span>, <span class="number">40</span>)</span><br><span class="line"></span><br><span class="line">pyplot.hist(data[<span class="string">"punct%"</span>], bins)</span><br><span class="line">pyplot.title(<span class="string">"Punctuation % Distribution"</span>)</span><br><span class="line">pyplot.show()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<p><img alt="Punctuation % Distribution" data-src="https://live.staticflickr.com/65535/48779477552_aa61bc3a51_o.png" class="lozad"></p>
<p>This one could very well be a nice distribution for a transformation.  It’s fairly skewed here where we see a lot close to zero and then we see the tail extending all the way up to 40 with some of these outliers.  A model might dig too much into this skewed tail over here and generate a model maybe that’s a little bit biased.  We’re going to focus on this feature for our transformations.</p>
<h2 id="box-cox-power-transformation"><a class="markdownIt-Anchor" href="#box-cox-power-transformation"></a> Box-Cox Power Transformation</h2>
<p>A transformation is a process that alters each data point in a certain column in a systematic way that makes it cleaner for a model to use.  For instance, that could mean squaring each value, or maybe taking the square root of each value in a given column.  So let’s say a distribution for a certain feature has a long right tail like this one does in the following image.  Then the transformation would aim to pull that tail in to make it a more compact distribution like we see in the example here using a log transformation.  We do this so that the model doesn’t get distracted trying to chase down outliers in that tail.</p>
<p><img alt="Example of Transformation" data-src="https://live.staticflickr.com/65535/48780348452_ee812f8fd1_o.png" class="lozad"></p>
<p>The series of transformation that we’ll be working with are call the Box-Cox Power Transformations.  This is a very common type of transformation.  The base form of this type of transformation is y to the x power, where y is the value in an individual cell, and the x is the exponent of the power transformation you’re applying.  You’ll notice that the following table shows some common power transformations using exponents from negative two up to positive two.  For the first line in the table with an exponent of negative two that translates to y to the negative two which is the same as one over y squared.</p>
<p><strong>Base Form</strong>: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>y</mi><mi>x</mi></msup></mrow><annotation encoding="application/x-tex">y^x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.858832em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span></span></span></span></span></span></span></span></p>
<table>
<thead>
<tr>
<th>X</th>
<th>Base Form</th>
<th>Transformation</th>
</tr>
</thead>
<tbody>
<tr>
<td>-2</td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>y</mi><mrow><mo>−</mo><mn>2</mn></mrow></msup></mrow><annotation encoding="application/x-tex">y^{-2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mn>1</mn><msup><mi>y</mi><mn>2</mn></msup></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{y^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.326216em;vertical-align:-0.481108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7463142857142857em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.481108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></td>
</tr>
<tr>
<td>-1</td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>y</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">y^{-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span></td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mn>1</mn><mi>y</mi></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{y}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.326216em;vertical-align:-0.481108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.481108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></td>
</tr>
<tr>
<td>-0.5</td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>y</mi><mfrac><mrow><mo>−</mo><mn>1</mn></mrow><mn>2</mn></mfrac></msup></mrow><annotation encoding="application/x-tex">y^{\frac{-1}{2}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.14846em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9540200000000001em;"><span style="top:-3.363em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142857em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span></span></span></span></td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mn>1</mn><msqrt><mi>y</mi></msqrt></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{\sqrt{y}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4220285em;vertical-align:-0.5769205em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.708685em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span><span style="top:-2.668685em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.33131499999999997em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5769205em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></td>
</tr>
<tr>
<td>0</td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>y</mi><mn>0</mn></msup></mrow><annotation encoding="application/x-tex">y^{0}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span></span></span></span></span></td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false">(</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">log(y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span></td>
</tr>
<tr>
<td>0.5</td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>y</mi><mfrac><mn>1</mn><mn>2</mn></mfrac></msup></mrow><annotation encoding="application/x-tex">y^{\frac{1}{2}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.14846em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9540200000000001em;"><span style="top:-3.363em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span></span></span></span></td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msqrt><mi>y</mi></msqrt></mrow><annotation encoding="application/x-tex">\sqrt{y}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.33693999999999996em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.70306em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span><span style="top:-2.66306em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.33693999999999996em;"><span></span></span></span></span></span></span></span></span></td>
</tr>
<tr>
<td>1</td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>y</mi><mn>1</mn></msup></mrow><annotation encoding="application/x-tex">y^{1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span></td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span></td>
</tr>
<tr>
<td>2</td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>y</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">y^{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>y</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">y^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></td>
</tr>
</tbody>
</table>
<p>So let’s introduce an example which shows in the following table.  Let’s say that 50% of the characters in a given text message are punctuation.  So the value in that cell will be 50.  So let’s go through these different transformations and see how that would impact the transformed value.  Starting with the first line, one over y squared.  So in this example that would be one over 50 squared, or one over 2,500, and that’ll give you 0.0004.  Then the next transformation is just one over 50 and then it’s one over square root of 50 and so on.  So this kind of gives you an idea of how different power transformations alter the original values.</p>
<table>
<thead>
<tr>
<th style="text-align:center">Original Value</th>
<th style="text-align:center">Transformation</th>
<th style="text-align:center">Transformed Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">50</td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mfrac><mn>1</mn><mn>50</mn></mfrac><mn>2</mn></msup><mo>=</mo><mfrac><mn>1</mn><mn>2500</mn></mfrac></mrow><annotation encoding="application/x-tex">{\frac{1}{50}}^2 = \frac{1}{2500}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.394116em;vertical-align:-0.345em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.049116em;"><span style="top:-3.2980080000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">5</span><span class="mord mtight">0</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></td>
<td style="text-align:center">0.0004</td>
</tr>
<tr>
<td style="text-align:center">50</td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mn>1</mn><mn>50</mn></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{50}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></td>
<td style="text-align:center">0.02</td>
</tr>
<tr>
<td style="text-align:center">50</td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mn>1</mn><msqrt><mn>50</mn></msqrt></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>7.07</mn></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{\sqrt{50}} = \frac{1}{7.07}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.383108em;vertical-align:-0.5379999999999999em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.5510085em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.912845em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight">5</span><span class="mord mtight">0</span></span></span><span style="top:-2.872845em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.12715500000000002em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5379999999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">7</span><span class="mord mtight">.</span><span class="mord mtight">0</span><span class="mord mtight">7</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></td>
<td style="text-align:center">0.14</td>
</tr>
<tr>
<td style="text-align:center">50</td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false">(</mo><mn>50</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">log(50)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord">5</span><span class="mord">0</span><span class="mclose">)</span></span></span></span></td>
<td style="text-align:center">1.7</td>
</tr>
<tr>
<td style="text-align:center">50</td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msqrt><mn>50</mn></msqrt></mrow><annotation encoding="application/x-tex">\sqrt{50}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.13278em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.90722em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord">5</span><span class="mord">0</span></span></span><span style="top:-2.86722em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.13278em;"><span></span></span></span></span></span></span></span></span></td>
<td style="text-align:center">7.07</td>
</tr>
<tr>
<td style="text-align:center">50</td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>50</mn></mrow><annotation encoding="application/x-tex">50</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">5</span><span class="mord">0</span></span></span></span></td>
<td style="text-align:center">50</td>
</tr>
<tr>
<td style="text-align:center">50</td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>5</mn><msup><mn>0</mn><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">50^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">5</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></td>
<td style="text-align:center">2500</td>
</tr>
</tbody>
</table>
<p>So this kind of gives you an idea of how different power transformations alter the original values.  In practice, what this process looks likes would be as following <strong>Process</strong> session.  First you determine what range of exponents you want to test out.  So in our example we had a range from negative two to positive two.  And that’s a commonly used range.  Then you’d apply these transformations to each value in the feature you’d like to transform.  Then you’d use some criteria to determine which of the transformations yielded the best distribution.  You can read about what different criteria you can use to determine the best distribution, but we, we’re just going to plot it in a histogram and pick the one that looks the most like a normal distribution because this means it’ll be a nice and compact distribution that’ll be easier for the model to use.</p>
<p><strong>Process</strong></p>
<ol>
<li>Determine what range of exponents to test.</li>
<li>Apply each transformation to each value of your chosen feature.</li>
<li>Use some criteria to determine which of the transformations yield the best distribution.</li>
</ol>
<p>So what we want to do is apply a bunch of different power transformations and pick the histogram that looks the most like a normal distribution.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">6</span>):</span><br><span class="line">    pyplot.hist((data[<span class="string">"punct%"</span>]) ** (<span class="number">1</span>/i), bins = <span class="number">40</span>)</span><br><span class="line">    pyplot.title(<span class="string">"Transformation: 1/&#123;&#125;"</span>.format(str(i)))</span><br><span class="line">    pyplot.show()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<p><img alt="Transformation 1/1" data-src="https://live.staticflickr.com/65535/48779657012_f538786225_o.png" class="lozad"></p>
<p>For the first loop through you’ll see that this is the exact distribution that we saw before.</p>
<p><img alt="Transformation 1/2" data-src="https://live.staticflickr.com/65535/48779476921_29c34430c5_o.png" class="lozad"></p>
<p>As we move to the next one, the square root transformation, or exponent of one half, you can see it’s kind of starting to pull this tail in. You can see how much the scale has changed and you see it looks a little bit nicer, a little bit more compact, a little bit more like a normal distribution.</p>
<p><img alt="Transformation 1/3" data-src="https://live.staticflickr.com/65535/48779476881_60799c66e5_o.png" class="lozad"></p>
<p>Then you go to one third, it’s even more so. More compact, more like a normal distribution.</p>
<p><img alt="Transformation 1/4" data-src="https://live.staticflickr.com/65535/48779111848_fb1716161c_o.png" class="lozad"><br>
<img alt="Transformation 1/5" data-src="https://live.staticflickr.com/65535/48779476816_99feb9f6ed_o.png" class="lozad"></p>
<p>One fourth is a little bit better and then one fifth is even better.  Again you’ll notice that the outliers continue to get pulled in closer and closer to the center of the distribution.  So given this view either one fourth or one fifth would be chosen as a transformation.  Both of those look pretty good.</p>
<p>Before we move on, to be noted that you do have this stack to the left and all these are just zeros, so this means that there’s no punctuation.  So any power transformation of zero is just going to keep it at zero so we’ll maintain that stack on the left.  What we’re mostly concerned about is the rest of the distribution seeing how the transformation effects that.  So these power transformations are a commonly used method to transformation skewed data or data that isn’t behaving particularly well.  It helps your model key in on the data and leverage it to make predictions in a cleaner way.</p>
<h1 id="building-machine-learning-classifiers"><a class="markdownIt-Anchor" href="#building-machine-learning-classifiers"></a> Building Machine Learning Classifiers</h1>
<h2 id="what-is-machine-learning"><a class="markdownIt-Anchor" href="#what-is-machine-learning"></a> What is Machine Learning</h2>
<p>If you ask 10 people, you may get 10 different definitions of what machine learning is. As an illustration of that, here’s a few widely accepted definitions.</p>
<ol>
<li>
<p>The field of study that gives computers the ability to learn without being explicitly programmed. - Arthur Samuel, 1959</p>
</li>
<li>
<p>A computer program is said to learn from experience E with respect to some task T and some performance measure P, if its performance on T, as measure by P, improves with experience E. - Tom Mitchell, 1998</p>
</li>
<li>
<p>Algorithms that can figure out how to perform important tasks by generalizing from examples. - University of Washington, 2012</p>
</li>
<li>
<p>Practice of using algorithms to parse data, learn from it, and then make a determination or prediction about something in the world. - NVIDA, 2016</p>
</li>
</ol>
<p>There are a few different viewpoints on how to formally define machine learning. The point being is that there’s no clear, agreed upon definition, but hopefully given these four definitions, you’ll start to develop an idea of what machine learning is.</p>
<h3 id="two-broad-types-of-machine-learning"><a class="markdownIt-Anchor" href="#two-broad-types-of-machine-learning"></a> Two Broad Types of Machine Learning</h3>
<p>Supervised learning is the type of machine learning that we’ll be doing in this post.  Unsupervised learning is where you don’t have any explicit labels and it’s about deriving structure from the data where you don’t know the effect of any of the features.  In other words, you don’t have anything you’re trying to predict, necessarily.  You’re just trying to back out some sort of information or structure using the variables that you are given.  A couple of quick examples.  An example of supervised learning would be a spam filter.  The machine learning model would predict whether any given email is spam based on known information about the email, so email content, maybe sender, recipient, what time it was sent, maybe the structure of the email, things like that.  An example of unsupervised learning would be grouping together similar emails into distinct folders based on the content.  There is no right or wrong answer necessarily, but if a model can identify that these 15 emails are all in regards to a vacation to Italy and those other ones are about planning a certain family gathering, and then it can group those together into their own little bundles.  That’s what unsupervised learning is.</p>
<h2 id="cross-validation-and-evaluation-metrics"><a class="markdownIt-Anchor" href="#cross-validation-and-evaluation-metrics"></a> Cross-validation and Evaluation Metrics</h2>
<p>There are a lot of different methods and metrics that you can use.  The first thing that we need to define is a holdout test set.  This is a sample of data that is set aside and not used in any of the fitting of the model for the purpose of evaluating the model’s ability to generalize to unseen data.  So this is meant to simulate how the model will perform in real world scenarios.  So this is the entire point of building these models, to generalize and say something about the world.  Now given that concept of a holdout test set.  Hold that in the back of your mind for just a minute.  We’ll be primarily be using K-Fold Cross Validation to evaluate our models.  In this process the full data set is k-subsets and the holdout method is repeated k times. That is, in each iteration one of the k-subsets is treated as the holdout test set and the other k-1 subsets are put together to train the model.  The purpose is that this gives you a little bit more robust read on the performance of the model rather than just having one single hold out test set for the model to be evaluated on.  Now you have K test sets and k evaluation metrics to understand the potential performance outcomes.</p>
<p><img alt="5-Fold Cross Validation" data-src="https://live.staticflickr.com/65535/48797105293_5830d4ae16_o.png" class="lozad"></p>
<p>The above image is a example of what cross validation actually looks like.  In this example, we’ll start with a full data set of 10,000 examples and we want to run five fold cross validation.  So again, that means k equals five.  So the first step is to split that 10,000 example data set into k or five subsets.  So you’ll see that we now have five subsets of data and each has 2,000 examples.  So this is sampling without replacement, so all 10,000 examples are still accounted for and it’s worth noting that these subsets will remain the same throughout this entire process.  So an example in subset one will remain in subset one all the way through the end of this cross validation.  We assign one of these subsets as a test set, which is subset five in red here and then we assign the other four that are in blue to the training set.  Now we’ll fit a model on the 8,000 examples in blue and then we’ll evaluate the model on the 2,000 example test set in red and then we’ll record the performance metric and store that away in an array.  To be clear this is all handled under the hood in Psychic Learn.  You don’t have to manually implement these steps, you’ll see when we actually write this with code that Psychic Learn handles all this but it’s important for you to understand what it’s doing when it carries out this process.  Again you’ll pick an evaluation metric and after the first iteration it’ll store the performance of the model on the holdout test set.  So here we’re saying that’s .867.  Next we’ll move on to the second iteration, where now the fourth subset is the test set and subsets one through three along with the fifth one are now the training set.  So again, we’ll re-fit a brand new model on these 8,000 training examples and evaluate on the 2,000 test examples in that fourth subset.  And then we’ll store the performance metric, here we’re saying that’s .884.  Then again for the third iteration, the third subset will be or test set and then model will be trained on the 8,000 examples in the first, second, fourth and fifth.  So you train a brand new model evaluate it on the third subset, store the performance metric here we’ll say it’s .901.  Again for the fourth iteration, same process as before but now the second subset is our holdout test set.  Last but not least, the first subset is the test set and two through five are the training data.  For the model, evaluate it on the first subset and store the evaluation metric.  Now it’s worth noting that at this point, every subset and thus every example has been used in a training set four times and in an evaluation set once.  So we have now used this model configuration to fit a model on all different combinations of these examples and evaluated it on every single point in this data set.  So you can see why this can be a really powerful tool to gauge a model’s ability to generalize.  And then lastly, you would normally output maybe the full array of scores so all five scores or you might just output the simple average.  So the average is .885.  But now we see a more robust gauge of what the potential outcome of this model would be.  So let’s just say we’re using a single holdout test set and using that to gauge the performance of the model for our business.  Now the first iteration you’ll get a score of .867 but in average overall five is .885 and the highest is .901.  So that’s a difference of .018 from the lowest score to the average and .34 from the lowest score to the highest score.  That may not seem like a big difference but in a business setting where this could impact millions of dollars, that’s a huge difference.  So having a read on how this model performs over five different test sets is a huge advantage to truly understanding how your model might perform in the real world.  Now this gives us more confidence that the model will perform around .885 and gives us a range of plausible outcomes or some error of ours on the projection.</p>
<p>So let’s talk about actual evaluation metrics now. So for a classification problem like this spam ham data set that we’re working with, we’ll generally use three main performance metrics.</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi><mi>c</mi><mi>c</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>y</mi><mo>=</mo><mfrac><mtext># predicted correctly</mtext><mtext>total # of observations</mtext></mfrac></mrow><annotation encoding="application/x-tex">Accuracy = \frac{\text{\# predicted correctly}}{\text{total \# of observations}} 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">A</span><span class="mord mathdefault">c</span><span class="mord mathdefault">c</span><span class="mord mathdefault">u</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">a</span><span class="mord mathdefault">c</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.25188em;vertical-align:-0.8804400000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">total # of observations</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord"># predicted correctly</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>The first is accuracy shown above, so that’s just the number that you’ve predicted correctly over the total number of observations.  So if you have 10,000 observations and you’ve got 800 of them labeled correctly then your accuracy is 80%.</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo><mfrac><mtext># predicted as spam that are actually spam</mtext><mtext>total # predicted as spam</mtext></mfrac></mrow><annotation encoding="application/x-tex">Precision = \frac{\text{\# predicted as spam that are actually spam}}{\text{total \# predicted as spam}} 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.25188em;vertical-align:-0.8804400000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">total # predicted as spam</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord"># predicted as spam that are actually spam</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>The second metric is precision as shown above.  Within the context of the problem that we’re working with, that would be represented by the number that the model predicted as spam that are actually spam divided by the total number that the model predicted as spam.</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>R</mi><mi>e</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>l</mi><mo>=</mo><mfrac><mtext># predicted as spam that are actually spam</mtext><mtext>total # that are actually spam</mtext></mfrac></mrow><annotation encoding="application/x-tex">Recall = \frac{\text{\# predicted as spam that are actually spam}}{\text{total \# that are actually spam}} 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.25188em;vertical-align:-0.8804400000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">total # that are actually spam</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord"># predicted as spam that are actually spam</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>The last evaluation metric is called recall presented above, so that would be the number predicted by the model to be spam that are actually spam, so again that’s the same numerator as precision but now it’s just divided by the total number that are actually spam instead of the total number that are predicted as spam.  So that’s accuracy, precision and recall.</p>
<p><img alt="Evaluation Metrics" data-src="https://live.staticflickr.com/65535/48797105303_cfed29abac_o.png" class="lozad"></p>
<p>So the above image is the visual representation of precision and recall, you can see that the numerator in both is the same, the amount that you correctly identified but the denominator is different.  Precision is all things that you said were relevant while recall is all the things that are actually relevant.  So in our example relevant means it’s spam.  So now precision recall give you the ability to kind of tailor the aggressiveness of your algorithm based on your business problem.  For instance, if false positives are really costly then you’ll want to optimize your model for precision.  But if false negatives are really costly then you’ll want to optimize the model for recall.  Only knowing accuracy may not really give you incite into this kind of trade off.</p>
<h2 id="introducting-random-forest"><a class="markdownIt-Anchor" href="#introducting-random-forest"></a> Introducting Random Forest</h2>
<p>Random forest is one type of a machine learning algorithm that falls into a broader category of ensemble learners.  This takes advantage of the ensemble method, which is a technique that creates multiple models and then combines them to produce better results than any of the single models individually.  The idea behind ensemble learning is that you can combine a lot of weak models to create a single strong model.  The basic idea is that this leverages the aggregate opinion of many over the isolated opinion of one.  This method has a very strong theoretical motivation.</p>
<p>Random forest is an ensemble learning method that constructs a collection of decision trees and then aggregates the predictions of each tree to determine the final prediction.  So in this case, your weak models are the individual decision trees, and then those are combined into the strong model that is the aggregated random forest model.  So you may say, I want to build a random forest model to predict ham or spam.  Let’s just say that the random forest has one hundred decision trees in it.  Then each of the hundred decision trees are built independently of one another, and each will output a prediction of either spam or ham.  So let’s say 60 of those decision trees vote spam and 40 vote ham.  Then the final prediction of the random forest model will be spam.  So it’s really just a simple voting method for the trees.</p>
<p>There are a lot of benefits to using random forest.  It’s a very versatile and powerful machine learning algorithm.  The following list are the benefits:</p>
<ul>
<li>Can be used for classification or regression</li>
<li>Easily handles outliers, missing values, etc.</li>
<li>Accepts various types of inputs (continuous, ordinal, etc.)</li>
<li>Less likely to overfit</li>
<li>Output feature importance</li>
</ul>
<p>So random forest is really versatile, and it often makes a terrific first pass at your data, because you rarely have to do a lot of data cleaning, because it can accept pretty much anything.  Beyond that, it’s powerful, and it outputs feature importance to help you get a feel for which of your features are really useful, and which aren’t.</p>
<h2 id="building-a-random-forest-model"><a class="markdownIt-Anchor" href="#building-a-random-forest-model"></a> Building a Random Forest Model</h2>
<p>Clean up the data based on previous chapters and this time we use tf-idf to vectorise the data, then split data into actual features and labels:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfVectorizer</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">stopwords = nltk.corpus.stopwords.words(<span class="string">'english'</span>)</span><br><span class="line">ps = nltk.PorterStemmer()</span><br><span class="line"></span><br><span class="line">data = pd.read_csv(<span class="string">"SMSSpamCollection.tsv"</span>, sep=<span class="string">'\t'</span>)</span><br><span class="line">data.columns = [<span class="string">'label'</span>, <span class="string">'body_text'</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count_punct</span><span class="params">(text)</span>:</span></span><br><span class="line">    count = sum([<span class="number">1</span> <span class="keyword">for</span> char <span class="keyword">in</span> text <span class="keyword">if</span> char <span class="keyword">in</span> string.punctuation])</span><br><span class="line">    <span class="keyword">return</span> round(count/(len(text) - text.count(<span class="string">" "</span>)), <span class="number">3</span>)*<span class="number">100</span></span><br><span class="line"></span><br><span class="line">data[<span class="string">'body_len'</span>] = data[<span class="string">'body_text'</span>].apply(<span class="keyword">lambda</span> x: len(x) - x.count(<span class="string">" "</span>))</span><br><span class="line">data[<span class="string">'punct%'</span>] = data[<span class="string">'body_text'</span>].apply(<span class="keyword">lambda</span> x: count_punct(x))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clean_text</span><span class="params">(text)</span>:</span></span><br><span class="line">    text = <span class="string">""</span>.join([word.lower() <span class="keyword">for</span> word <span class="keyword">in</span> text <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> string.punctuation])</span><br><span class="line">    tokens = re.split(<span class="string">'\W+'</span>, text)</span><br><span class="line">    text = [ps.stem(word) <span class="keyword">for</span> word <span class="keyword">in</span> tokens <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> stopwords]</span><br><span class="line">    <span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line">tfidf_vect = TfidfVectorizer(analyzer=clean_text)</span><br><span class="line">X_tfidf = tfidf_vect.fit_transform(data[<span class="string">'body_text'</span>])</span><br><span class="line"></span><br><span class="line">X_features = pd.concat([data[<span class="string">'body_len'</span>], data[<span class="string">'punct%'</span>], pd.DataFrame(X_tfidf.toarray())], axis=<span class="number">1</span>)</span><br><span class="line">X_features.head()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">body_len</th>
<th style="text-align:right">punct%</th>
<th style="text-align:right">0</th>
<th style="text-align:right">1</th>
<th style="text-align:right">2</th>
<th style="text-align:right">3</th>
<th style="text-align:right">4</th>
<th style="text-align:right">5</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">128</td>
<td style="text-align:right">4.7</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">49</td>
<td style="text-align:right">4.1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">62</td>
<td style="text-align:right">3.2</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">28</td>
<td style="text-align:right">7.1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">135</td>
<td style="text-align:right">4.4</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
</tbody>
</table>
<p>5 rows × 8106 columns</p>
<p>Import necessary package and print out the parameters as well as the hyperparameters:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestClassifier</span><br><span class="line"></span><br><span class="line">print(dir(RandomForestClassifier))</span><br><span class="line">print(RandomForestClassifier())</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'__abstractmethods__'</span>, <span class="string">'__class__'</span>, <span class="string">'__delattr__'</span>, <span class="string">'__dict__'</span>, <span class="string">'__dir__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__eq__'</span>, <span class="string">'__format__'</span>, <span class="string">'__ge__'</span>, <span class="string">'__getattribute__'</span>, <span class="string">'__getitem__'</span>, <span class="string">'__getstate__'</span>, <span class="string">'__gt__'</span>, <span class="string">'__hash__'</span>, <span class="string">'__init__'</span>, <span class="string">'__init_subclass__'</span>, <span class="string">'__iter__'</span>, <span class="string">'__le__'</span>, <span class="string">'__len__'</span>, <span class="string">'__lt__'</span>, <span class="string">'__module__'</span>, <span class="string">'__ne__'</span>, <span class="string">'__new__'</span>, <span class="string">'__reduce__'</span>, <span class="string">'__reduce_ex__'</span>, <span class="string">'__repr__'</span>, <span class="string">'__setattr__'</span>, <span class="string">'__setstate__'</span>, <span class="string">'__sizeof__'</span>, <span class="string">'__str__'</span>, <span class="string">'__subclasshook__'</span>, <span class="string">'__weakref__'</span>, <span class="string">'_abc_impl'</span>, <span class="string">'_estimator_type'</span>, <span class="string">'_get_param_names'</span>, <span class="string">'_get_tags'</span>, <span class="string">'_make_estimator'</span>, <span class="string">'_more_tags'</span>, <span class="string">'_required_parameters'</span>, <span class="string">'_set_oob_score'</span>, <span class="string">'_validate_X_predict'</span>, <span class="string">'_validate_estimator'</span>, <span class="string">'_validate_y_class_weight'</span>, <span class="string">'apply'</span>, <span class="string">'decision_path'</span>, <span class="string">'feature_importances_'</span>, <span class="string">'fit'</span>, <span class="string">'get_params'</span>, <span class="string">'predict'</span>, <span class="string">'predict_log_proba'</span>, <span class="string">'predict_proba'</span>, <span class="string">'score'</span>, <span class="string">'set_params'</span>]</span><br><span class="line">RandomForestClassifier(bootstrap=<span class="literal">True</span>, class_weight=<span class="literal">None</span>, criterion=<span class="string">'gini'</span>,</span><br><span class="line">                       max_depth=<span class="literal">None</span>, max_features=<span class="string">'auto'</span>, max_leaf_nodes=<span class="literal">None</span>,</span><br><span class="line">                       min_impurity_decrease=<span class="number">0.0</span>, min_impurity_split=<span class="literal">None</span>,</span><br><span class="line">                       min_samples_leaf=<span class="number">1</span>, min_samples_split=<span class="number">2</span>,</span><br><span class="line">                       min_weight_fraction_leaf=<span class="number">0.0</span>, n_estimators=<span class="string">'warn'</span>,</span><br><span class="line">                       n_jobs=<span class="literal">None</span>, oob_score=<span class="literal">False</span>, random_state=<span class="literal">None</span>,</span><br><span class="line">                       verbose=<span class="number">0</span>, warm_start=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>
<p>The first is <strong>feature_importances</strong>.  This is what outputs the value of each feature to the model. This is an awesome tool.  Most algorithms do not provide this, and it’s really helpful.  Then, <strong>fit</strong> is what allows you to fit your actual model and then you’ll store that fit model as an object.  Then, you can use this predict method from that fit model object, to make predictions on your test set.</p>
<p>The hyperparameters contained within our random forest classifier, that was printed out from here.  The first is <strong>max_depth</strong>, so this is going to be how deep each one of your decision trees is.  You’ll notice that the default is none.  Basically, that means that it will build each decision tree until it minimizes some loss criteria.  And then the second one is <strong>n_estimators</strong>.  This is how many decision trees that will be built within your random forest, so the default is 10.  These defaults mean, your random forest would build 10 decision trees of unlimited depth.  Then, there would be a vote among these 10 trees to determine the final prediction.</p>
<p>Import packages:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> KFold, cross_val_score</span><br></pre></td></tr></table></figure>
<p>What these functions will actually do is Kfold will actually facilitate the splitting of your full data set into the subsets that we saw in the slides, and then this cross_val_score is what will help us get the actual scoring.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Setting n_jobs to negative one allows this to run faster by building the individual decision trees in parallel.</span></span><br><span class="line">rf = RandomForestClassifier(n_jobs = <span class="number">-1</span>)</span><br><span class="line"><span class="comment"># Assigns each observation in our original data set to a certain subset, so there will be five subsets, and it will assign each observation to one of the five.</span></span><br><span class="line">k_fold = KFold(n_splits = <span class="number">5</span>)</span><br><span class="line"><span class="comment"># Put all of our components together and actually facilitate the cross-validation and return a score.</span></span><br><span class="line">cross_val_score(rf, X_features, data[<span class="string">"label"</span>], cv = k_fold, scoring = <span class="string">"accuracy"</span>, n_jobs = <span class="number">-1</span>)</span><br></pre></td></tr></table></figure>
<p><strong><em>Notice</em></strong>: Scikit-learn always expects you to input your X_features and your label separately in this way, so often people will just split up their original data frame into X_features and Y, before they even run anything through scikit-learn.</p>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array([<span class="number">0.96678636</span>, <span class="number">0.97307002</span>, <span class="number">0.96945193</span>, <span class="number">0.95507637</span>, <span class="number">0.95867026</span>])</span><br></pre></td></tr></table></figure>
<h2 id="random-forest-with-holdout-test-set"><a class="markdownIt-Anchor" href="#random-forest-with-holdout-test-set"></a> Random Forest with Holdout Test Set</h2>
<p>Reading in data, creating new features, cleaning that data, and then vectorizing it:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfVectorizer</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">stopwords = nltk.corpus.stopwords.words(<span class="string">'english'</span>)</span><br><span class="line">ps = nltk.PorterStemmer()</span><br><span class="line"></span><br><span class="line">data = pd.read_csv(<span class="string">"SMSSpamCollection.tsv"</span>, sep=<span class="string">'\t'</span>)</span><br><span class="line">data.columns = [<span class="string">'label'</span>, <span class="string">'body_text'</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count_punct</span><span class="params">(text)</span>:</span></span><br><span class="line">    count = sum([<span class="number">1</span> <span class="keyword">for</span> char <span class="keyword">in</span> text <span class="keyword">if</span> char <span class="keyword">in</span> string.punctuation])</span><br><span class="line">    <span class="keyword">return</span> round(count/(len(text) - text.count(<span class="string">" "</span>)), <span class="number">3</span>)*<span class="number">100</span></span><br><span class="line"></span><br><span class="line">data[<span class="string">'body_len'</span>] = data[<span class="string">'body_text'</span>].apply(<span class="keyword">lambda</span> x: len(x) - x.count(<span class="string">" "</span>))</span><br><span class="line">data[<span class="string">'punct%'</span>] = data[<span class="string">'body_text'</span>].apply(<span class="keyword">lambda</span> x: count_punct(x))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clean_text</span><span class="params">(text)</span>:</span></span><br><span class="line">    text = <span class="string">""</span>.join([word.lower() <span class="keyword">for</span> word <span class="keyword">in</span> text <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> string.punctuation])</span><br><span class="line">    tokens = re.split(<span class="string">'\W+'</span>, text)</span><br><span class="line">    text = [ps.stem(word) <span class="keyword">for</span> word <span class="keyword">in</span> tokens <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> stopwords]</span><br><span class="line">    <span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line">tfidf_vect = TfidfVectorizer(analyzer=clean_text)</span><br><span class="line">X_tfidf = tfidf_vect.fit_transform(data[<span class="string">'body_text'</span>])</span><br><span class="line"></span><br><span class="line">X_features = pd.concat([data[<span class="string">'body_len'</span>], data[<span class="string">'punct%'</span>], pd.DataFrame(X_tfidf.toarray())], axis=<span class="number">1</span>)</span><br><span class="line">X_features.head()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">body_len</th>
<th style="text-align:right">punct%</th>
<th style="text-align:right">0</th>
<th style="text-align:right">1</th>
<th style="text-align:right">2</th>
<th style="text-align:right">3</th>
<th style="text-align:right">4</th>
<th style="text-align:right">5</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">128</td>
<td style="text-align:right">4.7</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">49</td>
<td style="text-align:right">4.1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">62</td>
<td style="text-align:right">3.2</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">28</td>
<td style="text-align:right">7.1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">135</td>
<td style="text-align:right">4.4</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
</tbody>
</table>
<p>5 rows × 8106 columns</p>
<p>The first step is to import the precision recall F score support function, from the SK learn dot metrics module.  And we’re going to go ahead and store that as score, so that we don’t have to call the entire function name every time that we want to use it.  And then we’ll import the train test split function from SK learn dot model selection.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> precision_recall_fscore_support <span class="keyword">as</span> score</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br></pre></td></tr></table></figure>
<p>In the code below, the first step is to split our data into a training set, and a test set.  So we’ll call our train test split function, and what we’ll pass into this function, is first we’ll pass in the X features, and then we’ll pass in our label, so data bracket label, and then the last parameter that we need to pass in, is the test size, so in other words, what percent of our original dataset do we want to allocate to the test set.  And the commonly used value there is 20%, so 0.2.  This train test split will output four datasets.  We need to tell it what we want it to store it as.  So the first one that I’ll output is the X training set, so we’ll call it X train, then the next one is X test, and then Y train, and then Y test.  This train test split function will output four datasets, so we have to tell it what to name those datasets, or what we want it to output that data to.  So the first one that it’ll output is X train, and then the next one that it’ll output is X test, and then the next one that it’ll output is Y train, and then lastly, it will output Y test.  And it’s always in that order, so it’s very important that you name your data frames accordingly.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X_train, X_test, y_train, y_test = train_test_split(X_features, data[<span class="string">"label"</span>], test_size = <span class="number">0.2</span>)</span><br></pre></td></tr></table></figure>
<p>Import random forest classifier and setting hyperparameter settings as well as fitting the model:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestClassifier</span><br><span class="line"></span><br><span class="line">rf = RandomForestClassifier(n_estimators = <span class="number">50</span>, max_depth = <span class="number">20</span>, n_jobs = <span class="number">-1</span>)</span><br><span class="line">rf_model = rf.fit(X_train, y_train)</span><br></pre></td></tr></table></figure>
<p>Getting the feature importances:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># zip is going to wrapping two arrays together</span></span><br><span class="line">sorted(zip(rf_model.feature_importances_, X_train.columns),reverse = <span class="literal">True</span>)[<span class="number">0</span>:<span class="number">10</span>]</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[(<span class="number">0.04540639892466463</span>, <span class="string">'body_len'</span>),</span><br><span class="line"> (<span class="number">0.036445618263604075</span>, <span class="number">2031</span>),</span><br><span class="line"> (<span class="number">0.03464294621076255</span>, <span class="number">1803</span>),</span><br><span class="line"> (<span class="number">0.02565930331296738</span>, <span class="number">7350</span>),</span><br><span class="line"> (<span class="number">0.02306750491113629</span>, <span class="number">3134</span>),</span><br><span class="line"> (<span class="number">0.020295889836768586</span>, <span class="number">690</span>),</span><br><span class="line"> (<span class="number">0.019508213185219708</span>, <span class="number">6285</span>),</span><br><span class="line"> (<span class="number">0.01915515038000953</span>, <span class="number">4796</span>),</span><br><span class="line"> (<span class="number">0.018661422302080694</span>, <span class="number">1361</span>),</span><br><span class="line"> (<span class="number">0.01850313604894283</span>, <span class="number">5724</span>)]</span><br></pre></td></tr></table></figure>
<p>Now you’ll see all these numbers here, as we saw in our full data frame, when you vectorize, the actual words don’t become the column names, they’re just assigned a number.  So that’s what these represent.  But the main is that body length is pretty clearly the most important feature, which is not surprising, based on the feature evaluation that we did.</p>
<p>If you don’t see body length here, as your most important feature, that’s okay.  Random forest includes some random sampling for each of the decision trees, so if the sampling in your trees are slightly different than the sampling in my trees, you may come out with different feature importances.  So you may run your model a few different times, and each time you could get slightly different feature importances.</p>
<p>Making prediction and see the score:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">y_pred = rf_model.predict(X_test)</span><br><span class="line">precision, recall, fscore, support = score(y_test, y_pred, pos_label = <span class="string">"spam"</span>, average = <span class="string">"binary"</span>)</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Precision: <span class="number">1.0</span> / Recall: <span class="number">0.616</span> / Accuracy: <span class="number">0.95</span></span><br></pre></td></tr></table></figure>
<p>So just as a reminder of what that actually means in the context of a spam filter, 100% precision, what that actually means is that when the model identified something as spam, it actually was spam 100% of the time.  So that’s great. The 61.6% recall means that of all the spam that has come into your email, 61.6% of that spam was properly placed in the spam folder, which means that the other 44.8% went into your inbox, so that’s not great.  And lastly, the 95% accuracy just means that of all the emails that came into your email, spam or non-spam, they were identified correctly as one or the other, 95% of the time.  So in summary, the amount of spam still making it to our inbox, tells us that our model’s not quite aggressive enough in identifying spam.</p>
<h2 id="random-forest-model-with-grid-search"><a class="markdownIt-Anchor" href="#random-forest-model-with-grid-search"></a> Random Forest Model with Grid Search</h2>
<p>In the last session, we fit just a single model with a single set of hyperparameter settings, and then we generated a single set of evaluation metrics.  But aren’t you a little curious to see if we can maybe make our model better, simply by changing the hyperparameter settings, like the number of estimators, or the max depth?  We mentioned the last model wasn’t quite aggressive enough. Could we capture more spam by altering the hyperparameter settings? That’s where grid-search comes in. Grid-search basically means defining a grid of hyperparameter settings, and then exploring a model fit with each combination of those hyperparameter settings. So in our case, that means setting a range of number of estimators, and a range of max depth, that you’d like to explore. And then grid-search will test every combination of those, and fit a model and evaluate it, to see which hyperparameter combination generates the best model.</p>
<p>Clean the data:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfVectorizer</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">stopwords = nltk.corpus.stopwords.words(<span class="string">'english'</span>)</span><br><span class="line">ps = nltk.PorterStemmer()</span><br><span class="line"></span><br><span class="line">data = pd.read_csv(<span class="string">"SMSSpamCollection.tsv"</span>, sep=<span class="string">'\t'</span>)</span><br><span class="line">data.columns = [<span class="string">'label'</span>, <span class="string">'body_text'</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count_punct</span><span class="params">(text)</span>:</span></span><br><span class="line">    count = sum([<span class="number">1</span> <span class="keyword">for</span> char <span class="keyword">in</span> text <span class="keyword">if</span> char <span class="keyword">in</span> string.punctuation])</span><br><span class="line">    <span class="keyword">return</span> round(count/(len(text) - text.count(<span class="string">" "</span>)), <span class="number">3</span>)*<span class="number">100</span></span><br><span class="line"></span><br><span class="line">data[<span class="string">'body_len'</span>] = data[<span class="string">'body_text'</span>].apply(<span class="keyword">lambda</span> x: len(x) - x.count(<span class="string">" "</span>))</span><br><span class="line">data[<span class="string">'punct%'</span>] = data[<span class="string">'body_text'</span>].apply(<span class="keyword">lambda</span> x: count_punct(x))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clean_text</span><span class="params">(text)</span>:</span></span><br><span class="line">    text = <span class="string">""</span>.join([word.lower() <span class="keyword">for</span> word <span class="keyword">in</span> text <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> string.punctuation])</span><br><span class="line">    tokens = re.split(<span class="string">'\W+'</span>, text)</span><br><span class="line">    text = [ps.stem(word) <span class="keyword">for</span> word <span class="keyword">in</span> tokens <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> stopwords]</span><br><span class="line">    <span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line">tfidf_vect = TfidfVectorizer(analyzer=clean_text)</span><br><span class="line">X_tfidf = tfidf_vect.fit_transform(data[<span class="string">'body_text'</span>])</span><br><span class="line"></span><br><span class="line">X_features = pd.concat([data[<span class="string">'body_len'</span>], data[<span class="string">'punct%'</span>], pd.DataFrame(X_tfidf.toarray())], axis=<span class="number">1</span>)</span><br><span class="line">X_features.head()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">body_len</th>
<th style="text-align:right">punct%</th>
<th style="text-align:right">0</th>
<th style="text-align:right">1</th>
<th style="text-align:right">2</th>
<th style="text-align:right">3</th>
<th style="text-align:right">4</th>
<th style="text-align:right">5</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">128</td>
<td style="text-align:right">4.7</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">49</td>
<td style="text-align:right">4.1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">62</td>
<td style="text-align:right">3.2</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">28</td>
<td style="text-align:right">7.1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">135</td>
<td style="text-align:right">4.4</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
</tbody>
</table>
<p>5 rows × 8106 columns</p>
<p>Import some necessary packages:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestClassifier</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> precision_recall_fscore_support <span class="keyword">as</span> score</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br></pre></td></tr></table></figure>
<p>Splitting the data into training and test set:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X_train, X_test, y_train, y_test = train_test_split(X_features, data[<span class="string">'label'</span>], test_size=<span class="number">0.2</span>)</span><br></pre></td></tr></table></figure>
<p>The function to train and predict the data:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train_RF</span><span class="params">(n_est, depth)</span>:</span></span><br><span class="line">       rf = RandomForestClassifier(n_estimators = n_est, max_depth = depth, n_jobs = <span class="number">-1</span>)</span><br><span class="line">       rf_model = rf.fit(X_train, y_train)</span><br><span class="line">       y_pred = rf_model.predict(X_test)</span><br><span class="line">       precision, recall, fscore, support = score(y_test, y_pred, pos_label = <span class="string">"spam"</span>, average = <span class="string">"binary"</span>)</span><br><span class="line">       print(<span class="string">"Est: &#123;&#125; / Depth: &#123;&#125; ---- Precision: &#123;&#125; / Recall: &#123;&#125; / Accuracy: &#123;&#125;"</span>.format(n_est,</span><br><span class="line">                                                                                        depth,</span><br><span class="line">                                                                                        round(precision, <span class="number">3</span>),</span><br><span class="line">                                                                                        round(recall, <span class="number">3</span>),</span><br><span class="line">                                                                                        round((y_pred == y_test).sum() / len(y_pred), <span class="number">3</span>)))</span><br></pre></td></tr></table></figure>
<p>So now we have the function above that accepts number of estimators, and depth, constructs a random forest classifier object, using those number of estimators and depth, fits that model, predicts, and then generates some results metrics, and prints out those results at the very end.</p>
<p>The following nested for loop will iterate through each combination of these parameter settings, and train a model, evaluate that model on a test set, and then print out the results.  That’s essentially what grid-search is.  So the first time through, we’ll grab number of estimators equal to 10, and depth equal to 10, it’ll pass it into our function above, it’ll fit a model with those parameter settings and print out the results, and then it’ll iterate through each combination.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> n_est <span class="keyword">in</span> [<span class="number">10</span>, <span class="number">50</span>, <span class="number">100</span>]:</span><br><span class="line">    <span class="keyword">for</span> depth <span class="keyword">in</span> [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="literal">None</span>]:</span><br><span class="line">        train_RF(n_est, depth)</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Est: <span class="number">10</span> / Depth: <span class="number">10</span> ---- Precision: <span class="number">1.0</span> / Recall: <span class="number">0.408</span> / Accuracy: <span class="number">0.934</span></span><br><span class="line">Est: <span class="number">10</span> / Depth: <span class="number">20</span> ---- Precision: <span class="number">1.0</span> / Recall: <span class="number">0.6</span> / Accuracy: <span class="number">0.955</span></span><br><span class="line">Est: <span class="number">10</span> / Depth: <span class="number">30</span> ---- Precision: <span class="number">1.0</span> / Recall: <span class="number">0.736</span> / Accuracy: <span class="number">0.97</span></span><br><span class="line">Est: <span class="number">10</span> / Depth: <span class="literal">None</span> ---- Precision: <span class="number">0.991</span> / Recall: <span class="number">0.84</span> / Accuracy: <span class="number">0.981</span></span><br><span class="line">Est: <span class="number">50</span> / Depth: <span class="number">10</span> ---- Precision: <span class="number">1.0</span> / Recall: <span class="number">0.264</span> / Accuracy: <span class="number">0.917</span></span><br><span class="line">Est: <span class="number">50</span> / Depth: <span class="number">20</span> ---- Precision: <span class="number">1.0</span> / Recall: <span class="number">0.632</span> / Accuracy: <span class="number">0.959</span></span><br><span class="line">Est: <span class="number">50</span> / Depth: <span class="number">30</span> ---- Precision: <span class="number">1.0</span> / Recall: <span class="number">0.752</span> / Accuracy: <span class="number">0.972</span></span><br><span class="line">Est: <span class="number">50</span> / Depth: <span class="literal">None</span> ---- Precision: <span class="number">0.991</span> / Recall: <span class="number">0.84</span> / Accuracy: <span class="number">0.981</span></span><br><span class="line">Est: <span class="number">100</span> / Depth: <span class="number">10</span> ---- Precision: <span class="number">1.0</span> / Recall: <span class="number">0.312</span> / Accuracy: <span class="number">0.923</span></span><br><span class="line">Est: <span class="number">100</span> / Depth: <span class="number">20</span> ---- Precision: <span class="number">1.0</span> / Recall: <span class="number">0.624</span> / Accuracy: <span class="number">0.958</span></span><br><span class="line">Est: <span class="number">100</span> / Depth: <span class="number">30</span> ---- Precision: <span class="number">1.0</span> / Recall: <span class="number">0.752</span> / Accuracy: <span class="number">0.972</span></span><br><span class="line">Est: <span class="number">100</span> / Depth: <span class="literal">None</span> ---- Precision: <span class="number">1.0</span> / Recall: <span class="number">0.848</span> / Accuracy: <span class="number">0.983</span></span><br></pre></td></tr></table></figure>
<p>So in this example, as the depth increases from 10, to 20, to 30, and eventually to none, the recall increases quite drastically, while you see the precision doesn’t really drop.  So the model is getting much better and more aggressive as the depth increases.  On the other side, you’ll notice that adding estimators might be helping a little bit, but the improvement isn’t as drastic as adding depth to the individual trees.  So by looking at these results, we can immediately eliminate any model that has a limited max depth.  10 is clearly pretty bad, no matter how many estimators you have.  20 isn’t really great either. Once you get towards 30, it starts to level out.  So we know that the best random forest model is one with very high max depth, probably no limit.  And number of estimators plays a little bit of a role, but not nearly as much as max depth.  So this is a very broad view into how we would typically approach model fitting and evaluation.  In general, we would explore a much wider range for each parameter setting, and we would probably explore more parameters also.</p>
<h2 id="evaluate-random-forest-model-performance"><a class="markdownIt-Anchor" href="#evaluate-random-forest-model-performance"></a> Evaluate Random Forest Model Performance</h2>
<p>we’re going to combine <strong>grid search</strong> and <strong>cross-validation</strong> to create a very powerful model tuning and evaluation tool that is often the default tool for tuning and evaluating machine learning models.  To recap very quickly, grid search is setting up different parameter settings that you want to test and then exhaustively searching that entire grid to determine the best model.  And then cross-validation takes your data set, divides it into k subsets, then you repeat the holdout method where you train on some data set and evaluate it on a separate data set k times.  So, in each iteration, you’re using a different subset of data as the test set and all the rest of the data as training set.  So, combining these ideas into GridSearchCV, what this method will allow you to do is define a grid of parameters that you want to explore and then within each setting, it will run cross-validation.</p>
<p>Clean the data and use two vectorisation methods - tf-idf and count vectoriser:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfVectorizer, CountVectorizer</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">stopwords = nltk.corpus.stopwords.words(<span class="string">'english'</span>)</span><br><span class="line">ps = nltk.PorterStemmer()</span><br><span class="line"></span><br><span class="line">data = pd.read_csv(<span class="string">"SMSSpamCollection.tsv"</span>, sep=<span class="string">'\t'</span>)</span><br><span class="line">data.columns = [<span class="string">'label'</span>, <span class="string">'body_text'</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count_punct</span><span class="params">(text)</span>:</span></span><br><span class="line">    count = sum([<span class="number">1</span> <span class="keyword">for</span> char <span class="keyword">in</span> text <span class="keyword">if</span> char <span class="keyword">in</span> string.punctuation])</span><br><span class="line">    <span class="keyword">return</span> round(count/(len(text) - text.count(<span class="string">" "</span>)), <span class="number">3</span>)*<span class="number">100</span></span><br><span class="line"></span><br><span class="line">data[<span class="string">'body_len'</span>] = data[<span class="string">'body_text'</span>].apply(<span class="keyword">lambda</span> x: len(x) - x.count(<span class="string">" "</span>))</span><br><span class="line">data[<span class="string">'punct%'</span>] = data[<span class="string">'body_text'</span>].apply(<span class="keyword">lambda</span> x: count_punct(x))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clean_text</span><span class="params">(text)</span>:</span></span><br><span class="line">    text = <span class="string">""</span>.join([word.lower() <span class="keyword">for</span> word <span class="keyword">in</span> text <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> string.punctuation])</span><br><span class="line">    tokens = re.split(<span class="string">'\W+'</span>, text)</span><br><span class="line">    text = [ps.stem(word) <span class="keyword">for</span> word <span class="keyword">in</span> tokens <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> stopwords]</span><br><span class="line">    <span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line"><span class="comment"># TF-IDF</span></span><br><span class="line">tfidf_vect = TfidfVectorizer(analyzer=clean_text)</span><br><span class="line">X_tfidf = tfidf_vect.fit_transform(data[<span class="string">'body_text'</span>])</span><br><span class="line">X_tfidf_feat = pd.concat([data[<span class="string">'body_len'</span>], data[<span class="string">'punct%'</span>], pd.DataFrame(X_tfidf.toarray())], axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># CountVectorizer</span></span><br><span class="line">count_vect = CountVectorizer(analyzer=clean_text)</span><br><span class="line">X_count = count_vect.fit_transform(data[<span class="string">'body_text'</span>])</span><br><span class="line">X_count_feat = pd.concat([data[<span class="string">'body_len'</span>], data[<span class="string">'punct%'</span>], pd.DataFrame(X_count.toarray())], axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">X_count_feat.head()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">body_len</th>
<th style="text-align:right">punct%</th>
<th style="text-align:right">0</th>
<th style="text-align:right">1</th>
<th style="text-align:right">2</th>
<th style="text-align:right">3</th>
<th style="text-align:right">4</th>
<th style="text-align:right">5</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">128</td>
<td style="text-align:right">4.7</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">49</td>
<td style="text-align:right">4.1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">62</td>
<td style="text-align:right">3.2</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">28</td>
<td style="text-align:right">7.1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">135</td>
<td style="text-align:right">4.4</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
</tbody>
</table>
<p>5 rows × 8106 columns</p>
<p>Import some necessary packages:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestClassifier</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> GridSearchCV</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Instentiate randon forest classifier</span></span><br><span class="line">rf = RandomForestClassifier()</span><br><span class="line"><span class="comment"># Parameter gird</span></span><br><span class="line">param = &#123;<span class="string">'n_estimators'</span>: [<span class="number">10</span>, <span class="number">150</span>, <span class="number">300</span>],</span><br><span class="line">        <span class="string">'max_depth'</span>: [<span class="number">30</span>, <span class="number">60</span>, <span class="number">90</span>, <span class="literal">None</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Construct GridSearchCV object</span></span><br><span class="line">gs = GridSearchCV(rf, param, cv=<span class="number">5</span>, n_jobs=<span class="number">-1</span>)</span><br><span class="line"><span class="comment"># Fit the model</span></span><br><span class="line">gs_fit = gs.fit(X_tfidf_feat, data[<span class="string">'label'</span>])</span><br><span class="line"><span class="comment"># Print out the result using attribute called cv_results_</span></span><br><span class="line">tfidf_result = pd.DataFrame(gs_fit.cv_results_).sort_values(<span class="string">'mean_test_score'</span>, ascending=<span class="literal">False</span>)[<span class="number">0</span>:<span class="number">5</span>]</span><br></pre></td></tr></table></figure>
<p>Same process as above but change the vectorisor into count vectorisor:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rf = RandomForestClassifier()</span><br><span class="line">param = &#123;<span class="string">'n_estimators'</span>: [<span class="number">10</span>, <span class="number">150</span>, <span class="number">300</span>],</span><br><span class="line">        <span class="string">'max_depth'</span>: [<span class="number">30</span>, <span class="number">60</span>, <span class="number">90</span>, <span class="literal">None</span>]&#125;</span><br><span class="line"></span><br><span class="line">gs = GridSearchCV(rf, param, cv=<span class="number">5</span>, n_jobs=<span class="number">-1</span>)</span><br><span class="line">gs_fit = gs.fit(X_count_feat, data[<span class="string">'label'</span>])</span><br><span class="line">count_result = pd.DataFrame(gs_fit.cv_results_).sort_values(<span class="string">'mean_test_score'</span>, ascending=<span class="literal">False</span>)[<span class="number">0</span>:<span class="number">5</span>]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tfidf_result[[<span class="string">"mean_fit_time"</span>, <span class="string">"mean_score_time"</span>, <span class="string">"mean_test_score"</span>, <span class="string">"param_max_depth"</span>, <span class="string">"param_n_estimators"</span>]]</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">mean_fit_time</th>
<th style="text-align:right">mean_score_time</th>
<th style="text-align:right">mean_test_score</th>
<th style="text-align:right">param_max_depth</th>
<th style="text-align:right">param_n_estimators</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">8</td>
<td style="text-align:right">47.2303</td>
<td style="text-align:right">0.59588</td>
<td style="text-align:right">0.974852</td>
<td style="text-align:right">90</td>
<td style="text-align:right">300</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">24.3235</td>
<td style="text-align:right">0.403694</td>
<td style="text-align:right">0.974313</td>
<td style="text-align:right">90</td>
<td style="text-align:right">150</td>
</tr>
<tr>
<td style="text-align:right">10</td>
<td style="text-align:right">25.5253</td>
<td style="text-align:right">0.390608</td>
<td style="text-align:right">0.973954</td>
<td style="text-align:right">None</td>
<td style="text-align:right">150</td>
</tr>
<tr>
<td style="text-align:right">11</td>
<td style="text-align:right">36.2061</td>
<td style="text-align:right">0.268437</td>
<td style="text-align:right">0.972876</td>
<td style="text-align:right">None</td>
<td style="text-align:right">300</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">3.63283</td>
<td style="text-align:right">0.183171</td>
<td style="text-align:right">0.972517</td>
<td style="text-align:right">60</td>
<td style="text-align:right">10</td>
</tr>
</tbody>
</table>
<p>There are 12 parameter combinations, so there’s 12 lines in this data set, but we’re only looking at the top five.  mean_fit_time is the average time it takes each model to fit, mean_score_time is the average amount of time it takes each model to make a prediction on the test set, mean_test_score is the average accuracy on the test set, and then mean_train_score is the average accuracy on the training set.  So in terms of parameter combinations, you’ll notice that the best performing models are the ones with the deepest individual decision trees.  And you’ll see with the number of estimators doesn’t seem to matter quite as much as the top model.  If you look at the mean_fit_time, you’ll see that it’s much, much faster for 10 estimators than it is for 150 or 300.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">count_result[[<span class="string">"mean_fit_time"</span>, <span class="string">"mean_score_time"</span>, <span class="string">"mean_test_score"</span>, <span class="string">"param_max_depth"</span>, <span class="string">"param_n_estimators"</span>]]</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">mean_fit_time</th>
<th style="text-align:right">mean_score_time</th>
<th style="text-align:right">mean_test_score</th>
<th style="text-align:right">param_max_depth</th>
<th style="text-align:right">param_n_estimators</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">18.9076</td>
<td style="text-align:right">0.260673</td>
<td style="text-align:right">0.973056</td>
<td style="text-align:right">90</td>
<td style="text-align:right">150</td>
</tr>
<tr>
<td style="text-align:right">8</td>
<td style="text-align:right">36.1114</td>
<td style="text-align:right">0.410019</td>
<td style="text-align:right">0.972517</td>
<td style="text-align:right">90</td>
<td style="text-align:right">300</td>
</tr>
<tr>
<td style="text-align:right">11</td>
<td style="text-align:right">32.4232</td>
<td style="text-align:right">0.290319</td>
<td style="text-align:right">0.972337</td>
<td style="text-align:right">None</td>
<td style="text-align:right">300</td>
</tr>
<tr>
<td style="text-align:right">10</td>
<td style="text-align:right">20.0984</td>
<td style="text-align:right">0.265436</td>
<td style="text-align:right">0.971978</td>
<td style="text-align:right">None</td>
<td style="text-align:right">150</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">29.0064</td>
<td style="text-align:right">0.329088</td>
<td style="text-align:right">0.970181</td>
<td style="text-align:right">60</td>
<td style="text-align:right">300</td>
</tr>
</tbody>
</table>
<p>So now let’s take a look at how the mean_test_score on this tf-idf data set compares to the count vectorizer data set.  Let’s scroll down here and this is exactly the same setup as the prior section, just with the CountVectorizer instead of TfidfVectorizer.  So, this call out that the mean_test_score at 97.3% is just a tad below the 97.4% for the tf-idf, so tf-idf is doing slightly better.</p>
<p>In practice, we would usually explore a lot more settings than we’re exploring here. We would also test N-grams, whether we should include stopwords, whether removing punctuation is helpful, and we test different parameters within the vectorizer and four, five other hyperparameter settings within Random Forest. As you can imagine, exploring all these different combinations can quickly generate an enormous base of candidate models. It’s not uncommon to test over a hundred or even a thousand in some cases. So, that’s a quick introduction into Random Forest and learning how to tune and evaluate the model using two different vectorizing frameworks.</p>
<h2 id="introducting-gradient-boosting"><a class="markdownIt-Anchor" href="#introducting-gradient-boosting"></a> Introducting Gradient Boosting</h2>
<p><strong>Gradient Boosting</strong> has some similarities to random forest, but some key differences as well.  Gradient boosting is also an ensemble method, just like random forest.  Just a quick review, the ensemble method is a technique that created multiple models and then combines them to produce better results than any of the single models individually.  Gradient boosting is an ensemble method that takes an iterative approach to combining weak learners to create a strong learner by focusing on the mistakes of prior iterations.  So in the previous session, we learned about how random forest builds a certain number of fully-grown decision trees simultaneously.  And then it uses a voting method to combine the predictions of each.  Gradient boosting uses decision trees as well, but they’re incredibly basic, like a decision stump.  And then it evaluates what it gets right and what it gets wrong on that first tree, and then with the next iteration it places a heavier weight on those observations that it got wrong and it does this over and over and over again focusing on the examples it doesn’t quite understand yet until it has minimized the error as much as possible.</p>
<p>So this is an incredibly powerful technique but you might be thinking, how is this really different than random forest?  They are the same in that they’re both ensemble methods based on decision trees, but there’s a lot of differences as well. For instance, they’re different in that gradient boosting uses a method called “boosting” while random forest used a method called “bagging”.  Both of these methods include sampling for each different tree that is built.  The five second version of the difference between boosting and bagging is that bagging samples randomly, while boosting samples with an increased weight on the ones that it got wrong previously.  Because all the trees in a random forest are built without any consideration for any of the other trees, this is incredibly easy to parallelize, which means that it can train really quickly.  So if you have 100 trees, you could train them all at the same time.  Whereas gradient boosting is iterative in that it relies on the results of the tree before it in order to apply a higher weight to the ones that the previous tree got incorrect.  So boosting can’t be parallelized and so it takes much longer to train.  As you get into massive training sets, this becomes a serious consideration.</p>
<p>Another difference is that the final predictions for random forest are typically an unweighted average or an unweighted voting, while boosting uses a weighted voting.  And then lastly, random forest is easier to tune, faster to train and harder to overfit, while gradient boosting is harder to tune, slower to train, and easier to overfit.  So with that, why would you go with gradient boosting?  Well, the trade off is that gradient boosting is typically more powerful and better-performing if tuned properly.</p>
<p>Enough about random forest.  Let’s focus on just gradient boosting.  So what are the benefits?  Well, it’s one of the most powerful machine learning classifiers out there.  It also accepts various types of inputs just like random forest so it makes it very flexible.  It can also be used for classification or regression, and the outputs feature importances which can be super useful.  But it’s not perfect.  Some of the drawbacks are that it takes longer to train because it can’t be parallelized, it’s more likely to overfit because it obsesses over those ones that it got wrong, and it can get lost pursuing those outliers that don’t really represent the overall population.  And it’s harder to tune because there are more parameters.  That’s a very, very brief introduction into gradient boosting.</p>
<h2 id="gradient-boosting-grid-search"><a class="markdownIt-Anchor" href="#gradient-boosting-grid-search"></a> Gradient-boosting Grid Search</h2>
<p>Read in and clean data using tf-idf:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfVectorizer</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">stopwords = nltk.corpus.stopwords.words(<span class="string">'english'</span>)</span><br><span class="line">ps = nltk.PorterStemmer()</span><br><span class="line"></span><br><span class="line">data = pd.read_csv(<span class="string">"SMSSpamCollection.tsv"</span>, sep=<span class="string">'\t'</span>)</span><br><span class="line">data.columns = [<span class="string">'label'</span>, <span class="string">'body_text'</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count_punct</span><span class="params">(text)</span>:</span></span><br><span class="line">    count = sum([<span class="number">1</span> <span class="keyword">for</span> char <span class="keyword">in</span> text <span class="keyword">if</span> char <span class="keyword">in</span> string.punctuation])</span><br><span class="line">    <span class="keyword">return</span> round(count/(len(text) - text.count(<span class="string">" "</span>)), <span class="number">3</span>)*<span class="number">100</span></span><br><span class="line"></span><br><span class="line">data[<span class="string">'body_len'</span>] = data[<span class="string">'body_text'</span>].apply(<span class="keyword">lambda</span> x: len(x) - x.count(<span class="string">" "</span>))</span><br><span class="line">data[<span class="string">'punct%'</span>] = data[<span class="string">'body_text'</span>].apply(<span class="keyword">lambda</span> x: count_punct(x))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clean_text</span><span class="params">(text)</span>:</span></span><br><span class="line">    text = <span class="string">""</span>.join([word.lower() <span class="keyword">for</span> word <span class="keyword">in</span> text <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> string.punctuation])</span><br><span class="line">    tokens = re.split(<span class="string">'\W+'</span>, text)</span><br><span class="line">    text = [ps.stem(word) <span class="keyword">for</span> word <span class="keyword">in</span> tokens <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> stopwords]</span><br><span class="line">    <span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line">tfidf_vect = TfidfVectorizer(analyzer=clean_text)</span><br><span class="line">X_tfidf = tfidf_vect.fit_transform(data[<span class="string">'body_text'</span>])</span><br><span class="line"></span><br><span class="line">X_features = pd.concat([data[<span class="string">'body_len'</span>], data[<span class="string">'punct%'</span>], pd.DataFrame(X_tfidf.toarray())], axis=<span class="number">1</span>)</span><br><span class="line">X_features.head()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">body_len</th>
<th style="text-align:right">punct%</th>
<th style="text-align:right">0</th>
<th style="text-align:right">1</th>
<th style="text-align:right">2</th>
<th style="text-align:right">3</th>
<th style="text-align:right">4</th>
<th style="text-align:right">5</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">128</td>
<td style="text-align:right">4.7</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">49</td>
<td style="text-align:right">4.1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">62</td>
<td style="text-align:right">3.2</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">28</td>
<td style="text-align:right">7.1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">135</td>
<td style="text-align:right">4.4</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
</tbody>
</table>
<p>5 rows × 8106 columns</p>
<p>Import the package for the classifier:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> GradientBoostingClassifier</span><br></pre></td></tr></table></figure>
<p>Print out the attributes:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(dir(GradientBoostingClassifier))</span><br><span class="line">print(GradientBoostingClassifier())</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'_SUPPORTED_LOSS'</span>, <span class="string">'__abstractmethods__'</span>, <span class="string">'__class__'</span>, <span class="string">'__delattr__'</span>, <span class="string">'__dict__'</span>, <span class="string">'__dir__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__eq__'</span>, <span class="string">'__format__'</span>, <span class="string">'__ge__'</span>, <span class="string">'__getattribute__'</span>, <span class="string">'__getitem__'</span>, <span class="string">'__getstate__'</span>, <span class="string">'__gt__'</span>, <span class="string">'__hash__'</span>, <span class="string">'__init__'</span>, <span class="string">'__init_subclass__'</span>, <span class="string">'__iter__'</span>, <span class="string">'__le__'</span>, <span class="string">'__len__'</span>, <span class="string">'__lt__'</span>, <span class="string">'__module__'</span>, <span class="string">'__ne__'</span>, <span class="string">'__new__'</span>, <span class="string">'__reduce__'</span>, <span class="string">'__reduce_ex__'</span>, <span class="string">'__repr__'</span>, <span class="string">'__setattr__'</span>, <span class="string">'__setstate__'</span>, <span class="string">'__sizeof__'</span>, <span class="string">'__str__'</span>, <span class="string">'__subclasshook__'</span>, <span class="string">'__weakref__'</span>, <span class="string">'_abc_impl'</span>, <span class="string">'_check_initialized'</span>, <span class="string">'_check_params'</span>, <span class="string">'_clear_state'</span>, <span class="string">'_estimator_type'</span>, <span class="string">'_fit_stage'</span>, <span class="string">'_fit_stages'</span>, <span class="string">'_get_param_names'</span>, <span class="string">'_get_tags'</span>, <span class="string">'_init_state'</span>, <span class="string">'_is_initialized'</span>, <span class="string">'_make_estimator'</span>, <span class="string">'_raw_predict'</span>, <span class="string">'_raw_predict_init'</span>, <span class="string">'_required_parameters'</span>, <span class="string">'_resize_state'</span>, <span class="string">'_staged_raw_predict'</span>, <span class="string">'_validate_estimator'</span>, <span class="string">'_validate_y'</span>, <span class="string">'apply'</span>, <span class="string">'decision_function'</span>, <span class="string">'feature_importances_'</span>, <span class="string">'fit'</span>, <span class="string">'get_params'</span>, <span class="string">'predict'</span>, <span class="string">'predict_log_proba'</span>, <span class="string">'predict_proba'</span>, <span class="string">'score'</span>, <span class="string">'set_params'</span>, <span class="string">'staged_decision_function'</span>, <span class="string">'staged_predict'</span>, <span class="string">'staged_predict_proba'</span>]</span><br><span class="line">GradientBoostingClassifier(criterion=<span class="string">'friedman_mse'</span>, init=<span class="literal">None</span>,</span><br><span class="line">                           learning_rate=<span class="number">0.1</span>, loss=<span class="string">'deviance'</span>, max_depth=<span class="number">3</span>,</span><br><span class="line">                           max_features=<span class="literal">None</span>, max_leaf_nodes=<span class="literal">None</span>,</span><br><span class="line">                           min_impurity_decrease=<span class="number">0.0</span>, min_impurity_split=<span class="literal">None</span>,</span><br><span class="line">                           min_samples_leaf=<span class="number">1</span>, min_samples_split=<span class="number">2</span>,</span><br><span class="line">                           min_weight_fraction_leaf=<span class="number">0.0</span>, n_estimators=<span class="number">100</span>,</span><br><span class="line">                           n_iter_no_change=<span class="literal">None</span>, presort=<span class="string">'auto'</span>,</span><br><span class="line">                           random_state=<span class="literal">None</span>, subsample=<span class="number">1.0</span>, tol=<span class="number">0.0001</span>,</span><br><span class="line">                           validation_fraction=<span class="number">0.1</span>, verbose=<span class="number">0</span>,</span><br><span class="line">                           warm_start=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>
<p>Now, for the attributes and methods, you can see that they’re almost exactly the same as they are with random forest.  So, you’ll notice our fit, you’ll notice our predict, you’ll the feature importances.  This is one of the great things about scikit learn Once you learn how to use one classifier or object, you pretty much know how to use them all, even down to the naming conventions of the actual models.  So you have random forest classifier, we have gradient boosting classifier, and then if we’re to expand from there, we have logistic regression and so on and so on.  Looking at the default settings and the hyperparameter settings for gradient boosting, you’ll again see max depth, and you’ll also see n estimators.</p>
<p>If you recall back to random forest, the default setting for max depth was none, so it could build each tree as deep as it wanted.  Here, the max depth default setting is three.  Then again, for random forest the default for the number of estimators was 10, and for gradient boosting it’s 100.  So that calls out one of the big differences between random forest and gradient boosting.  Random forest is built with a couple fully grown trees, whereas gradient boosting uses a lot of very basic trees, which speaks to how these models are build differently, and even how they optimize differently.  Another thing that you’ll notice, is that there’s no end jobs parameter here like we saw for random forest.  Remember that parameter made your model train faster, by parallelizing it.  But as we mentioned before, you can’t parallelize gradient boosting because each iteration builds on the prior iteration.  So that’s why we don’t have that end jobs parameter.  There is one more parameter: and that’s the learning rate parameter.  Learning rate determines how quickly an algorithm optimizes, but it also has performance implications, because it can cause the model to optimize too quickly, without truly finding the best model.</p>
<p>Import packages:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> precision_recall_fscore_support <span class="keyword">as</span> score</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br></pre></td></tr></table></figure>
<p>Split the data:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X_train, X_test, y_train, y_test = train_test_split(X_features, data[<span class="string">'label'</span>], test_size=<span class="number">0.2</span>)</span><br></pre></td></tr></table></figure>
<p>The following code is the function to perform gradient boosting:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train_GB</span><span class="params">(est, max_depth, lr)</span>:</span></span><br><span class="line">    gb = GradientBoostingClassifier(n_estimators = est, max_depth = max_depth, learning_rate = lr)</span><br><span class="line">    gb_model = gb.fit(X_train, y_train)</span><br><span class="line">    y_pred = gb_model.predict(X_test)</span><br><span class="line">    precision, recall, fscore, support = score(y_test, y_pred, pos_label = <span class="string">"spam"</span>, average = <span class="string">"binary"</span>)</span><br><span class="line">    print(<span class="string">"Est: &#123;&#125; / Depth: &#123;&#125; / LR: &#123;&#125; ---- Precision: &#123;&#125; / Recall: &#123;&#125; / Accuracy: &#123;&#125;"</span>.format(est,</span><br><span class="line">                                                                                              max_depth,</span><br><span class="line">                                                                                              lr,</span><br><span class="line">                                                                                              round(precision, <span class="number">3</span>),</span><br><span class="line">                                                                                              round(recall, <span class="number">3</span>),</span><br><span class="line">                                                                                              round((y_pred == y_test).sum() / len(y_pred), <span class="number">3</span>)))</span><br></pre></td></tr></table></figure>
<p>Using grid search to train the model:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> n_est <span class="keyword">in</span> [<span class="number">50</span>, <span class="number">100</span>, <span class="number">150</span>]:</span><br><span class="line">    <span class="keyword">for</span> max_depth <span class="keyword">in</span> [<span class="number">3</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">15</span>]:</span><br><span class="line">        <span class="keyword">for</span> lr <span class="keyword">in</span> [<span class="number">0.01</span>, <span class="number">0.1</span>, <span class="number">1</span>]:</span><br><span class="line">            train_GB(n_est, max_depth, lr)</span><br></pre></td></tr></table></figure>
<p>Because gradient boosting can’t be parallelized, and because we’re testing so many parameter settings, this could take an hour or two to run on your exercise notebooks.</p>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">Est: <span class="number">50</span> / Depth: <span class="number">3</span> / LR: <span class="number">0.01</span> ---- Precision: <span class="number">0.0</span> / Recall: <span class="number">0.0</span> / Accuracy: <span class="number">0.866</span></span><br><span class="line">Est: <span class="number">50</span> / Depth: <span class="number">3</span> / LR: <span class="number">0.1</span> ---- Precision: <span class="number">0.936</span> / Recall: <span class="number">0.685</span> / Accuracy: <span class="number">0.952</span></span><br><span class="line">Est: <span class="number">50</span> / Depth: <span class="number">3</span> / LR: <span class="number">1</span> ---- Precision: <span class="number">0.899</span> / Recall: <span class="number">0.832</span> / Accuracy: <span class="number">0.965</span></span><br><span class="line">Est: <span class="number">50</span> / Depth: <span class="number">7</span> / LR: <span class="number">0.01</span> ---- Precision: <span class="number">1.0</span> / Recall: <span class="number">0.007</span> / Accuracy: <span class="number">0.867</span></span><br><span class="line">Est: <span class="number">50</span> / Depth: <span class="number">7</span> / LR: <span class="number">0.1</span> ---- Precision: <span class="number">0.94</span> / Recall: <span class="number">0.846</span> / Accuracy: <span class="number">0.972</span></span><br><span class="line">Est: <span class="number">50</span> / Depth: <span class="number">7</span> / LR: <span class="number">1</span> ---- Precision: <span class="number">0.938</span> / Recall: <span class="number">0.819</span> / Accuracy: <span class="number">0.969</span></span><br><span class="line">Est: <span class="number">50</span> / Depth: <span class="number">11</span> / LR: <span class="number">0.01</span> ---- Precision: <span class="number">0.0</span> / Recall: <span class="number">0.0</span> / Accuracy: <span class="number">0.866</span></span><br><span class="line">Est: <span class="number">50</span> / Depth: <span class="number">11</span> / LR: <span class="number">0.1</span> ---- Precision: <span class="number">0.929</span> / Recall: <span class="number">0.879</span> / Accuracy: <span class="number">0.975</span></span><br><span class="line">Est: <span class="number">50</span> / Depth: <span class="number">11</span> / LR: <span class="number">1</span> ---- Precision: <span class="number">0.894</span> / Recall: <span class="number">0.846</span> / Accuracy: <span class="number">0.966</span></span><br><span class="line">Est: <span class="number">50</span> / Depth: <span class="number">15</span> / LR: <span class="number">0.01</span> ---- Precision: <span class="number">0.0</span> / Recall: <span class="number">0.0</span> / Accuracy: <span class="number">0.866</span></span><br><span class="line">Est: <span class="number">50</span> / Depth: <span class="number">15</span> / LR: <span class="number">0.1</span> ---- Precision: <span class="number">0.942</span> / Recall: <span class="number">0.872</span> / Accuracy: <span class="number">0.976</span></span><br><span class="line">Est: <span class="number">50</span> / Depth: <span class="number">15</span> / LR: <span class="number">1</span> ---- Precision: <span class="number">0.901</span> / Recall: <span class="number">0.859</span> / Accuracy: <span class="number">0.969</span></span><br><span class="line">Est: <span class="number">100</span> / Depth: <span class="number">3</span> / LR: <span class="number">0.01</span> ---- Precision: <span class="number">0.948</span> / Recall: <span class="number">0.49</span> / Accuracy: <span class="number">0.928</span></span><br><span class="line">Est: <span class="number">100</span> / Depth: <span class="number">3</span> / LR: <span class="number">0.1</span> ---- Precision: <span class="number">0.941</span> / Recall: <span class="number">0.745</span> / Accuracy: <span class="number">0.96</span></span><br><span class="line">Est: <span class="number">100</span> / Depth: <span class="number">3</span> / LR: <span class="number">1</span> ---- Precision: <span class="number">0.931</span> / Recall: <span class="number">0.819</span> / Accuracy: <span class="number">0.968</span></span><br><span class="line">Est: <span class="number">100</span> / Depth: <span class="number">7</span> / LR: <span class="number">0.01</span> ---- Precision: <span class="number">0.971</span> / Recall: <span class="number">0.664</span> / Accuracy: <span class="number">0.952</span></span><br><span class="line">Est: <span class="number">100</span> / Depth: <span class="number">7</span> / LR: <span class="number">0.1</span> ---- Precision: <span class="number">0.941</span> / Recall: <span class="number">0.859</span> / Accuracy: <span class="number">0.974</span></span><br><span class="line">Est: <span class="number">100</span> / Depth: <span class="number">7</span> / LR: <span class="number">1</span> ---- Precision: <span class="number">0.938</span> / Recall: <span class="number">0.819</span> / Accuracy: <span class="number">0.969</span></span><br><span class="line">Est: <span class="number">100</span> / Depth: <span class="number">11</span> / LR: <span class="number">0.01</span> ---- Precision: <span class="number">0.949</span> / Recall: <span class="number">0.752</span> / Accuracy: <span class="number">0.961</span></span><br><span class="line">Est: <span class="number">100</span> / Depth: <span class="number">11</span> / LR: <span class="number">0.1</span> ---- Precision: <span class="number">0.936</span> / Recall: <span class="number">0.886</span> / Accuracy: <span class="number">0.977</span></span><br><span class="line">Est: <span class="number">100</span> / Depth: <span class="number">11</span> / LR: <span class="number">1</span> ---- Precision: <span class="number">0.92</span> / Recall: <span class="number">0.846</span> / Accuracy: <span class="number">0.969</span></span><br><span class="line">Est: <span class="number">100</span> / Depth: <span class="number">15</span> / LR: <span class="number">0.01</span> ---- Precision: <span class="number">0.926</span> / Recall: <span class="number">0.846</span> / Accuracy: <span class="number">0.97</span></span><br><span class="line">Est: <span class="number">100</span> / Depth: <span class="number">15</span> / LR: <span class="number">0.1</span> ---- Precision: <span class="number">0.942</span> / Recall: <span class="number">0.879</span> / Accuracy: <span class="number">0.977</span></span><br><span class="line">Est: <span class="number">100</span> / Depth: <span class="number">15</span> / LR: <span class="number">1</span> ---- Precision: <span class="number">0.914</span> / Recall: <span class="number">0.859</span> / Accuracy: <span class="number">0.97</span></span><br><span class="line">Est: <span class="number">150</span> / Depth: <span class="number">3</span> / LR: <span class="number">0.01</span> ---- Precision: <span class="number">0.938</span> / Recall: <span class="number">0.503</span> / Accuracy: <span class="number">0.929</span></span><br><span class="line">Est: <span class="number">150</span> / Depth: <span class="number">3</span> / LR: <span class="number">0.1</span> ---- Precision: <span class="number">0.944</span> / Recall: <span class="number">0.799</span> / Accuracy: <span class="number">0.967</span></span><br><span class="line">Est: <span class="number">150</span> / Depth: <span class="number">3</span> / LR: <span class="number">1</span> ---- Precision: <span class="number">0.925</span> / Recall: <span class="number">0.826</span> / Accuracy: <span class="number">0.968</span></span><br><span class="line">Est: <span class="number">150</span> / Depth: <span class="number">7</span> / LR: <span class="number">0.01</span> ---- Precision: <span class="number">0.964</span> / Recall: <span class="number">0.725</span> / Accuracy: <span class="number">0.96</span></span><br><span class="line">Est: <span class="number">150</span> / Depth: <span class="number">7</span> / LR: <span class="number">0.1</span> ---- Precision: <span class="number">0.942</span> / Recall: <span class="number">0.866</span> / Accuracy: <span class="number">0.975</span></span><br><span class="line">Est: <span class="number">150</span> / Depth: <span class="number">7</span> / LR: <span class="number">1</span> ---- Precision: <span class="number">0.947</span> / Recall: <span class="number">0.839</span> / Accuracy: <span class="number">0.972</span></span><br><span class="line">Est: <span class="number">150</span> / Depth: <span class="number">11</span> / LR: <span class="number">0.01</span> ---- Precision: <span class="number">0.953</span> / Recall: <span class="number">0.812</span> / Accuracy: <span class="number">0.969</span></span><br><span class="line">Est: <span class="number">150</span> / Depth: <span class="number">11</span> / LR: <span class="number">0.1</span> ---- Precision: <span class="number">0.929</span> / Recall: <span class="number">0.879</span> / Accuracy: <span class="number">0.975</span></span><br><span class="line">Est: <span class="number">150</span> / Depth: <span class="number">11</span> / LR: <span class="number">1</span> ---- Precision: <span class="number">0.926</span> / Recall: <span class="number">0.846</span> / Accuracy: <span class="number">0.97</span></span><br><span class="line">Est: <span class="number">150</span> / Depth: <span class="number">15</span> / LR: <span class="number">0.01</span> ---- Precision: <span class="number">0.942</span> / Recall: <span class="number">0.866</span> / Accuracy: <span class="number">0.975</span></span><br><span class="line">Est: <span class="number">150</span> / Depth: <span class="number">15</span> / LR: <span class="number">0.1</span> ---- Precision: <span class="number">0.942</span> / Recall: <span class="number">0.879</span> / Accuracy: <span class="number">0.977</span></span><br><span class="line">Est: <span class="number">150</span> / Depth: <span class="number">15</span> / LR: <span class="number">1</span> ---- Precision: <span class="number">0.895</span> / Recall: <span class="number">0.859</span> / Accuracy: <span class="number">0.968</span></span><br></pre></td></tr></table></figure>
<p>There might be some warnings which means that at least one of the models didn’t predict a single text message to be spam.  So if it doesn’t predict any messages to be spam, then precision can’t be calculated.  So this warning is just saying that it sets precision to zero in those cases.</p>
<p>So first let’s take a look at some of the worst models.  Now, keep in mind, that the only thing we care about here are the actual results.  We’re looking at these results to dictate which hyperparameter settings generated the best model.  You could think of the hyperparameter settings just as instructions to the model to dictate how that model was built.  For the worst models on this list, you could see that the learning rate of 0.01 is a very common theme, and in general, the worst models also had a low number of estimators.  Let’s take a look at some of the best models.  Based on the results here, all of the best models had a learning rate of 0.1.  Now we can draw that distinction, that that instruction to the model, of whether the learning rate is 0.01, or it’s 0.1, is making a big difference in terms of the results of the model.  For this problem, it appears that this learning rate of 0.1 is ideal.  You’ll also note that the estimators and the max depth are on the high end of the ranges that we tested out.  If this process doesn’t make a lot of sense yet, you can think of it like baking a cake.  So we have our different ingredients, we have our flour, we have our chocolate, and we have our icing, and we’re tweaking these recipes just a little bit, to determine which of the recipes will generate the best-tasting cake.  So we’ll use these recipes, we’ll bake a bunch of different cakes, and then we’ll select the best-tasting cakes, and then from that, we’ll be able to say that these specific recipes are what generate the best cakes.</p>
<h2 id="evaluate-gradient-boosting-model-performance"><a class="markdownIt-Anchor" href="#evaluate-gradient-boosting-model-performance"></a> Evaluate Gradient-boosting Model Performance</h2>
<p>We’re starting to notice that model building is an iterative process.  Unfortunately, we don’t just write a couple lines of code, fit a model, and then wipe our hands of it.  We start with an initial exploration, then we take what we learned, and we dive a little bit deeper to learn a little bit more.  Then we take what we learned in that phase, and dive even deeper on a more specific model.  Until eventually, we’ve a built a model that we’re confident in, and that we thoroughly evaluated.  With that context, we’re going to enter the next phase of our build using GridSearchCV to explore our model, while allowing our prior exploration to point us in the right direction.</p>
<p>So just to recap very quickly.  GridSearch means setting up different parameter settings that you want to test, and then exhaustively searching that entire grid to determine the best model.  And cross-validation means you take your dataset, divide it into k subsets, and then you repeat the holdout test method where you train on some dataset, and then evaluate it on a separate dataset k times.  Each iteration you use a different subset of the data as the test data, and then all the rest of the data as the training set.  So then we combine these ideas into GridSearchCV.  What this method will do is it allows you to define a grid of parameters that you want to explore, and then within each hyper-parameter setting, that will run cross-validation.</p>
<p>Read the file and using both TF-IDF and Count Vectoriser:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfVectorizer, CountVectorizer</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">stopwords = nltk.corpus.stopwords.words(<span class="string">'english'</span>)</span><br><span class="line">ps = nltk.PorterStemmer()</span><br><span class="line"></span><br><span class="line">data = pd.read_csv(<span class="string">"SMSSpamCollection.tsv"</span>, sep=<span class="string">'\t'</span>)</span><br><span class="line">data.columns = [<span class="string">'label'</span>, <span class="string">'body_text'</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count_punct</span><span class="params">(text)</span>:</span></span><br><span class="line">    count = sum([<span class="number">1</span> <span class="keyword">for</span> char <span class="keyword">in</span> text <span class="keyword">if</span> char <span class="keyword">in</span> string.punctuation])</span><br><span class="line">    <span class="keyword">return</span> round(count/(len(text) - text.count(<span class="string">" "</span>)), <span class="number">3</span>)*<span class="number">100</span></span><br><span class="line"></span><br><span class="line">data[<span class="string">'body_len'</span>] = data[<span class="string">'body_text'</span>].apply(<span class="keyword">lambda</span> x: len(x) - x.count(<span class="string">" "</span>))</span><br><span class="line">data[<span class="string">'punct%'</span>] = data[<span class="string">'body_text'</span>].apply(<span class="keyword">lambda</span> x: count_punct(x))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clean_text</span><span class="params">(text)</span>:</span></span><br><span class="line">    text = <span class="string">""</span>.join([word.lower() <span class="keyword">for</span> word <span class="keyword">in</span> text <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> string.punctuation])</span><br><span class="line">    tokens = re.split(<span class="string">'\W+'</span>, text)</span><br><span class="line">    text = [ps.stem(word) <span class="keyword">for</span> word <span class="keyword">in</span> tokens <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> stopwords]</span><br><span class="line">    <span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line"><span class="comment"># TF-IDF</span></span><br><span class="line">tfidf_vect = TfidfVectorizer(analyzer=clean_text)</span><br><span class="line">X_tfidf = tfidf_vect.fit_transform(data[<span class="string">'body_text'</span>])</span><br><span class="line">X_tfidf_feat = pd.concat([data[<span class="string">'body_len'</span>], data[<span class="string">'punct%'</span>], pd.DataFrame(X_tfidf.toarray())], axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># CountVectorizer</span></span><br><span class="line">count_vect = CountVectorizer(analyzer=clean_text)</span><br><span class="line">X_count = count_vect.fit_transform(data[<span class="string">'body_text'</span>])</span><br><span class="line">X_count_feat = pd.concat([data[<span class="string">'body_len'</span>], data[<span class="string">'punct%'</span>], pd.DataFrame(X_count.toarray())], axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">X_count_feat.head()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">body_len</th>
<th style="text-align:right">punct%</th>
<th style="text-align:right">0</th>
<th style="text-align:right">1</th>
<th style="text-align:right">2</th>
<th style="text-align:right">3</th>
<th style="text-align:right">4</th>
<th style="text-align:right">5</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">128</td>
<td style="text-align:right">4.7</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">49</td>
<td style="text-align:right">4.1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">62</td>
<td style="text-align:right">3.2</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">28</td>
<td style="text-align:right">7.1</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">135</td>
<td style="text-align:right">4.4</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
</tbody>
</table>
<p>5 rows × 8106 columns</p>
<p>Import the packages:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> GradientBoostingClassifier</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> GridSearchCV</span><br></pre></td></tr></table></figure>
<p>If you remember back to when we did GridSearchCV with random forest, we leave that classifier empty, and then we define our parameters using this parameter grid. What the parameter grid will be, is it’ll be a dictionary, where the keys are the hyper-parameter values, and the parameter grid will be a dictionary where the keys of the dictionary will be your hyper-parameters, and then the values will be a list of settings that you want to try out.</p>
<p>The following code presents this concept in TF-IDF:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">gb = GradientBoostingClassifier()</span><br><span class="line"></span><br><span class="line">param = &#123;</span><br><span class="line">    <span class="string">"n_estimators"</span>: [<span class="number">100</span>, <span class="number">150</span>],</span><br><span class="line">    <span class="string">"max_depth"</span>: [<span class="number">7</span>, <span class="number">11</span>, <span class="number">15</span>],</span><br><span class="line">    <span class="string">"learning_rate"</span>: [<span class="number">0.1</span>]</span><br><span class="line">&#125;</span><br><span class="line">gs = GridSearchCV(gb, param, cv = <span class="number">5</span>, n_jobs = <span class="number">-1</span>)</span><br><span class="line">cv_fit = gs.fit(X_tfidf_feat, data[<span class="string">"label"</span>])</span><br><span class="line">tfidf_df = pd.DataFrame(cv_fit.cv_results_).sort_values(<span class="string">"mean_test_score"</span>, ascending = <span class="literal">False</span>)[<span class="number">0</span>:<span class="number">5</span>]</span><br><span class="line">tfidf_df</span><br></pre></td></tr></table></figure>
<p>The n_jobs=-1 means that we’ll train models on different subsets and parameter settings in parallel. It does not mean that each of the models themselves will be trained in parallel. Again, that’s because gradient boosting cannot be trained in parallel, because each iteration depends on the prior iteration.</p>
<p>Output:</p>
<p>The following code does the same thing but with count vectorisor</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">gb = GradientBoostingClassifier()</span><br><span class="line"></span><br><span class="line">param = &#123;</span><br><span class="line">    <span class="string">"n_estimators"</span>: [<span class="number">100</span>, <span class="number">150</span>],</span><br><span class="line">    <span class="string">"max_depth"</span>: [<span class="number">7</span>, <span class="number">11</span>, <span class="number">15</span>],</span><br><span class="line">    <span class="string">"learning_rate"</span>: [<span class="number">0.1</span>]</span><br><span class="line">&#125;</span><br><span class="line">gs = GridSearchCV(gb, param, cv = <span class="number">5</span>, n_jobs = <span class="number">-1</span>)</span><br><span class="line">cv_fit = gs.fit(X_count_feat, data[<span class="string">"label"</span>])</span><br><span class="line">count_df = pd.DataFrame(cv_fit.cv_results_).sort_values(<span class="string">"mean_test_score"</span>, ascending = <span class="literal">False</span>)[<span class="number">0</span>:<span class="number">5</span>]</span><br><span class="line">count_df</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">mean_fit_time</th>
<th style="text-align:right">mean_score_time</th>
<th style="text-align:right">mean_test_score</th>
<th style="text-align:right">param_max_depth</th>
<th style="text-align:right">param_n_estimators</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">241.798</td>
<td style="text-align:right">0.261987</td>
<td style="text-align:right">0.970361</td>
<td style="text-align:right">7</td>
<td style="text-align:right">150</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">387.388</td>
<td style="text-align:right">0.259972</td>
<td style="text-align:right">0.969822</td>
<td style="text-align:right">11</td>
<td style="text-align:right">150</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">361.938</td>
<td style="text-align:right">0.237765</td>
<td style="text-align:right">0.969822</td>
<td style="text-align:right">15</td>
<td style="text-align:right">100</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">425.78</td>
<td style="text-align:right">0.196678</td>
<td style="text-align:right">0.968744</td>
<td style="text-align:right">15</td>
<td style="text-align:right">150</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">282.125</td>
<td style="text-align:right">0.283908</td>
<td style="text-align:right">0.968385</td>
<td style="text-align:right">11</td>
<td style="text-align:right">100</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">mean_fit_time</th>
<th style="text-align:right">mean_score_time</th>
<th style="text-align:right">mean_test_score</th>
<th style="text-align:right">param_max_depth</th>
<th style="text-align:right">param_n_estimators</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">364.091</td>
<td style="text-align:right">0.253393</td>
<td style="text-align:right">0.969822</td>
<td style="text-align:right">11</td>
<td style="text-align:right">150</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">416.869</td>
<td style="text-align:right">0.170237</td>
<td style="text-align:right">0.969463</td>
<td style="text-align:right">15</td>
<td style="text-align:right">150</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">239.225</td>
<td style="text-align:right">0.304996</td>
<td style="text-align:right">0.968565</td>
<td style="text-align:right">7</td>
<td style="text-align:right">150</td>
</tr>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">176.768</td>
<td style="text-align:right">0.287938</td>
<td style="text-align:right">0.968205</td>
<td style="text-align:right">7</td>
<td style="text-align:right">100</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">352.215</td>
<td style="text-align:right">0.23997</td>
<td style="text-align:right">0.967846</td>
<td style="text-align:right">15</td>
<td style="text-align:right">100</td>
</tr>
</tbody>
</table>
<p>For random forest, the most time consuming model took around thirty seconds to fit.  So these models are taking a minimum of 150 seconds, and up to almost 370.  So you can really see the difference in how long it takes to fit.  You can see that the mean_test_scores are all just around 96 - 97 percent, or just below.  And you can see that the best models are the ones with 150 estimators, and around 11 max_depth.  So the very best model has 150 estimators, and a max_depth of 7.  So let’s look at the results for the count vectorizing really quick.  So you can see that the time it takes to fit the the mean_test_score, is pretty much right in line with tfidf.  So it doesn’t look like there’s too much of a difference, all the test score results are just around 96 to 97 percent.  So it’s the one with 150 estimators, and a max_depth of 11.  Okay, so now we’ve tested two different algorithms, random forest, and gradient boosting, on two different vectorization methods, tfidf, and count vectorization, across a variety of hyper-parameter settings.  So now we have a pretty good idea of what the models look like, and how they’re performing.</p>
<h2 id="model-selection-data-prep"><a class="markdownIt-Anchor" href="#model-selection-data-prep"></a> Model Selection: Data Prep</h2>
<p>Now we’ve gone through pretty much the entire machine learning process.  We’ve read in raw text, cleaned that text, created and transformed features in feature engineering, we’ve fit a simple model and evaluated it on a holdout test set, we’ve tuned hyperparameters and evaluated each one using GridSearchCV, and now we’re going to cap it all off by comparing our best performing models to select the very best model.  But before we do that, One thing that have to be mentioned is that we’ve been bending the rules just a little bit in regards to our vectorizers.  Vectorizers are like models.  They need to be fit on a training set and then stored in order to transform the test set.  So when we say fit on the training set, in the context of a vectorizer, it basically just means it stores all of the words in the training set.  Then when it transforms the test set, it will only create columns for the words that were in the training set.  Any words that appear in the test set but not in the training set, will not show up in the vectorized version of the test set.  The vectorizer will only recognize words that it saw in the training set.  Up to this point, we’ve been training the vectorizer on the entire data set, instead of just the training set because it makes things easier with GridSearch and breaking them apart would require an introduction to scikit-learn pipelines, which is beyond the scope of this course.  Now we’re going to tweak our process just a little bit as we go into the final model selection.  What this process will look like is that we’ll split into training and test set, and then we’ll train the vectorizers on the training set and use that to transform the test set.  And then we’ll fit the very best gradient boosting model and the best random forest model on the training set and then predict on the test set.  And then lastly, we’ll thoroughly evaluate the results of these two models to select the very best model.</p>
<p>Reading the data, clean the data and create the features:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfVectorizer</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">stopwords = nltk.corpus.stopwords.words(<span class="string">'english'</span>)</span><br><span class="line">ps = nltk.PorterStemmer()</span><br><span class="line"></span><br><span class="line">data = pd.read_csv(<span class="string">"SMSSpamCollection.tsv"</span>, sep=<span class="string">'\t'</span>)</span><br><span class="line">data.columns = [<span class="string">'label'</span>, <span class="string">'body_text'</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count_punct</span><span class="params">(text)</span>:</span></span><br><span class="line">    count = sum([<span class="number">1</span> <span class="keyword">for</span> char <span class="keyword">in</span> text <span class="keyword">if</span> char <span class="keyword">in</span> string.punctuation])</span><br><span class="line">    <span class="keyword">return</span> round(count/(len(text) - text.count(<span class="string">" "</span>)), <span class="number">3</span>)*<span class="number">100</span></span><br><span class="line"></span><br><span class="line">data[<span class="string">'body_len'</span>] = data[<span class="string">'body_text'</span>].apply(<span class="keyword">lambda</span> x: len(x) - x.count(<span class="string">" "</span>))</span><br><span class="line">data[<span class="string">'punct%'</span>] = data[<span class="string">'body_text'</span>].apply(<span class="keyword">lambda</span> x: count_punct(x))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clean_text</span><span class="params">(text)</span>:</span></span><br><span class="line">    text = <span class="string">""</span>.join([word.lower() <span class="keyword">for</span> word <span class="keyword">in</span> text <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> string.punctuation])</span><br><span class="line">    tokens = re.split(<span class="string">'\W+'</span>, text)</span><br><span class="line">    text = [ps.stem(word) <span class="keyword">for</span> word <span class="keyword">in</span> tokens <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> stopwords]</span><br><span class="line">    <span class="keyword">return</span> text</span><br></pre></td></tr></table></figure>
<p>Splitting into train / test set:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"></span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(data[[<span class="string">'body_text'</span>, <span class="string">'body_len'</span>, <span class="string">'punct%'</span>]], data[<span class="string">'label'</span>], test_size=<span class="number">0.2</span>)</span><br></pre></td></tr></table></figure>
<p>We’re going to vectorize using TFIDF, as that generated results that were slightly ahead of the count vectorizer. Now, it’s worth noting that the difference was very, very slight, so this is more of a judgment call than anything. Just like with our other scikit-learn models, we’re going to instantiate our vectorizer in this way, and then we’re going to pass in our cleaning function into the analyzer parameter. And then we’ll fit that on body_text from X_train</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tfidf_vect = TfidfVectorizer(analyzer=clean_text)</span><br><span class="line">tfidf_vect_fit = tfidf_vect.fit(X_train[<span class="string">'body_text'</span>])</span><br></pre></td></tr></table></figure>
<p>In the code above, we have a stored vectorizer in tfidf_vect_fit that was fit on only our training data, so it’s basically stored all the words from our training set and it’ll keep those to be used to created the columns once we transform both our training and our test set.  So again, keep in mind, all we did is we used this training set to fit our vectorizer object and then we stored that vectorizer object.  We still haven’t done anything with the training set.  So the training set still has these [‘body_text’, ‘body_len’, ‘punct%’] columns in it.  It doesn’t have any vectorized columns.  The following code is going to create those vectorised columns by extending the code above.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># we're first fitting and then we're transforming this time</span></span><br><span class="line">tfidf_train = tfidf_vect_fit.transform(X_train[<span class="string">"body_text"</span>])</span><br><span class="line">tfidf_test = tfidf_vect_fit.transform(X_test[<span class="string">"body_text"</span>])</span><br><span class="line"><span class="comment"># tfidf_train and tfidf_test will have the same number of columns because they're both transformed using this TFIDF vect underscore fit that was trained on the training set so it only recognizes words in the training set and can only create columns for words from the training set.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Concatenate back together this vectorized data back with body length and punctuation to give us our X features.</span></span><br><span class="line">X_train_vect = pd.concat([X_train[[<span class="string">"body_len"</span>, <span class="string">"punct%"</span>]].reset_index(drop = <span class="literal">True</span>),</span><br><span class="line">                          pd.DataFrame(tfidf_train.toarray())], axis = <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">X_test_vect = pd.concat([X_test[[<span class="string">"body_len"</span>, <span class="string">"punct%"</span>]].reset_index(drop = <span class="literal">True</span>),</span><br><span class="line">                         pd.DataFrame(tfidf_test.toarray())], axis = <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">X_train_vect.head()</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th style="text-align:right">body_len</th>
<th style="text-align:right">punct%</th>
<th style="text-align:right">0</th>
<th style="text-align:right">1</th>
<th style="text-align:right">2</th>
<th style="text-align:right">3</th>
<th style="text-align:right">4</th>
<th style="text-align:right">5</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">130</td>
<td style="text-align:right">3.8</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">116</td>
<td style="text-align:right">12.9</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">18</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">55</td>
<td style="text-align:right">1.8</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">62</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
</tbody>
</table>
<p>5 rows × 7199 columns</p>
<p>The vectorizer on the full data set generated over 8,000 features.  In other words, it recognized over 8,000 unique words.  Now it only contains just over 7,000. Again, that’s because this vectorizer was fit only on the training data.  So what this tells us is that there are around 1,000 words in the test set that won’t be recognized by the vectorizer.  So they’ll essentially be ignored.  So that’s how you properly fit your vectorizer and prepare your data for your final model selection.</p>
<h2 id="model-selection-results"><a class="markdownIt-Anchor" href="#model-selection-results"></a> Model Selection: Results</h2>
<p>Now we have all of our data prepared.  So we have our training set with our vectorized data and our created features, and then we also have our test set that was transformed using the vectorizer trained only on the training set.  Let’s jump into final model selection.</p>
<p>Import some packages and one more function that we’re importing here.  This one’s called time.  This will allow us to track how long it’s taking for our models to train and predict, because, as you’ll see in just a few minutes, that’s one factor that comes into play as part of final model selection. We’ll go ahead and run that:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestClassifier, GradientBoostingClassifier</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> precision_recall_fscore_support <span class="keyword">as</span> score</span><br><span class="line"><span class="keyword">import</span> time</span><br></pre></td></tr></table></figure>
<p>The reason that we care about this predict time in particular is that if you’re using your model in an environment where it needs to make very high-frequency predictions, then even if it’s taking a second, or maybe even half a second, to make a prediction, that might be too long and it’ll create a bottleneck in your process.</p>
<p>The following is the code that comparing between random forest classifier and gradient boosting classifier.</p>
<p>Random Forest:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">rf = RandomForestClassifier(n_estimators=<span class="number">150</span>, max_depth=<span class="literal">None</span>, n_jobs=<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line">rf_model = rf.fit(X_train_vect, y_train)</span><br><span class="line">end = time.time()</span><br><span class="line">fit_time = (end - start)</span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line">y_pred = rf_model.predict(X_test_vect)</span><br><span class="line">end = time.time()</span><br><span class="line">pred_time = (end - start)</span><br><span class="line"></span><br><span class="line">precision, recall, fscore, train_support = score(y_test, y_pred, pos_label=<span class="string">'spam'</span>, average=<span class="string">'binary'</span>)</span><br><span class="line">print(<span class="string">'Fit time: &#123;&#125; / Predict time: &#123;&#125; ---- Precision: &#123;&#125; / Recall: &#123;&#125; / Accuracy: &#123;&#125;'</span>.format(</span><br><span class="line">    round(fit_time, <span class="number">3</span>), round(pred_time, <span class="number">3</span>), round(precision, <span class="number">3</span>), round(recall, <span class="number">3</span>), round((y_pred==y_test).sum()/len(y_pred), <span class="number">3</span>)))</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Fit time: <span class="number">2.782</span> / Predict time: <span class="number">0.168</span> ---- Precision: <span class="number">1.0</span> / Recall: <span class="number">0.844</span> / Accuracy: <span class="number">0.979</span></span><br></pre></td></tr></table></figure>
<p>Gradient Boosting:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">gb = GradientBoostingClassifier(n_estimators=<span class="number">150</span>, max_depth=<span class="number">11</span>)</span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line">gb_model = gb.fit(X_train_vect, y_train)</span><br><span class="line">end = time.time()</span><br><span class="line">fit_time = (end - start)</span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line">y_pred = gb_model.predict(X_test_vect)</span><br><span class="line">end = time.time()</span><br><span class="line">pred_time = (end - start)</span><br><span class="line"></span><br><span class="line">precision, recall, fscore, train_support = score(y_test, y_pred, pos_label=<span class="string">'spam'</span>, average=<span class="string">'binary'</span>)</span><br><span class="line">print(<span class="string">'Fit time: &#123;&#125; / Predict time: &#123;&#125; ---- Precision: &#123;&#125; / Recall: &#123;&#125; / Accuracy: &#123;&#125;'</span>.format(</span><br><span class="line">    round(fit_time, <span class="number">3</span>), round(pred_time, <span class="number">3</span>), round(precision, <span class="number">3</span>), round(recall, <span class="number">3</span>), round((y_pred==y_test).sum()/len(y_pred), <span class="number">3</span>)))</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Fit time: <span class="number">202.739</span> / Predict time: <span class="number">0.116</span> ---- Precision: <span class="number">0.925</span> / Recall: <span class="number">0.844</span> / Accuracy: <span class="number">0.97</span></span><br></pre></td></tr></table></figure>
<p>For the final comparison, what we want to do is we want to compare Fit time, Predict time, Precision, Recall, and Accuracy between these two models with a particular focus on Predict time, Precision, and Recall.  The reason being that once these models are fit, you generally store them for the purpose of making predictions later on.  They wouldn’t really ever be refit or retrained again until you decide that your current model needs to be replaced.  That’s why we care more about predict time than we do fit time.  And then precision and recall just give you a more in-depth look into how your model’s performing than accuracy does.  That’s why we really focus on those three metrics.</p>
<p>Let’s take a note of the results.  You’ll notice that even though GradientBoosting takes way longer than RandomForest does to fit, it actually takes less time to predict.  In terms of precision and recall, our RandomForest has much better precision at 100%, but GradientBoosting has slightly better recall.  Now we find ourselves in a situation where no matter which model we pick we’re making some kind of trade off.  If we pick RandomForest, that means that we care more about precision than we do predict time or recall, and vice versa.  This kind of trade off is very common, which brings me to a couple of very important points.</p>
<p>First, generally you’ll dive into the metrics much more than we are here.  We wouldn’t base it only on overall precision, recall, and predict time.  We’d split our test set in a variety of different ways to understand how it does across a number of different dimensions.  We might say let’s look only at text messages that have a length greater than 50, see how our model does there.  Or, let’s look at text messages that have zero punctuation and see how our model does there. We’d slice it in a variety of different ways to really understand where the model’s doing well, and maybe where it doesn’t do well.  That would also include looking at specific text messages that the model is getting wrong.</p>
<p>The second point is after thorough training and evaluation process, you usually end up in a place where you have some kind of trade off like we have here between performance and predict time.  And, in this case, and this is very important, you make your decision based on the business problem or the business context. What that means is is having a longer predict time going to create a huge bottleneck in your process.  In some business context, having a model that takes over .2 seconds to predict might be a deal breaker so you might have no choice but to go with the GradientBoosting model.</p>
<p>Additionally, most problems either have a higher cost on false positives, which means you would prioritize precision, or false negatives, which means you’d prioritize recall.  For instance, for a spam filter, you can probably deal with some spam in your inbox here and there, but you don’t want your spam filter to capture real emails, so we’d prioritize here for precision.  So when it says it’s spam, it better be spam.  In this case, false positives are very costly.  The second case would be something like anti-virus software.  False positives where they say that you have a virus but you really don’t, that can be scary without a doubt, but if you’re getting hacked and your software doesn’t catch it, that’s much, much worse.  In this case, we should optimize for recall so that if there’s a breach, the model better be able to catch it.  With all that said, assuming that predict time is not a deal breaker for your business problem, and you don’t necessarily have a super-clear answer of whether false positives or false negatives are more costly, the model that you’d probably select here is the RandomForest model.  That’s because the precision is so much better than the GradientBoosting model, and the recall is very close.</p>
<p>Now that you’ve gone through the entire pipeline of reading in text, cleaning it, vectorizing it, creating features, and exploring various models to pick an optimal model, now you can confidently say that given some messy text with some kind of labels, you can clean that up and build a model to return concise predictions about that text.</p>
<h1 id="summary"><a class="markdownIt-Anchor" href="#summary"></a> Summary</h1>
<p>We’ve now learned how to read in-text data when we don’t know how many columns there are, what separates the columns, or even what format it’s in.  Then we learned how to clean up that data using regular expressions and tools from various packages to remove punctuation, tokenize, remove stop words, and stem and lemmatize our data.  Then we learned a few different methods to vectorize our data to get it into a format that a machine learning model can understand and train on.  Then we learned how to create and transform features and then lastly, we learned how to build and evaluate a few different types of models using the text and created features.  We now have the tools to go from messy, unstructured data set to concise predictions.  This is an incredibly powerful tool for natural language processing but don’t stop here.  We only touched on some of the most high-level topics. Use this as a road map to continue learning and building your own powerful models.</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Zilan Huang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://hoanjinan.github.io/2019/09/02/Natural-Language-Processing/">http://hoanjinan.github.io/2019/09/02/Natural-Language-Processing/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Data-Science/">Data Science    </a><a class="post-meta__tags" href="/tags/Data-Processing/">Data Processing    </a><a class="post-meta__tags" href="/tags/Machine-Learning/">Machine Learning    </a><a class="post-meta__tags" href="/tags/AI/">AI    </a></div><div class="post_share"><div class="social-share" data-image="https://live.staticflickr.com/65535/48721190707_bc691426d8_o.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-buttom"><i class="fa fa-qrcode"></i> Donate<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lozad post-qr-code__img" src="/img/wechat.jpeg"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lozad post-qr-code__img" src="/img/alipay.jpeg"><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="next-post pull-full"><a href="/2019/08/20/Spark-for-Machine-Learning-AI/"><img class="next_cover lozad" data-src="https://live.staticflickr.com/65535/48621537921_7855b8a711_o.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">Next Post</div><div class="next_info"><span>Spark for Machine Learning and AI</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> Recommend</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2019/08/20/Spark-for-Machine-Learning-AI/" title="Spark for Machine Learning and AI"><img class="relatedPosts_cover lozad" data-src="https://live.staticflickr.com/65535/48621537921_7855b8a711_o.jpg"><div class="relatedPosts_title">Spark for Machine Learning and AI</div></a></div><div class="relatedPosts_item"><a href="/2019/08/19/Hadoop-Environment-Setup/" title="Hadoop Environment Setup"><img class="relatedPosts_cover lozad" data-src="https://live.staticflickr.com/65535/48621680177_6107d2deaf_o.png"><div class="relatedPosts_title">Hadoop Environment Setup</div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> Comment</span></div><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'http://hoanjinan.github.io/2019/09/02/Natural-Language-Processing/';
  this.page.identifier = '2019/09/02/Natural-Language-Processing/';
  this.page.title = 'Natural Language Processing (NLP)';
}
var d = document, s = d.createElement('script');
s.src = "https://" + 'hoanjinan-otoko' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script></div></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2019 By Zilan Huang</div><div class="framework-info"><span>Driven </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly"><span>Butterfly</span></a></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><section class="rightside" id="rightside"><i class="fa fa-book" id="readmode" title="Read Mode"> </i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="Traditional Chinese and Simplified Chinese Conversion">简</a><i class="fa fa-moon-o nightshift" id="nightshift" title="Dark Mode"></i></section><div id="post_bottom"><div id="post_bottom_items"><a id="to_comment" href="#post-comment"><i class="scroll_to_comment fa fa-comments"></i></a><i class="fa fa-list" id="mobile_toc"></i><div id="toc_mobile"><div class="toc_mobile_headline">Catalog</div><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#introduction"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text"> Introduction</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#introduction-to-the-post"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text"> Introduction to The Post</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#introduction-to-natural-language-processing-nlp"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text"> Introduction to Natural Language Processing (NLP)</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#introduction-to-nltk"><span class="toc_mobile_items-number">1.3.</span> <span class="toc_mobile_items-text"> Introduction to NLTK</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#nlp-basics"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text"> NLP Basics</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#how-to-install-nltk-on-local-machine"><span class="toc_mobile_items-number">2.1.</span> <span class="toc_mobile_items-text"> How to install NLTK on local machine</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#download-nltk-data"><span class="toc_mobile_items-number">2.1.1.</span> <span class="toc_mobile_items-text"> Download NLTK data</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#reading-in-text-data"><span class="toc_mobile_items-number">2.2.</span> <span class="toc_mobile_items-text"> Reading in Text Data</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#what-is-unstructured-data"><span class="toc_mobile_items-number">2.2.1.</span> <span class="toc_mobile_items-text"> What is Unstructured Data</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#read-semi-structured-data"><span class="toc_mobile_items-number">2.2.2.</span> <span class="toc_mobile_items-text"> Read Semi-structured data</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#exploring-the-dataset"><span class="toc_mobile_items-number">2.3.</span> <span class="toc_mobile_items-text"> Exploring The Dataset</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#regular-expressions"><span class="toc_mobile_items-number">2.4.</span> <span class="toc_mobile_items-text"> Regular Expressions</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#introduction-to-regular-expression"><span class="toc_mobile_items-number">2.4.1.</span> <span class="toc_mobile_items-text"> Introduction to Regular Expression</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#how-to-use-regular-expressions"><span class="toc_mobile_items-number">2.4.2.</span> <span class="toc_mobile_items-text"> How to Use Regular Expressions</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#regular-expression-replacements"><span class="toc_mobile_items-number">2.4.3.</span> <span class="toc_mobile_items-text"> Regular Expression Replacements</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#other-examples-of-regex-methods"><span class="toc_mobile_items-number">2.4.3.1.</span> <span class="toc_mobile_items-text"> Other examples of regex methods</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#machine-learning-pipeline"><span class="toc_mobile_items-number">2.5.</span> <span class="toc_mobile_items-text"> Machine Learning Pipeline</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#implementation"><span class="toc_mobile_items-number">2.6.</span> <span class="toc_mobile_items-text"> Implementation</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#removing-punctuation"><span class="toc_mobile_items-number">2.6.1.</span> <span class="toc_mobile_items-text"> Removing Punctuation</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#tokenisation"><span class="toc_mobile_items-number">2.6.2.</span> <span class="toc_mobile_items-text"> Tokenisation</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#removing-stop-words"><span class="toc_mobile_items-number">2.6.3.</span> <span class="toc_mobile_items-text"> Removing Stop Words</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#supplemental-data-cleaning"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text"> Supplemental Data Cleaning</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#introducting-stemming"><span class="toc_mobile_items-number">3.1.</span> <span class="toc_mobile_items-text"> Introducting Stemming</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#using-stemming"><span class="toc_mobile_items-number">3.2.</span> <span class="toc_mobile_items-text"> Using Stemming</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#introducting-lemmatising"><span class="toc_mobile_items-number">3.3.</span> <span class="toc_mobile_items-text"> Introducting Lemmatising</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#using-lemmatising"><span class="toc_mobile_items-number">3.4.</span> <span class="toc_mobile_items-text"> Using Lemmatising</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#test-out-wordnet-lemmatiser-read-more-about-wordnet-here"><span class="toc_mobile_items-number">3.4.1.</span> <span class="toc_mobile_items-text"> Test out WordNet lemmatiser (read more about WordNet here)</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#comparation-between-lemmatiser-and-stemmer"><span class="toc_mobile_items-number">3.4.2.</span> <span class="toc_mobile_items-text"> Comparation between Lemmatiser and Stemmer</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#first-example"><span class="toc_mobile_items-number">3.4.2.1.</span> <span class="toc_mobile_items-text"> First Example</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#second-example"><span class="toc_mobile_items-number">3.4.2.2.</span> <span class="toc_mobile_items-text"> Second Example</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#apply-lammatiser-to-sms-spam-collection-data"><span class="toc_mobile_items-number">3.4.3.</span> <span class="toc_mobile_items-text"> Apply lammatiser to SMS Spam Collection Data</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#vectorising-raw-data"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text"> Vectorising Raw Data</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#introducing-vectorising"><span class="toc_mobile_items-number">4.1.</span> <span class="toc_mobile_items-text"> Introducing Vectorising</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#count-vectorisation"><span class="toc_mobile_items-number">4.2.</span> <span class="toc_mobile_items-text"> Count Vectorisation</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#n-gram-vectorising"><span class="toc_mobile_items-number">4.3.</span> <span class="toc_mobile_items-text"> N-gram Vectorising</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#inverse-document-frequency-weighting-tf-idf"><span class="toc_mobile_items-number">4.4.</span> <span class="toc_mobile_items-text"> Inverse Document Frequency Weighting (TF-IDF)</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#feature-engineering"><span class="toc_mobile_items-number">5.</span> <span class="toc_mobile_items-text"> Feature Engineering</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#introducing-feature-engineering"><span class="toc_mobile_items-number">5.1.</span> <span class="toc_mobile_items-text"> Introducing Feature Engineering</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#feature-creation"><span class="toc_mobile_items-number">5.2.</span> <span class="toc_mobile_items-text"> Feature Creation</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#feature-evaluation"><span class="toc_mobile_items-number">5.3.</span> <span class="toc_mobile_items-text"> Feature Evaluation</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#identifying-features-for-treansformation"><span class="toc_mobile_items-number">5.4.</span> <span class="toc_mobile_items-text"> Identifying Features for Treansformation</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#box-cox-power-transformation"><span class="toc_mobile_items-number">5.5.</span> <span class="toc_mobile_items-text"> Box-Cox Power Transformation</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#building-machine-learning-classifiers"><span class="toc_mobile_items-number">6.</span> <span class="toc_mobile_items-text"> Building Machine Learning Classifiers</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#what-is-machine-learning"><span class="toc_mobile_items-number">6.1.</span> <span class="toc_mobile_items-text"> What is Machine Learning</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#two-broad-types-of-machine-learning"><span class="toc_mobile_items-number">6.1.1.</span> <span class="toc_mobile_items-text"> Two Broad Types of Machine Learning</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#cross-validation-and-evaluation-metrics"><span class="toc_mobile_items-number">6.2.</span> <span class="toc_mobile_items-text"> Cross-validation and Evaluation Metrics</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#introducting-random-forest"><span class="toc_mobile_items-number">6.3.</span> <span class="toc_mobile_items-text"> Introducting Random Forest</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#building-a-random-forest-model"><span class="toc_mobile_items-number">6.4.</span> <span class="toc_mobile_items-text"> Building a Random Forest Model</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#random-forest-with-holdout-test-set"><span class="toc_mobile_items-number">6.5.</span> <span class="toc_mobile_items-text"> Random Forest with Holdout Test Set</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#random-forest-model-with-grid-search"><span class="toc_mobile_items-number">6.6.</span> <span class="toc_mobile_items-text"> Random Forest Model with Grid Search</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#evaluate-random-forest-model-performance"><span class="toc_mobile_items-number">6.7.</span> <span class="toc_mobile_items-text"> Evaluate Random Forest Model Performance</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#introducting-gradient-boosting"><span class="toc_mobile_items-number">6.8.</span> <span class="toc_mobile_items-text"> Introducting Gradient Boosting</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#gradient-boosting-grid-search"><span class="toc_mobile_items-number">6.9.</span> <span class="toc_mobile_items-text"> Gradient-boosting Grid Search</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#evaluate-gradient-boosting-model-performance"><span class="toc_mobile_items-number">6.10.</span> <span class="toc_mobile_items-text"> Evaluate Gradient-boosting Model Performance</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#model-selection-data-prep"><span class="toc_mobile_items-number">6.11.</span> <span class="toc_mobile_items-text"> Model Selection: Data Prep</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#model-selection-results"><span class="toc_mobile_items-number">6.12.</span> <span class="toc_mobile_items-text"> Model Selection: Results</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#summary"><span class="toc_mobile_items-number">7.</span> <span class="toc_mobile_items-text"> Summary</span></a></li></ol></div></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script>$(function () {
  $('span.katex-display').wrap('<div class="katex-wrap"></div>')
})</script><script async src="/js/search/local-search.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script src="/js/nightshift.js"></script><script id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zindex="-1" data-click="false"></script><script id="ribbon" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/js/piao.js"></script><script src="/js/activate-power-mode.js"></script><script>POWERMODE.colorful = true; // make power mode colorful
POWERMODE.shake = true; // turn off shake
document.body.addEventListener('input', POWERMODE);
</script><script src="/js/tw_cn.js"></script><script>translateInitilization()

</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@1.2.2/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script><script>const observer = lozad(); // lazy loads elements with default selector as '.lozad'
observer.observe();</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"right","width":150,"height":300,"hOffset":100,"vOffset":-10},"mobile":{"show":true},"log":false,"tagMode":false});</script></body></html>